(()=>{var e={4552:(e,t,r)=>{const o=r(873),s=r(6996),i=r(737),n=r(8691),a=r(2972),c=r(8279),p=r(9955),d=r(7666),u=r(3595),l=r(4517),h=r(8203),{isRebalancing:m,isKafkaJSError:f,...g}=r(9879),{LEVELS:I}=r(354);e.exports={Kafka:o,PartitionAssigners:s,AssignerProtocol:i,Partitioners:n,logLevel:I,CompressionTypes:a.Types,CompressionCodecs:a.Codecs,ConfigResourceTypes:c,AclResourceTypes:d,AclOperationTypes:u,AclPermissionTypes:l,ResourcePatternTypes:h,ConfigSource:p,...g}},5929:(e,t,r)=>{const o=r(9701),s=r(6335),i=r(3163),n=r(763),a=r(2190),{events:c,wrap:p,unwrap:d}=r(7881),{LEVELS:u}=r(354),{KafkaJSNonRetriableError:l,KafkaJSDeleteGroupsError:h,KafkaJSBrokerNotFound:m,KafkaJSDeleteTopicRecordsError:f,KafkaJSAggregateError:g}=r(9879),{staleMetadata:I}=r(1701),y=r(8279),w=r(7666),T=r(3595),E=r(4517),b=r(8203),{EARLIEST_OFFSET:S,LATEST_OFFSET:A}=r(3904),{CONNECT:O,DISCONNECT:C}=c,{values:N,keys:R,entries:k}=Object,x=N(c),v=R(c).map((e=>`admin.events.${e}`)).join(", "),_=async(e,t)=>(await e.addTargetTopic(t),await e.refreshMetadataIfNecessary(),e.findTopicPartitionMetadata(t).map((({partitionId:e})=>e)).sort());e.exports=({logger:e,instrumentationEmitter:t,retry:r,cluster:R})=>{const B=e.namespace("Admin"),P=t||new a,D=async e=>{if(!e||"string"!=typeof e)throw new l(`Invalid topic ${e}`);return o(r)((async(t,r,o)=>{try{await R.addTargetTopic(e),await R.refreshMetadataIfNecessary();const t=R.findTopicPartitionMetadata(e),r=await R.fetchTopicsOffset([{topic:e,fromBeginning:!1,partitions:t.map((e=>({partition:e.partitionId})))}]),o=await R.fetchTopicsOffset([{topic:e,fromBeginning:!0,partitions:t.map((e=>({partition:e.partitionId})))}]),{partitions:s}=r.pop(),{partitions:i}=o.pop();return s.map((({partition:e,offset:t})=>({partition:e,offset:t,high:t,low:i.find((({partition:t})=>t===e)).offset})))}catch(e){if("UNKNOWN_TOPIC_OR_PARTITION"===e.type)throw await R.refreshMetadata(),e;t(e)}}))},L=async({groupId:t,topic:r,partitions:o})=>{if(!t)throw new l(`Invalid groupId ${t}`);if(!r)throw new l(`Invalid topic ${r}`);if(!o||0===o.length)throw new l("Invalid partitions");const s=n({logger:e.namespace("Admin",u.NOTHING),cluster:R,groupId:t});await s.subscribe({topic:r,fromBeginning:!0});const i=await s.describeGroup();if(!(e=>["Empty","Dead"].includes(e.state))(i))throw new l(`The consumer group must have no running instances, current state: ${i.state}`);return new Promise(((e,t)=>{s.on(s.events.FETCH,(async()=>s.stop().then(e).catch(t))),s.run({eachBatchAutoResolve:!1,eachBatch:async()=>!0}).catch(t),s.pause([{topic:r}]);for(const e of o)s.seek({topic:r,...e})}))},M=({resources:e,defaultBroker:t})=>i(e,(async({type:e,name:r})=>(e=>[y.BROKER,y.BROKER_LOGGER].includes(e))(e)?await R.findBroker({nodeId:String(r)}):t));return{connect:async()=>{await R.connect(),P.emit(O)},disconnect:async()=>{await R.disconnect(),P.emit(C)},listTopics:async()=>{const{topicMetadata:e}=await R.metadata();return e.map((e=>e.topic))},createTopics:async({topics:e,validateOnly:t,timeout:i,waitForLeaders:n=!0})=>{if(!e||!Array.isArray(e))throw new l(`Invalid topics array ${e}`);if(e.filter((({topic:e})=>"string"!=typeof e)).length>0)throw new l("Invalid topics array, the topic names have to be a valid string");const a=new Set(e.map((({topic:e})=>e)));if(a.size<e.length)throw new l("Invalid topics array, it cannot have multiple entries for the same topic");for(const{topic:t,configEntries:r}of e)if(null!=r){if(!Array.isArray(r))throw new l(`Invalid configEntries for topic "${t}", must be an array`);r.forEach(((e,r)=>{if("object"!=typeof e||null==e)throw new l(`Invalid configEntries for topic "${t}". Entry ${r} must be an object`);for(const o of["name","value"])if(!Object.prototype.hasOwnProperty.call(e,o)||"string"!=typeof e[o])throw new l(`Invalid configEntries for topic "${t}". Entry ${r} must have a valid "${o}" property`)}))}return o(r)((async(r,o,c)=>{try{await R.refreshMetadata();const r=await R.findControllerBroker();if(await r.createTopics({topics:e,validateOnly:t,timeout:i}),n){const e=Array.from(a.values());await((e,t={})=>s((async()=>{try{return await e()}catch(e){if("LEADER_NOT_AVAILABLE"!==e.type)throw e;return!1}}),t))((async()=>await r.metadata(e)),{delay:100,maxWait:i,timeoutMessage:"Timed out while waiting for topic leaders"})}return!0}catch(e){if("NOT_CONTROLLER"===e.type)throw B.warn("Could not create topics",{error:e.message,retryCount:o,retryTime:c}),e;if(e instanceof g&&e.errors.every((e=>"TOPIC_ALREADY_EXISTS"===e.type)))return!1;r(e)}}))},deleteTopics:async({topics:e,timeout:t})=>{if(!e||!Array.isArray(e))throw new l(`Invalid topics array ${e}`);if(e.filter((e=>"string"!=typeof e)).length>0)throw new l("Invalid topics array, the names must be a valid string");return o(r)((async(r,o,s)=>{try{await R.refreshMetadata();const r=await R.findControllerBroker();await r.deleteTopics({topics:e,timeout:t});for(const t of e)R.targetTopics.delete(t);await R.refreshMetadata()}catch(e){if(["NOT_CONTROLLER","UNKNOWN_TOPIC_OR_PARTITION"].includes(e.type))throw B.warn("Could not delete topics",{error:e.message,retryCount:o,retryTime:s}),e;"REQUEST_TIMED_OUT"===e.type&&B.error('Could not delete topics, check if "delete.topic.enable" is set to "true" (the default value is "false") or increase the timeout',{error:e.message,retryCount:o,retryTime:s}),r(e)}}))},createPartitions:async({topicPartitions:e,validateOnly:t,timeout:s})=>{if(!e||!Array.isArray(e))throw new l(`Invalid topic partitions array ${e}`);if(0===e.length)throw new l("Empty topic partitions array");if(e.filter((({topic:e})=>"string"!=typeof e)).length>0)throw new l("Invalid topic partitions array, the topic names have to be a valid string");if(new Set(e.map((({topic:e})=>e))).size<e.length)throw new l("Invalid topic partitions array, it cannot have multiple entries for the same topic");return o(r)((async(r,o,i)=>{try{await R.refreshMetadata();const r=await R.findControllerBroker();await r.createPartitions({topicPartitions:e,validateOnly:t,timeout:s})}catch(e){if("NOT_CONTROLLER"===e.type)throw B.warn("Could not create topics",{error:e.message,retryCount:o,retryTime:i}),e;r(e)}}))},fetchTopicMetadata:async({topics:e=[]}={})=>(e&&e.forEach((e=>{if(!e||"string"!=typeof e)throw new l(`Invalid topic ${e}`)})),{topics:(await R.metadata({topics:e})).topicMetadata.map((e=>({name:e.topic,partitions:e.partitionMetadata})))}),describeCluster:async()=>{const{brokers:e,clusterId:t,controllerId:r}=await R.metadata({topics:[]});return{brokers:e.map((({nodeId:e,host:t,port:r})=>({nodeId:e,host:t,port:r}))),controller:null==r||-1===r?null:r,clusterId:t}},events:c,fetchOffsets:async({groupId:e,topics:t,resolveOffsets:r=!1})=>{if(!e)throw new l(`Invalid groupId ${e}`);if(t||(t=[]),!Array.isArray(t))throw new l("Expected topics array to be set");const o=await R.findGroupCoordinator({groupId:e}),s=await Promise.all(t.map((async e=>({topic:e,partitions:(await _(R,e)).map((e=>({partition:e})))}))));let{responses:i}=await o.offsetFetch({groupId:e,topics:s});return r&&(i=await Promise.all(i.map((async({topic:t,partitions:r})=>{const o=(await D(t)).reduce(((e,{partition:t,...r})=>Object.assign(e,{[t]:{...r}})),{}),s=r.map((({offset:e,partition:t,...r})=>{let s=e;return Number(e)===S&&(s=o[t].low),Number(e)===A&&(s=o[t].high),{partition:t,offset:s,...r}}));return await L({groupId:e,topic:t,partitions:s}),{topic:t,partitions:s}})))),i.map((({topic:e,partitions:t})=>({topic:e,partitions:t.map((({partition:e,offset:t,metadata:r})=>({partition:e,offset:t,metadata:r||null})))})))},fetchTopicOffsets:D,fetchTopicOffsetsByTimestamp:async(e,t)=>{if(!e||"string"!=typeof e)throw new l(`Invalid topic ${e}`);return o(r)((async(r,o,s)=>{try{await R.addTargetTopic(e),await R.refreshMetadataIfNecessary();const r=R.findTopicPartitionMetadata(e).map((e=>({partition:e.partitionId}))),o=await R.fetchTopicsOffset([{topic:e,fromBeginning:!1,partitions:r}]),{partitions:s}=o.pop(),i=await R.fetchTopicsOffset([{topic:e,fromTimestamp:t,partitions:r}]),{partitions:n}=i.pop();return n.map((({partition:e,offset:t})=>({partition:e,offset:parseInt(t,10)>=0?t:s.find((({partition:t})=>t===e)).offset})))}catch(e){if("UNKNOWN_TOPIC_OR_PARTITION"===e.type)throw await R.refreshMetadata(),e;r(e)}}))},setOffsets:L,resetOffsets:async({groupId:e,topic:t,earliest:r=!1})=>{if(!e)throw new l(`Invalid groupId ${e}`);if(!t)throw new l(`Invalid topic ${t}`);const o=(await _(R,t)).map((e=>({partition:e,offset:R.defaultOffset({fromBeginning:r})})));return L({groupId:e,topic:t,partitions:o})},describeConfigs:async({resources:e,includeSynonyms:t})=>{if(!e||!Array.isArray(e))throw new l(`Invalid resources array ${e}`);if(0===e.length)throw new l("Resources array cannot be empty");const s=Object.values(y),i=e.find((e=>!s.includes(e.type)));if(i)throw new l(`Invalid resource type ${i.type}: ${JSON.stringify(i)}`);const n=e.find((e=>!e.name||"string"!=typeof e.name));if(n)throw new l(`Invalid resource name ${n.name}: ${JSON.stringify(n)}`);const a=e.find((e=>!Array.isArray(e.configNames)&&null!=e.configNames));if(a){const{configNames:e}=a;throw new l(`Invalid resource configNames ${e}: ${JSON.stringify(a)}`)}return o(r)((async(r,o,s)=>{try{await R.refreshMetadata();const r=await R.findControllerBroker(),o=await M({resources:e,defaultBroker:r}),s=async e=>{const s=e||r;return s.describeConfigs({resources:o.get(s),includeSynonyms:t})},i=Array.from(o.keys()),n=(await Promise.all(i.map(s))).reduce(((e,{resources:t})=>[...e,...t]),[]);return{resources:n}}catch(e){if("NOT_CONTROLLER"===e.type)throw B.warn("Could not describe configs",{error:e.message,retryCount:o,retryTime:s}),e;r(e)}}))},alterConfigs:async({resources:e,validateOnly:t})=>{if(!e||!Array.isArray(e))throw new l(`Invalid resources array ${e}`);if(0===e.length)throw new l("Resources array cannot be empty");const s=Object.values(y),i=e.find((e=>!s.includes(e.type)));if(i)throw new l(`Invalid resource type ${i.type}: ${JSON.stringify(i)}`);const n=e.find((e=>!e.name||"string"!=typeof e.name));if(n)throw new l(`Invalid resource name ${n.name}: ${JSON.stringify(n)}`);const a=e.find((e=>!Array.isArray(e.configEntries)));if(a){const{configEntries:e}=a;throw new l(`Invalid resource configEntries ${e}: ${JSON.stringify(a)}`)}const c=e.find((e=>e.configEntries.some((e=>"string"!=typeof e.name||"string"!=typeof e.value))));if(c)throw new l(`Invalid resource config value: ${JSON.stringify(c)}`);return o(r)((async(r,o,s)=>{try{await R.refreshMetadata();const r=await R.findControllerBroker(),o=await M({resources:e,defaultBroker:r}),s=async e=>{const s=e||r;return s.alterConfigs({resources:o.get(s),validateOnly:!!t})},i=Array.from(o.keys()),n=(await Promise.all(i.map(s))).reduce(((e,{resources:t})=>[...e,...t]),[]);return{resources:n}}catch(e){if("NOT_CONTROLLER"===e.type)throw B.warn("Could not alter configs",{error:e.message,retryCount:o,retryTime:s}),e;r(e)}}))},on:(e,t)=>{if(!x.includes(e))throw new l(`Event name should be one of ${v}`);return P.addListener(d(e),(r=>{r.type=p(r.type),Promise.resolve(t(r)).catch((t=>{B.error(`Failed to execute listener: ${t.message}`,{eventName:e,stack:t.stack})}))}))},logger:()=>B,listGroups:async()=>{await R.refreshMetadata();let e=[];for(var t in R.brokerPool.brokers){const r=await R.findBroker({nodeId:t}),o=await r.listGroups();e=e.concat(o.groups)}return{groups:e}},describeGroups:async e=>{const t=await Promise.all(e.map((async e=>({coordinator:await R.findGroupCoordinator({groupId:e}),groupId:e})))),s=Object.values(t.reduce(((e,{coordinator:t,groupId:r})=>{const o=e[t.nodeId];return e[t.nodeId]=o?{...o,groupIds:[...o.groupIds,r]}:{coordinator:t,groupIds:[r]},e}),{})),i=await Promise.all(s.map((async({coordinator:e,groupIds:t})=>{const s=o(r),{groups:i}=await s((()=>e.describeGroups({groupIds:t})));return i})));return{groups:[].concat.apply([],i)}},deleteGroups:async e=>{if(!e||!Array.isArray(e))throw new l(`Invalid groupIds array ${e}`);const t=e.some((e=>"string"!=typeof e));if(t)throw new l(`Invalid groupId name: ${JSON.stringify(t)}`);const s=o(r);let i=[],n=e.slice();return s((async(e,t,r)=>{try{if(0===n.length)return[];await R.refreshMetadata();const e={},t={};for(const r of n){const o=await R.findGroupCoordinator({groupId:r});void 0===e[o.nodeId]&&(e[o.nodeId]=[]),e[o.nodeId].push(r),t[o.nodeId]=o}const r=await Promise.all(Object.keys(t).map((async r=>await t[r].deleteGroups(e[r])))),o=r.flatMap((({results:e})=>e.map((({groupId:e,errorCode:t,error:r})=>({groupId:e,errorCode:t,error:r}))))).filter((({errorCode:e})=>0!==e));if(n=o.map((({groupId:e})=>e)),o.length>0)throw new h("Error in DeleteGroups",o);return i=r.flatMap((({results:e})=>e)),i}catch(o){if("NOT_CONTROLLER"===o.type||"COORDINATOR_NOT_AVAILABLE"===o.type)throw B.warn("Could not delete groups",{error:o.message,retryCount:t,retryTime:r}),o;e(o)}}))},describeAcls:async({resourceType:e,resourceName:t,resourcePatternType:s,principal:i,host:n,operation:a,permissionType:c})=>{if("string"!=typeof i&&void 0!==i)throw new l("Invalid principal, the principal have to be a valid string");if("string"!=typeof n&&void 0!==n)throw new l("Invalid host, the host have to be a valid string");if("string"!=typeof t&&void 0!==t)throw new l("Invalid resourceName, the resourceName have to be a valid string");if(!Object.values(T).includes(a))throw new l(`Invalid operation type ${a}`);if(!Object.values(b).includes(s))throw new l(`Invalid resource pattern filter type ${s}`);if(!Object.values(E).includes(c))throw new l(`Invalid permission type ${c}`);if(!Object.values(w).includes(e))throw new l(`Invalid resource type ${e}`);return o(r)((async(r,o,p)=>{try{await R.refreshMetadata();const r=await R.findControllerBroker(),{resources:o}=await r.describeAcls({resourceType:e,resourceName:t,resourcePatternType:s,principal:i,host:n,operation:a,permissionType:c});return{resources:o}}catch(e){if("NOT_CONTROLLER"===e.type)throw B.warn("Could not describe ACL",{error:e.message,retryCount:o,retryTime:p}),e;r(e)}}))},deleteAcls:async({filters:e})=>{if(!e||!Array.isArray(e))throw new l(`Invalid ACL Filter array ${e}`);if(0===e.length)throw new l("Empty ACL Filter array");if(e.some((({principal:e})=>"string"!=typeof e&&void 0!==e)))throw new l("Invalid ACL Filter array, the principals have to be a valid string");if(e.some((({host:e})=>"string"!=typeof e&&void 0!==e)))throw new l("Invalid ACL Filter array, the hosts have to be a valid string");if(e.some((({resourceName:e})=>"string"!=typeof e&&void 0!==e)))throw new l("Invalid ACL Filter array, the resourceNames have to be a valid string");let t;const s=Object.values(T);if(t=e.find((e=>!s.includes(e.operation))),t)throw new l(`Invalid operation type ${t.operation}: ${JSON.stringify(t)}`);const i=Object.values(b);if(t=e.find((e=>!i.includes(e.resourcePatternType))),t)throw new l(`Invalid resource pattern type ${t.resourcePatternType}: ${JSON.stringify(t)}`);const n=Object.values(E);if(t=e.find((e=>!n.includes(e.permissionType))),t)throw new l(`Invalid permission type ${t.permissionType}: ${JSON.stringify(t)}`);const a=Object.values(w);if(t=e.find((e=>!a.includes(e.resourceType))),t)throw new l(`Invalid resource type ${t.resourceType}: ${JSON.stringify(t)}`);return o(r)((async(t,r,o)=>{try{await R.refreshMetadata();const t=await R.findControllerBroker(),{filterResponses:r}=await t.deleteAcls({filters:e});return{filterResponses:r}}catch(e){if("NOT_CONTROLLER"===e.type)throw B.warn("Could not delete ACL",{error:e.message,retryCount:r,retryTime:o}),e;t(e)}}))},createAcls:async({acl:e})=>{if(!e||!Array.isArray(e))throw new l(`Invalid ACL array ${e}`);if(0===e.length)throw new l("Empty ACL array");if(e.some((({principal:e})=>"string"!=typeof e)))throw new l("Invalid ACL array, the principals have to be a valid string");if(e.some((({host:e})=>"string"!=typeof e)))throw new l("Invalid ACL array, the hosts have to be a valid string");if(e.some((({resourceName:e})=>"string"!=typeof e)))throw new l("Invalid ACL array, the resourceNames have to be a valid string");let t;const s=Object.values(T);if(t=e.find((e=>!s.includes(e.operation))),t)throw new l(`Invalid operation type ${t.operation}: ${JSON.stringify(t)}`);const i=Object.values(b);if(t=e.find((e=>!i.includes(e.resourcePatternType))),t)throw new l(`Invalid resource pattern type ${t.resourcePatternType}: ${JSON.stringify(t)}`);const n=Object.values(E);if(t=e.find((e=>!n.includes(e.permissionType))),t)throw new l(`Invalid permission type ${t.permissionType}: ${JSON.stringify(t)}`);const a=Object.values(w);if(t=e.find((e=>!a.includes(e.resourceType))),t)throw new l(`Invalid resource type ${t.resourceType}: ${JSON.stringify(t)}`);return o(r)((async(t,r,o)=>{try{await R.refreshMetadata();const t=await R.findControllerBroker();return await t.createAcls({acl:e}),!0}catch(e){if("NOT_CONTROLLER"===e.type)throw B.warn("Could not create ACL",{error:e.message,retryCount:r,retryTime:o}),e;t(e)}}))},deleteTopicRecords:async({topic:e,partitions:t})=>{if(!e||"string"!=typeof e)throw new l(`Invalid topic "${e}"`);if(!t||0===t.length)throw new l("Invalid partitions");const s=R.findLeaderForPartitions(e,t.map((e=>e.partition))),i=N(s).flat(),n=await D(e),a=[];if(t.forEach((({partition:t,offset:r})=>{if(!i.includes(t))return void a.push({partition:t,offset:r,error:new m("Could not find the leader for the partition",{retriable:!1})});const{low:o}=n.find((e=>e.partition===t))||{high:void 0,low:void 0};parseInt(r)<parseInt(o)&&-1!==parseInt(r)&&B.warn("The requested offset is before the earliest offset maintained on the partition - no records will be deleted from this partition",{topic:e,partition:t,offset:r})})),a.length>0)throw new f({topic:e,partitions:a});const c=k(s).reduce(((r,[o,s])=>(r[o]={topic:e,partitions:t.filter((e=>s.includes(e.partition)))},r)),{});return o(r)((async t=>{try{const t=[],r=k(c).map((([e,{topic:t,partitions:r}])=>async()=>{const o=await R.findBroker({nodeId:e});await o.deleteRecords({topics:[{topic:t,partitions:r}]}),delete c[e]}));if(await Promise.all(r.map((e=>e().catch((e=>{if("KafkaJSDeleteTopicRecordsError"!==e.name)throw e;e.partitions.forEach((({partition:e,offset:r,error:o})=>{t.push({partition:e,offset:r,error:o})}))}))))),t.length>0)throw new f({topic:e,partitions:t})}catch(e){throw e.retriable&&e.partitions.some((({error:e})=>I(e)||"KafkaJSMetadataNotLoaded"===e.name))&&await R.refreshMetadata(),e}}))}}}},7881:(e,t,r)=>{const o=r(76),s=r(8202),i=r(1429)("admin"),n={CONNECT:i("connect"),DISCONNECT:i("disconnect"),REQUEST:i(s.NETWORK_REQUEST),REQUEST_TIMEOUT:i(s.NETWORK_REQUEST_TIMEOUT),REQUEST_QUEUE_SIZE:i(s.NETWORK_REQUEST_QUEUE_SIZE)},a={[n.REQUEST]:s.NETWORK_REQUEST,[n.REQUEST_TIMEOUT]:s.NETWORK_REQUEST_TIMEOUT,[n.REQUEST_QUEUE_SIZE]:s.NETWORK_REQUEST_QUEUE_SIZE},c=o(a);e.exports={events:n,wrap:e=>c[e]||e,unwrap:e=>a[e]||e}},266:(e,t,r)=>{const o=r(4105),{Types:s}=r(2972),{requests:i,lookup:n}=r(3146),{KafkaJSNonRetriableError:a}=r(9879),c=r(9211),p=r(2464),d=Symbol("private:Broker:sendRequest"),u=()=>{throw new Error("Broker not connected")};e.exports=class{constructor({connectionPool:e,logger:t,nodeId:r=null,versions:s=null,authenticationTimeout:i=1e4,allowAutoTopicCreation:n=!0}){this.connectionPool=e,this.nodeId=r,this.rootLogger=t,this.logger=t.namespace("Broker"),this.versions=s,this.authenticationTimeout=i,this.allowAutoTopicCreation=n;const a=2*this.connectionPool.connectionTimeout+this.authenticationTimeout;this.brokerAddress=`${this.connectionPool.host}:${this.connectionPool.port}`,this.lock=new o({timeout:a,description:`connect to broker ${this.brokerAddress}`}),this.lookupRequest=u}isConnected(){return this.connectionPool.sasl?this.connectionPool.isConnected()&&this.connectionPool.isAuthenticated():this.connectionPool.isConnected()}async connect(){try{if(await this.lock.acquire(),this.isConnected())return;const e=await this.connectionPool.getConnection();if(this.versions||(this.versions=await this.apiVersions()),this.connectionPool.setVersions(this.versions),this.lookupRequest=n(this.versions),null===e.getSupportAuthenticationProtocol()){let e=!1;try{this.lookupRequest(c.SaslAuthenticate,i.SaslAuthenticate),e=!0}catch(t){e=!1}this.connectionPool.setSupportAuthenticationProtocol(e),this.logger.debug("Verified support for SaslAuthenticate",{broker:this.brokerAddress,supportAuthenticationProtocol:e})}await e.authenticate()}finally{await this.lock.release()}}async disconnect(){await this.connectionPool.destroy()}async apiVersions(){let e;const t=i.ApiVersions.versions.map(Number).sort().reverse();for(const r of t)try{const t=i.ApiVersions.protocol({version:r});e=await this[d]({...t(),requestTimeout:this.connectionPool.connectionTimeout});break}catch(e){if("UNSUPPORTED_VERSION"!==e.type)throw e}if(!e)throw new a("API Versions not supported");return e.apiVersions.reduce(((e,t)=>Object.assign(e,{[t.apiKey]:{minVersion:t.minVersion,maxVersion:t.maxVersion}})),{})}async metadata(e=[]){const t=this.lookupRequest(c.Metadata,i.Metadata),r=p(e);return await this[d](t({topics:r,allowAutoTopicCreation:this.allowAutoTopicCreation}))}async produce({topicData:e,transactionalId:t,producerId:r,producerEpoch:o,acks:n=-1,timeout:a=3e4,compression:p=s.None}){const u=this.lookupRequest(c.Produce,i.Produce);return await this[d](u({acks:n,timeout:a,compression:p,topicData:e,transactionalId:t,producerId:r,producerEpoch:o}))}async fetch({replicaId:e,isolationLevel:t,maxWaitTime:r=5e3,minBytes:o=1,maxBytes:s=10485760,topics:n,rackId:a=""}){const u=this.lookupRequest(c.Fetch,i.Fetch),l=n.reduce(((e,{topic:t,partitions:r})=>(r.forEach((r=>{e.push({topic:t,partition:r})})),e)),[]),h=p(l).reduce(((e,{topic:t,partition:r})=>{const o=e[e.length-1];return null!=o&&o.topic===t?e[e.length-1].partitions.push(r):e.push({topic:t,partitions:[r]}),e}),[]);return await this[d](u({replicaId:e,isolationLevel:t,maxWaitTime:r,minBytes:o,maxBytes:s,topics:h,rackId:a}))}async heartbeat({groupId:e,groupGenerationId:t,memberId:r}){const o=this.lookupRequest(c.Heartbeat,i.Heartbeat);return await this[d](o({groupId:e,groupGenerationId:t,memberId:r}))}async findGroupCoordinator({groupId:e,coordinatorType:t}){const r=this.lookupRequest(c.GroupCoordinator,i.GroupCoordinator);return await this[d](r({groupId:e,coordinatorType:t}))}async joinGroup({groupId:e,sessionTimeout:t,rebalanceTimeout:r,memberId:o="",protocolType:s="consumer",groupProtocols:n}){const a=this.lookupRequest(c.JoinGroup,i.JoinGroup),p=(i=o)=>this[d](a({groupId:e,sessionTimeout:t,rebalanceTimeout:r,memberId:i,protocolType:s,groupProtocols:n}));try{return await p()}catch(e){if("KafkaJSMemberIdRequired"===e.name)return p(e.memberId);throw e}}async leaveGroup({groupId:e,memberId:t}){const r=this.lookupRequest(c.LeaveGroup,i.LeaveGroup);return await this[d](r({groupId:e,memberId:t}))}async syncGroup({groupId:e,generationId:t,memberId:r,groupAssignment:o}){const s=this.lookupRequest(c.SyncGroup,i.SyncGroup);return await this[d](s({groupId:e,generationId:t,memberId:r,groupAssignment:o}))}async listOffsets({replicaId:e,isolationLevel:t,topics:r}){const o=this.lookupRequest(c.ListOffsets,i.ListOffsets),s=await this[d](o({replicaId:e,isolationLevel:t,topics:r}));for(const e of s.responses)e.partitions=e.partitions.map((({offsets:e,...t})=>e?{...t,offset:e.pop()}:t));return s}async offsetCommit({groupId:e,groupGenerationId:t,memberId:r,retentionTime:o,topics:s}){const n=this.lookupRequest(c.OffsetCommit,i.OffsetCommit);return await this[d](n({groupId:e,groupGenerationId:t,memberId:r,retentionTime:o,topics:s}))}async offsetFetch({groupId:e,topics:t}){const r=this.lookupRequest(c.OffsetFetch,i.OffsetFetch);return await this[d](r({groupId:e,topics:t}))}async describeGroups({groupIds:e}){const t=this.lookupRequest(c.DescribeGroups,i.DescribeGroups);return await this[d](t({groupIds:e}))}async createTopics({topics:e,validateOnly:t=!1,timeout:r=5e3}){const o=this.lookupRequest(c.CreateTopics,i.CreateTopics);return await this[d](o({topics:e,validateOnly:t,timeout:r}))}async createPartitions({topicPartitions:e,validateOnly:t=!1,timeout:r=5e3}){const o=this.lookupRequest(c.CreatePartitions,i.CreatePartitions);return await this[d](o({topicPartitions:e,validateOnly:t,timeout:r}))}async deleteTopics({topics:e,timeout:t=5e3}){const r=this.lookupRequest(c.DeleteTopics,i.DeleteTopics);return await this[d](r({topics:e,timeout:t}))}async describeConfigs({resources:e,includeSynonyms:t=!1}){const r=this.lookupRequest(c.DescribeConfigs,i.DescribeConfigs);return await this[d](r({resources:e,includeSynonyms:t}))}async alterConfigs({resources:e,validateOnly:t=!1}){const r=this.lookupRequest(c.AlterConfigs,i.AlterConfigs);return await this[d](r({resources:e,validateOnly:t}))}async initProducerId({transactionalId:e,transactionTimeout:t}){const r=this.lookupRequest(c.InitProducerId,i.InitProducerId);return await this[d](r({transactionalId:e,transactionTimeout:t}))}async addPartitionsToTxn({transactionalId:e,producerId:t,producerEpoch:r,topics:o}){const s=this.lookupRequest(c.AddPartitionsToTxn,i.AddPartitionsToTxn);return await this[d](s({transactionalId:e,producerId:t,producerEpoch:r,topics:o}))}async addOffsetsToTxn({transactionalId:e,producerId:t,producerEpoch:r,groupId:o}){const s=this.lookupRequest(c.AddOffsetsToTxn,i.AddOffsetsToTxn);return await this[d](s({transactionalId:e,producerId:t,producerEpoch:r,groupId:o}))}async txnOffsetCommit({transactionalId:e,groupId:t,producerId:r,producerEpoch:o,topics:s}){const n=this.lookupRequest(c.TxnOffsetCommit,i.TxnOffsetCommit);return await this[d](n({transactionalId:e,groupId:t,producerId:r,producerEpoch:o,topics:s}))}async endTxn({transactionalId:e,producerId:t,producerEpoch:r,transactionResult:o}){const s=this.lookupRequest(c.EndTxn,i.EndTxn);return await this[d](s({transactionalId:e,producerId:t,producerEpoch:r,transactionResult:o}))}async listGroups(){const e=this.lookupRequest(c.ListGroups,i.ListGroups);return await this[d](e())}async deleteGroups(e){const t=this.lookupRequest(c.DeleteGroups,i.DeleteGroups);return await this[d](t(e))}async deleteRecords({topics:e}){const t=this.lookupRequest(c.DeleteRecords,i.DeleteRecords);return await this[d](t({topics:e}))}async createAcls({acl:e}){const t=this.lookupRequest(c.CreateAcls,i.CreateAcls);return await this[d](t({creations:e}))}async describeAcls({resourceType:e,resourceName:t,resourcePatternType:r,principal:o,host:s,operation:n,permissionType:a}){const p=this.lookupRequest(c.DescribeAcls,i.DescribeAcls);return await this[d](p({resourceType:e,resourceName:t,resourcePatternType:r,principal:o,host:s,operation:n,permissionType:a}))}async deleteAcls({filters:e}){const t=this.lookupRequest(c.DeleteAcls,i.DeleteAcls);return await this[d](t({filters:e}))}async[d](e){try{return await this.connectionPool.send(e)}catch(e){throw"KafkaJSConnectionClosedError"===e.name&&await this.disconnect(),e}}}},8931:(e,t,r)=>{const o=r(1128),{KafkaJSSASLAuthenticationError:s}=r(9879);e.exports=class{constructor(e,t,r){this.connection=e,this.logger=t.namespace("SASLAWSIAMAuthenticator"),this.saslAuthenticate=r}async authenticate(){const{sasl:e}=this.connection;if(!e.authorizationIdentity)throw new s("SASL AWS-IAM: Missing authorizationIdentity");if(!e.accessKeyId)throw new s("SASL AWS-IAM: Missing accessKeyId");if(!e.secretAccessKey)throw new s("SASL AWS-IAM: Missing secretAccessKey");e.sessionToken||(e.sessionToken="");const t=o.request(e),r=o.response,{host:i,port:n}=this.connection,a=`${i}:${n}`;try{this.logger.debug("Authenticate with SASL AWS-IAM",{broker:a}),await this.saslAuthenticate({request:t,response:r}),this.logger.debug("SASL AWS-IAM authentication successful",{broker:a})}catch(e){const t=new s(`SASL AWS-IAM authentication failed: ${e.message}`);throw this.logger.error(t.message,{broker:a}),t}}}},722:(e,t,r)=>{const{requests:o,lookup:s}=r(3146),i=r(9211),n=r(7891),a=r(5667),c=r(527),p=r(8931),d=r(3938),{KafkaJSSASLAuthenticationError:u}=r(9879),l={PLAIN:n,"SCRAM-SHA-256":a,"SCRAM-SHA-512":c,AWS:p,OAUTHBEARER:d},h=Object.keys(l);e.exports=class{constructor(e,t,r,n){this.connection=e,this.logger=t,this.sessionLifetime="0";const a=s(r);this.saslHandshake=a(i.SaslHandshake,o.SaslHandshake),this.protocolAuthentication=n?a(i.SaslAuthenticate,o.SaslAuthenticate):null}async authenticate(){const e=this.connection.sasl.mechanism.toUpperCase();if(!h.includes(e))throw new u(`SASL ${e} mechanism is not supported by the client`);if(!(await this.connection.send(this.saslHandshake({mechanism:e}))).enabledMechanisms.includes(e))throw new u(`SASL ${e} mechanism is not supported by the server`);const t=l[e];await new t(this.connection,this.logger,(async({request:e,response:t,authExpectResponse:r})=>{if(this.protocolAuthentication){const{buffer:o}=await e.encode(),s=await this.connection.send(this.protocolAuthentication({authBytes:o}));if(this.sessionLifetime=s.sessionLifetimeMs||"0",!r)return;const{authBytes:i}=s,n=await t.decode(i);return t.parse(n)}return this.connection.sendAuthRequest({request:e,response:t,authExpectResponse:r})})).authenticate()}}},3938:(e,t,r)=>{const o=r(3860),{KafkaJSSASLAuthenticationError:s}=r(9879);e.exports=class{constructor(e,t,r){this.connection=e,this.logger=t.namespace("SASLOAuthBearerAuthenticator"),this.saslAuthenticate=r}async authenticate(){const{sasl:e}=this.connection;if(null==e.oauthBearerProvider)throw new s("SASL OAUTHBEARER: Missing OAuth bearer token provider");const{oauthBearerProvider:t}=e,r=await t();if(null==r.value)throw new s("SASL OAUTHBEARER: Invalid OAuth bearer token");const i=await o.request(e,r),n=o.response,{host:a,port:c}=this.connection,p=`${a}:${c}`;try{this.logger.debug("Authenticate with SASL OAUTHBEARER",{broker:p}),await this.saslAuthenticate({request:i,response:n}),this.logger.debug("SASL OAUTHBEARER authentication successful",{broker:p})}catch(e){const t=new s(`SASL OAUTHBEARER authentication failed: ${e.message}`);throw this.logger.error(t.message,{broker:p}),t}}}},7891:(e,t,r)=>{const o=r(7733),{KafkaJSSASLAuthenticationError:s}=r(9879);e.exports=class{constructor(e,t,r){this.connection=e,this.logger=t.namespace("SASLPlainAuthenticator"),this.saslAuthenticate=r}async authenticate(){const{sasl:e}=this.connection;if(null==e.username||null==e.password)throw new s("SASL Plain: Invalid username or password");const t=o.request(e),r=o.response,{host:i,port:n}=this.connection,a=`${i}:${n}`;try{this.logger.debug("Authenticate with SASL PLAIN",{broker:a}),await this.saslAuthenticate({request:t,response:r}),this.logger.debug("SASL PLAIN authentication successful",{broker:a})}catch(e){const t=new s(`SASL PLAIN authentication failed: ${e.message}`);throw this.logger.error(t.message,{broker:a}),t}}}},1818:(e,t,r)=>{const o=r(6113),s=r(2337),{KafkaJSSASLAuthenticationError:i,KafkaJSNonRetriableError:n}=r(9879),a=/=/g,c=/,/g,p=/\+/g,d=/\//g,u=/=+$/,l=e=>Buffer.from(e).toString("base64");class h{static sanitizeString(e){return e.replace(a,"=3D").replace(c,"=2C")}static nonce(){return o.randomBytes(16).toString("base64").replace(p,"-").replace(d,"_").replace(u,"").toString("ascii")}static hi(e,t,r,s){return new Promise(((i,n)=>{o.pbkdf2(e,t,r,s.length,s.type,((e,t)=>e?n(e):i(t)))}))}static xor(e,t){const r=Buffer.from(e),o=Buffer.from(t),s=Buffer.byteLength(r);if(s!==Buffer.byteLength(o))throw new n("Buffers must be of the same length");const i=[];for(let e=0;e<s;e++)i.push(r[e]^o[e]);return Buffer.from(i)}constructor(e,t,r,o){this.connection=e,this.logger=t,this.saslAuthenticate=r,this.digestDefinition=o;const s=o.type.toUpperCase();this.PREFIX=`SASL SCRAM ${s} authentication`,this.currentNonce=h.nonce()}async authenticate(){const{PREFIX:e}=this,{host:t,port:r,sasl:o}=this.connection,s=`${t}:${r}`;if(null==o.username||null==o.password)throw new i(`${this.PREFIX}: Invalid username or password`);try{this.logger.debug("Exchanging first client message",{broker:s});const t=await this.sendClientFirstMessage();this.logger.debug("Sending final message",{broker:s});const r=await this.sendClientFinalMessage(t);if(r.e)throw new Error(r.e);const o=await this.serverKey(t),i=this.serverSignature(o,t);if(r.v!==i)throw new Error("Invalid server signature in server final message");this.logger.debug(`${e} successful`,{broker:s})}catch(t){const r=new i(`${e} failed: ${t.message}`);throw this.logger.error(r.message,{broker:s}),r}}async sendClientFirstMessage(){const e=`n,,${this.firstMessageBare()}`,t=s.firstMessage.request({clientFirstMessage:e}),r=s.firstMessage.response;return this.saslAuthenticate({authExpectResponse:!0,request:t,response:r})}async sendClientFinalMessage(e){const{PREFIX:t}=this,r=parseInt(e.i,10),{minIterations:o}=this.digestDefinition;if(!e.r.startsWith(this.currentNonce))throw new i(`${t} failed: Invalid server nonce, it does not start with the client nonce`);if(r<o)throw new i(`${t} failed: Requested iterations ${r} is less than the minimum ${o}`);const n=`${this.finalMessageWithoutProof(e)},p=${await this.clientProof(e)}`,a=s.finalMessage.request({finalMessage:n}),c=s.finalMessage.response;return this.saslAuthenticate({authExpectResponse:!0,request:a,response:c})}async clientProof(e){const t=await this.clientKey(e),r=this.H(t),o=this.clientSignature(r,e);return l(h.xor(t,o))}async clientKey(e){const t=await this.saltPassword(e);return this.HMAC(t,"Client Key")}async serverKey(e){const t=await this.saltPassword(e);return this.HMAC(t,"Server Key")}clientSignature(e,t){return this.HMAC(e,this.authMessage(t))}serverSignature(e,t){return l(this.HMAC(e,this.authMessage(t)))}authMessage(e){return[this.firstMessageBare(),e.original,this.finalMessageWithoutProof(e)].join(",")}async saltPassword(e){const t=Buffer.from(e.s,"base64"),r=parseInt(e.i,10);return h.hi(this.encodedPassword(),t,r,this.digestDefinition)}firstMessageBare(){return`n=${this.encodedUsername()},r=${this.currentNonce}`}finalMessageWithoutProof(e){const t=e.r;return`c=${l("n,,")},r=${t}`}encodedUsername(){const{username:e}=this.connection.sasl;return h.sanitizeString(e).toString("utf-8")}encodedPassword(){const{password:e}=this.connection.sasl;return e.toString("utf-8")}H(e){return o.createHash(this.digestDefinition.type).update(e).digest()}HMAC(e,t){return o.createHmac(this.digestDefinition.type,e).update(t).digest()}}e.exports={DIGESTS:{SHA256:{length:32,type:"sha256",minIterations:4096},SHA512:{length:64,type:"sha512",minIterations:4096}},SCRAM:h}},5667:(e,t,r)=>{const{SCRAM:o,DIGESTS:s}=r(1818);e.exports=class extends o{constructor(e,t,r){super(e,t.namespace("SCRAM256Authenticator"),r,s.SHA256)}}},527:(e,t,r)=>{const{SCRAM:o,DIGESTS:s}=r(1818);e.exports=class extends o{constructor(e,t,r){super(e,t.namespace("SCRAM512Authenticator"),r,s.SHA512)}}},1625:(e,t,r)=>{const o=r(266),s=r(9701),i=r(2464),n=r(8351),{KafkaJSBrokerNotFound:a,KafkaJSProtocolError:c}=r(9879),{keys:p,assign:d,values:u}=Object;e.exports=class{constructor({connectionPoolBuilder:e,logger:t,retry:r,allowAutoTopicCreation:i,authenticationTimeout:n,metadataMaxAge:a}){this.rootLogger=t,this.connectionPoolBuilder=e,this.metadataMaxAge=a||0,this.logger=t.namespace("BrokerPool"),this.retrier=s(d({},r)),this.createBroker=e=>new o({allowAutoTopicCreation:i,authenticationTimeout:n,...e}),this.brokers={},this.seedBroker=void 0,this.metadata=null,this.metadataExpireAt=null,this.versions=null}hasConnectedBrokers(){return!!u(this.brokers).find((e=>e.isConnected()))||!!this.seedBroker&&this.seedBroker.isConnected()}async createSeedBroker(){this.seedBroker&&await this.seedBroker.disconnect();const e=await this.connectionPoolBuilder.build();this.seedBroker=this.createBroker({connectionPool:e,logger:this.rootLogger})}async connect(){if(!this.hasConnectedBrokers())return this.seedBroker||await this.createSeedBroker(),this.retrier((async(e,t,r)=>{try{await this.seedBroker.connect(),this.versions=this.seedBroker.versions}catch(o){if("KafkaJSConnectionError"===o.name||"ILLEGAL_SASL_STATE"===o.type?(await this.createSeedBroker(),this.logger.error(`Failed to connect to seed broker, trying another broker from the list: ${o.message}`,{retryCount:t,retryTime:r})):this.logger.error(o.message,{retryCount:t,retryTime:r}),o.retriable)throw o;e(o)}}))}async disconnect(){this.seedBroker&&await this.seedBroker.disconnect(),await Promise.all(u(this.brokers).map((e=>e.disconnect()))),this.brokers={},this.metadata=null,this.versions=null}removeBroker({host:e,port:t}){const r=u(this.brokers).find((r=>r.connectionPool.host===e&&r.connectionPool.port===t));r&&(delete this.brokers[r.nodeId],this.metadataExpireAt=null,this.seedBroker.nodeId===r.nodeId&&(this.seedBroker=i(u(this.brokers))[0]))}async refreshMetadata(e){const t=await this.findConnectedBroker(),{host:r,port:o}=this.seedBroker.connectionPool;return this.retrier((async(s,i,a)=>{try{this.metadata=await t.metadata(e),this.metadataExpireAt=Date.now()+this.metadataMaxAge;const s=[];this.brokers=await this.metadata.brokers.reduce((async(e,{nodeId:t,host:i,port:n,rack:a})=>{const c=await e;if(c[t]){if(!((e,{host:t,port:r,rack:o})=>e.connectionPool.host!==t||e.connectionPool.port!==r||e.connectionPool.rack!==o)(c[t],{host:i,port:n,rack:a}))return c;s.push(c[t])}return i===r&&n===o?(this.seedBroker.nodeId=t,this.seedBroker.connectionPool.rack=a,d(c,{[t]:this.seedBroker})):d(c,{[t]:this.createBroker({logger:this.rootLogger,versions:this.versions,connectionPool:await this.connectionPoolBuilder.build({host:i,port:n,rack:a}),nodeId:t})})}),this.brokers);const i=this.metadata.brokers.map((({nodeId:e})=>`${e}`)).sort(),a=p(this.brokers).sort(),c=n(a,i).map((e=>this.brokers[e].disconnect().then((()=>{delete this.brokers[e]})))),u=s.map((e=>e.disconnect()));await Promise.all([...c,...u])}catch(e){if("LEADER_NOT_AVAILABLE"===e.type)throw e;s(e)}}))}async refreshMetadataIfNecessary(e){if(null==this.metadata||null==this.metadataExpireAt||Date.now()>this.metadataExpireAt||!e.every((e=>this.metadata.topicMetadata.some((t=>t.topic===e)))))return this.refreshMetadata(e)}getNodeIds(){return p(this.brokers)}async findBroker({nodeId:e}){const t=this.brokers[e];if(!t)throw new a(`Broker ${e} not found in the cached metadata`);return await this.connectBroker(t),t}async withBroker(e){const t=i(p(this.brokers));if(0===t.length)throw new a("No brokers in the broker pool");for(const r of t){const t=await this.findBroker({nodeId:r});try{return await e({nodeId:r,broker:t})}catch(e){}}return null}async findConnectedBroker(){const e=i(p(this.brokers)),t=e.find((e=>this.brokers[e].isConnected()));if(t)return await this.findBroker({nodeId:t});for(const t of e)try{return await this.findBroker({nodeId:t})}catch(e){}return await this.connect(),this.seedBroker}async connectBroker(e){if(!e.isConnected())return this.retrier((async(t,r,o)=>{try{await e.connect()}catch(s){if("KafkaJSConnectionError"!==s.name&&"ILLEGAL_SASL_STATE"!==s.type||await e.disconnect(),"KafkaJSConnectionError"===s.name)return t(s);if("ILLEGAL_SASL_STATE"===s.type)throw e.connectionPool=await this.connectionPoolBuilder.build({host:e.connectionPool.host,port:e.connectionPool.port,rack:e.connectionPool.rack}),this.logger.error("Failed to connect to broker, reconnecting",{retryCount:r,retryTime:o}),new c(s,{retriable:!0});if(s.retriable)throw s;this.logger.error(s,{retryCount:r,retryTime:o,stack:s.stack}),t(s)}}))}}},6973:(e,t,r)=>{const{KafkaJSConnectionError:o,KafkaJSNonRetriableError:s}=r(9879),i=r(8661);e.exports=({socketFactory:e,brokers:t,ssl:r,sasl:n,clientId:a,requestTimeout:c,enforceRequestTimeout:p,connectionTimeout:d,maxInFlightRequests:u,logger:l,instrumentationEmitter:h=null,reauthenticationThreshold:m})=>{let f=0;return{build:async({host:g,port:I,rack:y}={})=>{if(!g){const e=await(async()=>{let e;if("function"==typeof t)try{e=await t()}catch(e){const t=new o(`Failed to connect: "config.brokers" threw: ${e.message}`);throw t.stack=`${t.name}\n  Caused by: ${e.stack}`,t}else e=t;return(e=>{if(!e)throw new s("Failed to connect: brokers should not be null");if(Array.isArray(e)){if(!e.length)throw new s("Failed to connect: brokers array is empty");e.forEach(((e,t)=>{if(!(e=>e&&"string"==typeof e&&e.length>0)(e))throw new s(`Failed to connect: broker at index ${t} is invalid "${typeof e}"`)}))}})(e),e})(),r=e[f++%e.length];g=r.split(":")[0],I=Number(r.split(":")[1])}return new i({host:g,port:I,rack:y,sasl:n,ssl:r,clientId:a,socketFactory:e,connectionTimeout:d,requestTimeout:c,enforceRequestTimeout:p,maxInFlightRequests:u,instrumentationEmitter:h,logger:l,reauthenticationThreshold:m})}}}},8048:(e,t,r)=>{const o=r(1625),s=r(4105),i=r(9026),n=r(9701),a=r(6973),{EARLIEST_OFFSET:c,LATEST_OFFSET:p}=r(3904),{KafkaJSError:d,KafkaJSBrokerNotFound:u,KafkaJSMetadataNotLoaded:l,KafkaJSTopicMetadataNotLoaded:h,KafkaJSGroupCoordinatorNotFound:m}=r(9879),f=r(7022),{keys:g}=Object,I=(e,{topic:t,partitions:r})=>({...e,[t]:[...e[t]||[],...r]}),y=Symbol("private:Cluster:connect"),w=Symbol("private:Cluster:refreshMetadata"),T=Symbol("private:Cluster:refreshMetadataIfNecessary"),E=Symbol("private:Cluster:findControllerBroker");e.exports=class{constructor({logger:e,socketFactory:t,brokers:r,ssl:c,sasl:p,clientId:d,connectionTimeout:h,authenticationTimeout:m,reauthenticationThreshold:f,requestTimeout:g=3e4,enforceRequestTimeout:I,metadataMaxAge:b,retry:S,allowAutoTopicCreation:A,maxInFlightRequests:O,isolationLevel:C,instrumentationEmitter:N=null,offsets:R=new Map}){this.rootLogger=e,this.logger=e.namespace("Cluster"),this.retrier=n(S),this.connectionPoolBuilder=a({logger:e,instrumentationEmitter:N,socketFactory:t,brokers:r,ssl:c,sasl:p,clientId:d,connectionTimeout:h,requestTimeout:g,enforceRequestTimeout:I,maxInFlightRequests:O,reauthenticationThreshold:f}),this.targetTopics=new Set,this.mutatingTargetTopics=new s({description:"updating target topics",timeout:g}),this.isolationLevel=C,this.brokerPool=new o({connectionPoolBuilder:this.connectionPoolBuilder,logger:this.rootLogger,retry:S,allowAutoTopicCreation:A,authenticationTimeout:m,metadataMaxAge:b}),this.committedOffsetsByGroup=R,this[y]=i((async()=>await this.brokerPool.connect())),this[w]=i((async()=>await this.brokerPool.refreshMetadata(Array.from(this.targetTopics)))),this[T]=i((async()=>await this.brokerPool.refreshMetadataIfNecessary(Array.from(this.targetTopics)))),this[E]=i((async()=>{const{metadata:e}=this.brokerPool;if(!e||null==e.controllerId)throw new l("Topic metadata not loaded");const t=await this.findBroker({nodeId:e.controllerId});if(!t)throw new u(`Controller broker with id ${e.controllerId} not found in the cached metadata`);return t}))}isConnected(){return this.brokerPool.hasConnectedBrokers()}async connect(){await this[y]()}async disconnect(){await this.brokerPool.disconnect()}removeBroker({host:e,port:t}){this.brokerPool.removeBroker({host:e,port:t})}async refreshMetadata(){await this[w]()}async refreshMetadataIfNecessary(){await this[T]()}async metadata({topics:e=[]}={}){return this.retrier((async(t,r,o)=>{try{return await this.brokerPool.refreshMetadataIfNecessary(e),this.brokerPool.withBroker((async({broker:t})=>t.metadata(e)))}catch(e){if("LEADER_NOT_AVAILABLE"===e.type)throw e;t(e)}}))}async addTargetTopic(e){return this.addMultipleTargetTopics([e])}async addMultipleTargetTopics(e){await this.mutatingTargetTopics.acquire();try{const t=this.targetTopics.size,r=new Set(this.targetTopics);for(const t of e)this.targetTopics.add(t);if(t!==this.targetTopics.size||!this.brokerPool.metadata)try{await this.refreshMetadata()}catch(e){throw"INVALID_TOPIC_EXCEPTION"!==e.type&&"UNKNOWN_TOPIC_OR_PARTITION"!==e.type&&"TOPIC_AUTHORIZATION_FAILED"!==e.type||(this.targetTopics=r),e}}finally{await this.mutatingTargetTopics.release()}}getNodeIds(){return this.brokerPool.getNodeIds()}async findBroker({nodeId:e}){try{return await this.brokerPool.findBroker({nodeId:e})}catch(e){throw"KafkaJSBrokerNotFound"!==e.name&&"KafkaJSLockTimeout"!==e.name&&"KafkaJSConnectionError"!==e.name||await this.refreshMetadata(),e}}async findControllerBroker(){return await this[E]()}findTopicPartitionMetadata(e){const{metadata:t}=this.brokerPool;if(!t||!t.topicMetadata)throw new h("Topic metadata not loaded",{topic:e});const r=t.topicMetadata.find((t=>t.topic===e));return r?r.partitionMetadata:[]}findLeaderForPartitions(e,t){const r=this.findTopicPartitionMetadata(e);return t.reduce(((t,o)=>{const s=parseInt(o,10),i=r.find((e=>e.partitionId===s));if(!i)return t;if(null===i.leader||void 0===i.leader)throw new d("Invalid partition metadata",{topic:e,partitionId:s,metadata:i});const{leader:n}=i,a=t[n]||[];return{...t,[n]:[...a,s]}}),{})}async findGroupCoordinator({groupId:e,coordinatorType:t=f.GROUP}){return this.retrier((async(r,o,s)=>{try{const{coordinator:r}=await this.findGroupCoordinatorMetadata({groupId:e,coordinatorType:t});return await this.findBroker({nodeId:r.nodeId})}catch(t){if("KafkaJSBrokerNotFound"===t.name||"GROUP_COORDINATOR_NOT_AVAILABLE"===t.type)throw this.logger.debug(`${t.message}, refreshing metadata and trying again...`,{groupId:e,retryCount:o,retryTime:s}),await this.refreshMetadata(),t;if("ECONNREFUSED"===t.code)throw t;r(t)}}))}async findGroupCoordinatorMetadata({groupId:e,coordinatorType:t}){const r=await this.brokerPool.withBroker((async({nodeId:r,broker:o})=>await this.retrier((async(s,i,n)=>{try{const r=await o.findGroupCoordinator({groupId:e,coordinatorType:t});return this.logger.debug("Found group coordinator",{broker:r.host,nodeId:r.coordinator.nodeId}),r}catch(e){if(this.logger.debug("Tried to find group coordinator",{nodeId:r,error:e}),"GROUP_COORDINATOR_NOT_AVAILABLE"===e.type)throw this.logger.debug("Group coordinator not available, retrying...",{nodeId:r,retryCount:i,retryTime:n}),e;s(e)}}))));if(r)return r;throw new m("Failed to find group coordinator")}defaultOffset({fromBeginning:e}){return e?c:p}async fetchTopicsOffset(e){const t={},r={},o=e=>t=>{const{timestamp:o}=r[e];return{...t,timestamp:o}};for(const o of e){const{topic:e,partitions:s,fromBeginning:i,fromTimestamp:n}=o,a=this.findLeaderForPartitions(e,s.map((e=>e.partition))),c=null!=n?n:this.defaultOffset({fromBeginning:i});r[e]={timestamp:c},g(a).forEach((r=>{t[r]=t[r]||{},t[r][e]=s.filter((e=>a[r].includes(e.partition)))}))}const s=g(t).map((async e=>{const r=await this.findBroker({nodeId:e}),s=t[e],{responses:i}=await r.listOffsets({isolationLevel:this.isolationLevel,topics:g(s).map((e=>({topic:e,partitions:s[e].map(o(e))})))});return i})),i=(await Promise.all(s)).flat().reduce(I,{});return g(i).map((e=>({topic:e,partitions:i[e].map((({partition:e,offset:t})=>({partition:e,offset:t})))})))}committedOffsets({groupId:e}){return this.committedOffsetsByGroup.has(e)||this.committedOffsetsByGroup.set(e,{}),this.committedOffsetsByGroup.get(e)}markOffsetAsCommitted({groupId:e,topic:t,partition:r,offset:o}){const s=this.committedOffsets({groupId:e});s[t]=s[t]||{},s[t][r]=o}}},3904:e=>{const t=Math.pow(2,31)-1;e.exports={EARLIEST_OFFSET:-2,LATEST_OFFSET:-1,INT_32_MAX_VALUE:t}},737:(e,t,r)=>{const o=r(8783),s=r(6341),i={encode:({version:e,topics:t,userData:r=Buffer.alloc(0)})=>(new o).writeInt16(e).writeArray(t).writeBytes(r).buffer,decode(e){const t=new s(e);return{version:t.readInt16(),topics:t.readArray((e=>e.readString())),userData:t.readBytes()}}},n={encode:({version:e,assignment:t,userData:r=Buffer.alloc(0)})=>(new o).writeInt16(e).writeArray(Object.keys(t).map((e=>(new o).writeString(e).writeArray(t[e])))).writeBytes(r).buffer,decode(e){const t=new s(e),r=e=>e.readInt32();return t.canReadInt16()?{version:t.readInt16(),assignment:t.readArray((e=>({topic:e.readString(),partitions:e.readArray(r)}))).reduce(((e,{topic:t,partitions:r})=>Object.assign(e,{[t]:r})),{}),userData:t.readBytes()}:null}};e.exports={MemberMetadata:i,MemberAssignment:n}},6996:(e,t,r)=>{const o=r(2786);e.exports={roundRobin:o}},2786:(e,t,r)=>{const{MemberMetadata:o,MemberAssignment:s}=r(737);e.exports=({cluster:e})=>({name:"RoundRobinAssigner",version:1,async assign({members:t,topics:r}){const o=t.length,i=t.map((({memberId:e})=>e)).sort(),n={};return r.flatMap((t=>e.findTopicPartitionMetadata(t).map((e=>({topic:t,partitionId:e.partitionId}))))).forEach(((e,t)=>{const r=i[t%o];n[r]||(n[r]=Object.create(null)),n[r][e.topic]||(n[r][e.topic]=[]),n[r][e.topic].push(e.partitionId)})),Object.keys(n).map((e=>({memberId:e,memberAssignment:s.encode({version:this.version,assignment:n[e]})})))},protocol({topics:e}){return{name:this.name,metadata:o.encode({version:this.version,topics:e})}}})},3529:(e,t,r)=>{const o=r(3278),s=r(2948);e.exports=class{constructor(e,t,r){this.fetchedOffset=t;const i=o.fromValue(this.fetchedOffset),{abortedTransactions:n,messages:a}=r;this.topic=e,this.partition=r.partition,this.highWatermark=r.highWatermark,this.rawMessages=a,this.messagesWithinOffset=this.rawMessages.filter((e=>o.fromValue(e.offset).gte(i))),this.messages=s({messages:this.messagesWithinOffset,abortedTransactions:n}).filter((e=>!e.isControlRecord))}isEmpty(){return 0===this.messages.length}isEmptyIncludingFiltered(){return 0===this.messagesWithinOffset.length}isEmptyDueToFiltering(){return this.isEmpty()&&this.rawMessages.length>0}isEmptyControlRecord(){return this.isEmpty()&&this.messagesWithinOffset.some((({isControlRecord:e})=>e))}isEmptyDueToLogCompactedMessages(){return this.rawMessages.length>0&&this.isEmptyIncludingFiltered()}firstOffset(){return this.isEmptyIncludingFiltered()?null:this.messagesWithinOffset[0].offset}lastOffset(){return this.isEmptyDueToLogCompactedMessages()?this.fetchedOffset:this.isEmptyIncludingFiltered()?o.fromValue(this.highWatermark).add(-1).toString():this.messagesWithinOffset[this.messagesWithinOffset.length-1].offset}offsetLag(){const e=o.fromValue(this.highWatermark).add(-1),t=o.fromValue(this.lastOffset());return e.add(t.multiply(-1)).toString()}offsetLagLow(){if(this.isEmptyIncludingFiltered())return"0";const e=o.fromValue(this.highWatermark).add(-1),t=o.fromValue(this.firstOffset());return e.add(t.multiply(-1)).toString()}}},19:(e,t,r)=>{const o=r(4742),s=r(6779),i=r(8351),n=r(9701),a=r(9026),c=r(1770),p=r(3529),d=r(2499),u=r(1381),{events:{GROUP_JOIN:l,HEARTBEAT:h,CONNECT:m,RECEIVED_UNSUBSCRIBED_TOPICS:f}}=r(9311),{MemberAssignment:g}=r(737),{KafkaJSError:I,KafkaJSNonRetriableError:y,KafkaJSStaleTopicMetadataAssignment:w,isRebalancing:T}=r(9879),{keys:E}=Object,b=["LEADER_NOT_AVAILABLE","NOT_LEADER_FOR_PARTITION","FENCED_LEADER_EPOCH","UNKNOWN_LEADER_EPOCH","UNKNOWN_TOPIC_OR_PARTITION"],S=Symbol("private:ConsumerGroup:join"),A=Symbol("private:ConsumerGroup:sync"),O=Symbol("private:ConsumerGroup:sharedHeartbeat");e.exports=class{constructor({retry:e,cluster:t,groupId:r,topics:o,topicConfigurations:s,logger:i,instrumentationEmitter:c,assigners:p,sessionTimeout:l,rebalanceTimeout:m,maxBytesPerPartition:f,minBytes:g,maxBytes:I,maxWaitTimeInMs:y,autoCommit:w,autoCommitInterval:T,autoCommitThreshold:E,isolationLevel:b,rackId:S,metadataMaxAge:A}){this.cluster=t,this.groupId=r,this.topics=o,this.topicsSubscribed=o,this.topicConfigurations=s,this.logger=i.namespace("ConsumerGroup"),this.instrumentationEmitter=c,this.retrier=n(Object.assign({},e)),this.assigners=p,this.sessionTimeout=l,this.rebalanceTimeout=m,this.maxBytesPerPartition=f,this.minBytes=g,this.maxBytes=I,this.maxWaitTime=y,this.autoCommit=w,this.autoCommitInterval=T,this.autoCommitThreshold=E,this.isolationLevel=b,this.rackId=S,this.metadataMaxAge=A,this.seekOffset=new d,this.coordinator=null,this.generationId=null,this.leaderId=null,this.memberId=null,this.members=null,this.groupProtocol=null,this.partitionsPerSubscribedTopic=null,this.preferredReadReplicasPerTopicPartition={},this.offsetManager=null,this.subscriptionState=new u,this.lastRequest=Date.now(),this[O]=a((async({interval:e})=>{const{groupId:t,generationId:r,memberId:o}=this,s=Date.now();if(o&&s>=this.lastRequest+e){const e={groupId:t,memberId:o,groupGenerationId:r};await this.coordinator.heartbeat(e),this.instrumentationEmitter.emit(h,e),this.lastRequest=Date.now()}}))}isLeader(){return this.leaderId&&this.memberId===this.leaderId}getNodeIds(){return this.cluster.getNodeIds()}async connect(){await this.cluster.connect(),this.instrumentationEmitter.emit(m),await this.cluster.refreshMetadataIfNecessary()}async[S](){const{groupId:e,sessionTimeout:t,rebalanceTimeout:r}=this;this.coordinator=await this.cluster.findGroupCoordinator({groupId:e});const o=await this.coordinator.joinGroup({groupId:e,sessionTimeout:t,rebalanceTimeout:r,memberId:this.memberId||"",groupProtocols:this.assigners.map((e=>e.protocol({topics:this.topicsSubscribed})))});this.generationId=o.generationId,this.leaderId=o.leaderId,this.memberId=o.memberId,this.members=o.members,this.groupProtocol=o.groupProtocol}async leave(){const{groupId:e,memberId:t}=this;t&&(await this.coordinator.leaveGroup({groupId:e,memberId:t}),this.memberId=null)}async[A](){let e=[];const{groupId:t,generationId:r,memberId:o,members:n,groupProtocol:a,topics:p,topicsSubscribed:d,coordinator:u}=this;if(this.isLeader()){this.logger.debug("Chosen as group leader",{groupId:t,generationId:r,memberId:o,topics:p});const s=this.assigners.find((({name:e})=>e===a));if(!s)throw new y(`Unsupported partition assigner "${a}", the assigner wasn't found in the assigners list`);await this.cluster.refreshMetadata(),e=await s.assign({members:n,topics:d}),this.logger.debug("Group assignment",{groupId:t,generationId:r,groupProtocol:a,assignment:e,topics:d})}this.partitionsPerSubscribedTopic=this.generatePartitionsPerSubscribedTopic();const{memberAssignment:l}=await this.coordinator.syncGroup({groupId:t,generationId:r,memberId:o,groupAssignment:e}),h=g.decode(l),m=null!=h?h.assignment:{};this.logger.debug("Received assignment",{groupId:t,generationId:r,memberId:o,memberAssignment:m});const I=E(m),w=i(I,d);if(w.length>0){const e={groupId:t,generationId:r,memberId:o,assignedTopics:I,topicsSubscribed:d,topicsNotSubscribed:w};this.instrumentationEmitter.emit(f,e),this.logger.warn("Consumer group received unsubscribed topics",{...e,helpUrl:s("docs/faq","why-am-i-receiving-messages-for-topics-i-m-not-subscribed-to")})}const T=i(I,w).map((e=>({topic:e,partitions:m[e]})));for(const e of T){const{topic:s,partitions:i}=e,n=this.partitionsPerSubscribedTopic.get(s);if(!i.every((e=>n.includes(e)))){this.logger.warn("Consumer is not aware of all assigned partitions, refreshing metadata",{groupId:t,generationId:r,memberId:o,topic:s,knownPartitions:n,assignedPartitions:i}),await this.cluster.refreshMetadata(),this.partitionsPerSubscribedTopic=this.generatePartitionsPerSubscribedTopic();break}}this.topics=T.map((({topic:e})=>e)),this.subscriptionState.assign(T),this.offsetManager=new c({cluster:this.cluster,topicConfigurations:this.topicConfigurations,instrumentationEmitter:this.instrumentationEmitter,memberAssignment:T.reduce(((e,{topic:t,partitions:r})=>({...e,[t]:r})),{}),autoCommit:this.autoCommit,autoCommitInterval:this.autoCommitInterval,autoCommitThreshold:this.autoCommitThreshold,coordinator:u,groupId:t,generationId:r,memberId:o})}joinAndSync(){const e=Date.now();return this.retrier((async t=>{try{await this[S](),await this[A]();const t=this.assigned().reduce(((e,{topic:t,partitions:r})=>({...e,[t]:r})),{}),r={groupId:this.groupId,memberId:this.memberId,leaderId:this.leaderId,isLeader:this.isLeader(),memberAssignment:t,groupProtocol:this.groupProtocol,duration:Date.now()-e};this.instrumentationEmitter.emit(l,r),this.logger.info("Consumer has joined the group",r)}catch(e){if(T(e))throw new I(e);if("UNKNOWN_MEMBER_ID"===e.type)throw this.memberId=null,new I(e);t(e)}}))}resetOffset({topic:e,partition:t}){this.offsetManager.resetOffset({topic:e,partition:t})}resolveOffset({topic:e,partition:t,offset:r}){this.offsetManager.resolveOffset({topic:e,partition:t,offset:r})}seek({topic:e,partition:t,offset:r}){this.seekOffset.set(e,t,r)}pause(e){this.logger.info(`Pausing fetching from ${e.length} topics`,{topicPartitions:e}),this.subscriptionState.pause(e)}resume(e){this.logger.info(`Resuming fetching from ${e.length} topics`,{topicPartitions:e}),this.subscriptionState.resume(e)}assigned(){return this.subscriptionState.assigned()}paused(){return this.subscriptionState.paused()}isPaused(e,t){return this.subscriptionState.isPaused(e,t)}async commitOffsetsIfNecessary(){await this.offsetManager.commitOffsetsIfNecessary()}async commitOffsets(e){await this.offsetManager.commitOffsets(e)}uncommittedOffsets(){return this.offsetManager.uncommittedOffsets()}async heartbeat({interval:e}){return this[O]({interval:e})}async fetch(e){try{await this.cluster.refreshMetadataIfNecessary(),this.checkForStaleAssignment();let t=this.subscriptionState.assigned();t=this.filterPartitionsByNode(e,t),await this.seekOffsets(t);const r=this.offsetManager.committedOffsets(),s=this.getActiveTopicPartitions(),i=t.map((({topic:e,partitions:t})=>({topic:e,partitions:t.filter((t=>null!=r[e][t]&&s[e].has(t))).map((t=>({partition:t,fetchOffset:this.offsetManager.nextOffset(e,t).toString(),maxBytes:this.maxBytesPerPartition})))}))).filter((({partitions:e})=>e.length));if(!i.length)return await o(this.maxWaitTime),[];const n=await this.cluster.findBroker({nodeId:e}),{responses:a}=await n.fetch({maxWaitTime:this.maxWaitTime,minBytes:this.minBytes,maxBytes:this.maxBytes,isolationLevel:this.isolationLevel,topics:i,rackId:this.rackId});return a.flatMap((({topicName:e,partitions:t})=>{const r=i.find((({topic:t})=>t===e));let o=this.preferredReadReplicasPerTopicPartition[e];return o||(this.preferredReadReplicasPerTopicPartition[e]=o={}),t.filter((({partition:t})=>!this.seekOffset.has(e,t)&&!this.subscriptionState.isPaused(e,t))).map((t=>{const{partition:s,preferredReadReplica:i}=t;if(null!=i&&-1!==i){const{nodeId:t}=o[s]||{};t!==i&&this.logger.info(`Preferred read replica is now ${i}`,{groupId:this.groupId,memberId:this.memberId,topic:e,partition:s}),o[s]={nodeId:i,expireAt:Date.now()+this.metadataMaxAge}}const n=r.partitions.find((({partition:e})=>e===t.partition)),a=n.fetchOffset;return new p(e,a,t)}))}))}catch(e){return await this.recoverFromFetch(e),[]}}async recoverFromFetch(e){if(b.includes(e.type)||"KafkaJSTopicMetadataNotLoaded"===e.name)return this.logger.debug("Stale cluster metadata, refreshing...",{groupId:this.groupId,memberId:this.memberId,error:e.message}),await this.cluster.refreshMetadata(),void await this.joinAndSync();if("KafkaJSStaleTopicMetadataAssignment"===e.name)return this.logger.warn(`${e.message}, resync group`,{groupId:this.groupId,memberId:this.memberId,topic:e.topic,unknownPartitions:e.unknownPartitions}),void await this.joinAndSync();if("KafkaJSOffsetOutOfRange"!==e.name){if("KafkaJSConnectionClosedError"!==e.name){if("KafkaJSBrokerNotFound"===e.name||"KafkaJSConnectionClosedError"===e.name)return this.logger.debug(`${e.message}, refreshing metadata and retrying...`),void await this.cluster.refreshMetadata();throw e}this.cluster.removeBroker({host:e.host,port:e.port})}else await this.recoverFromOffsetOutOfRange(e)}async recoverFromOffsetOutOfRange(e){const t=this.preferredReadReplicasPerTopicPartition[e.topic];t&&"number"==typeof t[e.partition]?(this.logger.info("Offset out of range while fetching from follower, retrying with leader",{topic:e.topic,partition:e.partition,groupId:this.groupId,memberId:this.memberId}),delete t[e.partition]):(this.logger.error("Offset out of range, resetting to default offset",{topic:e.topic,partition:e.partition,groupId:this.groupId,memberId:this.memberId}),await this.offsetManager.setDefaultOffset({topic:e.topic,partition:e.partition}))}generatePartitionsPerSubscribedTopic(){const e=new Map;for(const t of this.topicsSubscribed){const r=this.cluster.findTopicPartitionMetadata(t).map((e=>e.partitionId)).sort();e.set(t,r)}return e}checkForStaleAssignment(){if(!this.partitionsPerSubscribedTopic)return;const e=this.generatePartitionsPerSubscribedTopic();for(const[t,r]of e){const e=i(r,this.partitionsPerSubscribedTopic.get(t));if(e.length>0)throw new w("Topic has been updated",{topic:t,unknownPartitions:e})}}async seekOffsets(e){for(const{topic:t,partitions:r}of e)for(const e of r){const r=this.seekOffset.pop(t,e);r&&(this.logger.debug("Seek offset",{groupId:this.groupId,memberId:this.memberId,seek:r}),await this.offsetManager.seek(r))}await this.offsetManager.resolveOffsets()}hasSeekOffset({topic:e,partition:t}){return this.seekOffset.has(e,t)}findReadReplicaForPartitions(e,t){const r=this.cluster.findTopicPartitionMetadata(e),o=this.preferredReadReplicasPerTopicPartition[e];return t.reduce(((t,s)=>{const i=parseInt(s,10),n=r.find((e=>e.partitionId===i));if(!n)return t;if(null==n.leader)throw new I("Invalid partition metadata",{topic:e,partitionId:i,metadata:n});let a=n.leader;if(o){const{nodeId:t,expireAt:r}=o[i]||{};if(Date.now()>=r)this.logger.debug("Preferred read replica information has expired, using leader",{topic:e,partitionId:i,groupId:this.groupId,memberId:this.memberId,preferredReadReplica:t,leader:n.leader}),delete o[i];else if(null!=t){const r=n.offlineReplicas;Array.isArray(r)&&r.includes(a)?this.logger.debug("Preferred read replica is offline, using leader",{topic:e,partitionId:i,groupId:this.groupId,memberId:this.memberId,preferredReadReplica:t,leader:n.leader}):a=t}}const c=t[a]||[];return{...t,[a]:[...c,i]}}),{})}filterPartitionsByNode(e,t){return t.map((({topic:t,partitions:r})=>({topic:t,partitions:this.findReadReplicaForPartitions(t,r)[e]||[]})))}getActiveTopicPartitions(){return this.subscriptionState.active().reduce(((e,{topic:t,partitions:r})=>({...e,[t]:new Set(r)})),{})}}},8359:(e,t,r)=>{const o=r(8217),s=r(244),i=r(8125),n=r(9689),{KafkaJSFetcherRebalanceError:a}=r(9879);e.exports=({logger:e,getNodeIds:t,fetch:r,handler:c,concurrency:p=1})=>{const d=e.namespace("FetchManager"),u=o(p,(e=>i({handler:c,workerId:e}))),l=n({workers:u});let h=[];const m=()=>{const e=t(),o=new Map,i=e.map((i=>s({nodeId:i,workerQueue:l,partitionAssignments:o,fetch:async o=>((()=>{const r=t();if((e.length!==r.length||e.some((e=>!r.includes(e))))&&0!==r.length)throw new a})(),r(o)),logger:d})));return d.debug(`Created ${i.length} fetchers`,{nodeIds:e,concurrency:p}),i},f=async()=>{d.debug("Stopping fetchers..."),await Promise.all(h.map((e=>e.stop()))),d.debug("Stopped fetchers")};return{start:async()=>{for(d.debug("Starting...");;){h=m();try{await Promise.all(h.map((e=>e.start())))}catch(e){if(await f(),e instanceof a){d.debug("Rebalancing fetchers...");continue}throw e}break}},stop:f,getFetchers:()=>h}}},244:(e,t,r)=>{const o=r(2361);e.exports=({nodeId:e,workerQueue:t,partitionAssignments:r,fetch:s,logger:i})=>{const n=i.namespace(`Fetcher ${e}`),a=new o;let c=!1;const p=({topic:e,partition:t})=>`${e}|${t}`,d=t=>r.set(p(t),e),u=e=>r.delete(p(e)),l=t=>t.filter((t=>{const o=(e=>r.get(p(e)))(t);return null==o||o===e||(n.info("Filtering out batch due to partition already being processed by another fetcher",{topic:t.topic,partition:t.partition,assignedFetcher:o,fetcher:e}),!1)}));return{start:async()=>{if(!c){for(c=!0;c;)try{const r=await s(e);if(c){const e=l(r);if(e.length>0){e.forEach(d);try{await t.push(...e)}finally{e.forEach(u)}}}}catch(e){throw c=!1,a.emit("end"),e}a.emit("end")}},stop:async()=>{c&&(c=!1,await new Promise((e=>a.once("end",(()=>e())))))},getWorkerQueue:()=>t}}},2948:(e,t,r)=>{const o=r(3278),s=Buffer.from([0,0,0,0]);e.exports=({messages:e,abortedTransactions:t})=>{const r=new Map;if(!t||!t.length)return e;const i=[...t];return e.filter((e=>{if(i.length&&o.fromValue(e.offset).gte(i[0].firstOffset)){const{producerId:e}=i.shift();r.set(e,!0)}const{producerId:t,inTransaction:n}=e.batchContext;if((({key:e})=>!!e&&Buffer.from(e).equals(s))(e))r.delete(t);else if(r.has(t)&&n)return!1;return!0}))}},763:(e,t,r)=>{const o=r(3278),s=r(9701),{initialRetryTime:i}=r(7727),n=r(19),a=r(2436),{events:c,wrap:p,unwrap:d}=r(9311),u=r(2190),{KafkaJSNonRetriableError:l}=r(9879),{roundRobin:h}=r(6996),{EARLIEST_OFFSET:m,LATEST_OFFSET:f}=r(3904),g=r(2845),I=r(9026),{keys:y,values:w}=Object,{CONNECT:T,DISCONNECT:E,STOP:b,CRASH:S}=c,A=w(c),O=y(c).map((e=>`consumer.events.${e}`)).join(", "),C=[o.fromValue(m).toString(),o.fromValue(f).toString()];e.exports=({cluster:e,groupId:t,retry:r,logger:m,partitionAssigners:f=[h],sessionTimeout:w=3e4,rebalanceTimeout:N=6e4,heartbeatInterval:R=3e3,maxBytesPerPartition:k=1048576,minBytes:x=1,maxBytes:v=10485760,maxWaitTimeInMs:_=5e3,isolationLevel:B=g.READ_COMMITTED,rackId:P="",instrumentationEmitter:D,metadataMaxAge:L})=>{if(!t)throw new l("Consumer groupId must be a non-empty string.");const M=m.namespace("Consumer"),q=D||new u,K=f.map((r=>r({groupId:t,logger:M,cluster:e}))),V={};let G=null,U=null,F=null;if(R>=w)throw new l(`Consumer heartbeatInterval (${R}) must be lower than sessionTimeout (${w}). It is recommended to set heartbeatInterval to approximately a third of the sessionTimeout.`);const j=async()=>{try{await $(),M.debug("consumer has stopped, disconnecting",{groupId:t}),await e.disconnect(),q.emit(E)}catch(e){throw M.error(`Caught error when disconnecting the consumer: ${e.message}`,{stack:e.stack,groupId:t}),e}},$=I((async()=>{try{G&&(await G.stop(),G=null,U=null,q.emit(b)),clearTimeout(F),M.info("Stopped",{groupId:t})}catch(e){throw M.error(`Caught error when stopping the consumer: ${e.message}`,{stack:e.stack,groupId:t}),e}}));return{connect:async()=>{await e.connect(),q.emit(T)},disconnect:j,subscribe:async({topic:r,topics:o,fromBeginning:s=!1})=>{if(U)throw new l("Cannot subscribe to topic while consumer is running");if(!r&&!o)throw new l('Missing required argument "topics"');if(null!=o&&!Array.isArray(o))throw new l('Argument "topics" must be an array');const i=o||[r];for(const e of i)if("string"!=typeof e&&!(e instanceof RegExp))throw new l(`Invalid topic ${e} (${typeof e}), the topic name has to be a String or a RegExp`);const n=i.some((e=>e instanceof RegExp))?await e.metadata():void 0,a=[];for(const e of i)if(e instanceof RegExp){const r=e,o=n.topicMetadata.map((({topic:e})=>e)).filter((e=>r.test(e)));M.debug("Subscription based on RegExp",{groupId:t,topicRegExp:r.toString(),matchedTopics:o}),a.push(...o)}else a.push(e);for(const e of a)V[e]={fromBeginning:s};await e.addMultipleTargetTopics(a)},stop:$,run:async({autoCommit:o=!0,autoCommitInterval:s=null,autoCommitThreshold:c=null,eachBatchAutoResolve:p=!0,partitionsConsumedConcurrently:d=1,eachBatch:u=null,eachMessage:l=null}={})=>{if(U)return void M.warn("consumer#run was called, but the consumer is already running",{groupId:t});const h=async i=>{M.info("Starting",{groupId:t}),U=new n({logger:m,topics:y(V),topicConfigurations:V,retry:r,cluster:e,groupId:t,assigners:K,sessionTimeout:w,rebalanceTimeout:N,maxBytesPerPartition:k,minBytes:x,maxBytes:v,maxWaitTimeInMs:_,instrumentationEmitter:q,isolationLevel:B,rackId:P,metadataMaxAge:L,autoCommit:o,autoCommitInterval:s,autoCommitThreshold:c}),G=new a({logger:m,consumerGroup:U,instrumentationEmitter:q,heartbeatInterval:R,retry:r,autoCommit:o,eachBatchAutoResolve:p,eachBatch:u,eachMessage:l,onCrash:i,concurrency:d}),await G.start()},f=async o=>{M.error(`Crash: ${o.name}: ${o.message}`,{groupId:t,retryCount:o.retryCount,stack:o.stack}),"KafkaJSConnectionClosedError"===o.name&&e.removeBroker({host:o.host,port:o.port}),await j();const s=e=>e.cause?s(e.cause):e,n=("KafkaJSNumberOfRetriesExceeded"===o.name||!0===s(o).retriable)&&(!r||!r.restartOnFailure||await r.restartOnFailure(o).catch((e=>(M.error('Caught error when invoking user-provided "restartOnFailure" callback. Defaulting to restarting.',{error:e.message||e,cause:o.message||o,groupId:t}),!0))));if(q.emit(S,{error:o,groupId:t,restart:n}),n){const e=o.retryTime||r&&r.initialRetryTime||i;M.error(`Restarting the consumer in ${e}ms`,{retryCount:o.retryCount,retryTime:e,groupId:t}),F=setTimeout((()=>h(f)),e)}};await h(f)},commitOffsets:async(e=[])=>{const t=e.reduce(((e,{topic:t,partition:r,offset:s,metadata:i=null})=>{if(!t)throw new l(`Invalid topic ${t}`);if(isNaN(r))throw new l(`Invalid partition, expected a number received ${r}`);let n;try{n=o.fromValue(s)}catch(e){throw new l(`Invalid offset, expected a long received ${s}`)}if(n.lessThan(0))throw new l("Offset must not be a negative number");if(null!==i&&"string"!=typeof i)throw new l(`Invalid offset metadata, expected string or null, received ${i}`);const a=e[t]||[];return a.push({partition:r,offset:n,metadata:i}),{...e,[t]:a}}),{});if(!U)throw new l("Consumer group was not initialized, consumer#run must be called first");const r=Object.keys(t);return G.commitOffsets({topics:r.map((e=>({topic:e,partitions:t[e]})))})},seek:({topic:e,partition:t,offset:r})=>{if(!e)throw new l(`Invalid topic ${e}`);if(isNaN(t))throw new l(`Invalid partition, expected a number received ${t}`);let s;try{s=o.fromValue(r)}catch(e){throw new l(`Invalid offset, expected a long received ${r}`)}if(s.lessThan(0)&&!C.includes(s.toString()))throw new l("Offset must not be a negative number");if(!U)throw new l("Consumer group was not initialized, consumer#run must be called first");U.seek({topic:e,partition:t,offset:s.toString()})},describeGroup:async()=>{const o=await e.findGroupCoordinator({groupId:t});return s(r)((async()=>{const{groups:e}=await o.describeGroups({groupIds:[t]});return e.find((e=>e.groupId===t))}))},pause:(e=[])=>{for(const t of e){if(!t||!t.topic)throw new l(`Invalid topic ${t&&t.topic||t}`);if(void 0!==t.partitions&&(!Array.isArray(t.partitions)||t.partitions.some(isNaN)))throw new l(`Array of valid partitions required to pause specific partitions instead of ${t.partitions}`)}if(!U)throw new l("Consumer group was not initialized, consumer#run must be called first");U.pause(e)},paused:()=>U?U.paused():[],resume:(e=[])=>{for(const t of e){if(!t||!t.topic)throw new l(`Invalid topic ${t&&t.topic||t}`);if(void 0!==t.partitions&&(!Array.isArray(t.partitions)||t.partitions.some(isNaN)))throw new l(`Array of valid partitions required to resume specific partitions instead of ${t.partitions}`)}if(!U)throw new l("Consumer group was not initialized, consumer#run must be called first");U.resume(e)},on:(e,t)=>{if(!A.includes(e))throw new l(`Event name should be one of ${O}`);return q.addListener(d(e),(r=>{r.type=p(r.type),Promise.resolve(t(r)).catch((t=>{M.error(`Failed to execute listener: ${t.message}`,{eventName:e,stack:t.stack})}))}))},events:c,logger:()=>M}}},9311:(e,t,r)=>{const o=r(76),s=r(1429),i=r(8202),n=s("consumer"),a={HEARTBEAT:n("heartbeat"),COMMIT_OFFSETS:n("commit_offsets"),GROUP_JOIN:n("group_join"),FETCH:n("fetch"),FETCH_START:n("fetch_start"),START_BATCH_PROCESS:n("start_batch_process"),END_BATCH_PROCESS:n("end_batch_process"),CONNECT:n("connect"),DISCONNECT:n("disconnect"),STOP:n("stop"),CRASH:n("crash"),REBALANCING:n("rebalancing"),RECEIVED_UNSUBSCRIBED_TOPICS:n("received_unsubscribed_topics"),REQUEST:n(i.NETWORK_REQUEST),REQUEST_TIMEOUT:n(i.NETWORK_REQUEST_TIMEOUT),REQUEST_QUEUE_SIZE:n(i.NETWORK_REQUEST_QUEUE_SIZE)},c={[a.REQUEST]:i.NETWORK_REQUEST,[a.REQUEST_TIMEOUT]:i.NETWORK_REQUEST_TIMEOUT,[a.REQUEST_QUEUE_SIZE]:i.NETWORK_REQUEST_QUEUE_SIZE},p=o(c);e.exports={events:a,wrap:e=>p[e]||e,unwrap:e=>c[e]||e}},1770:(e,t,r)=>{const o=r(3278),s=r(6390),i=r(4137),{events:{COMMIT_OFFSETS:n}}=r(9311),{keys:a,assign:c}=Object,p=Symbol("private:OffsetManager:committedOffsets");e.exports=class{constructor({cluster:e,coordinator:t,memberAssignment:r,autoCommit:o,autoCommitInterval:s,autoCommitThreshold:i,topicConfigurations:n,instrumentationEmitter:c,groupId:p,generationId:d,memberId:u}){this.cluster=e,this.coordinator=t,this.memberAssignment=r,this.topicConfigurations=n,this.instrumentationEmitter=c,this.groupId=p,this.generationId=d,this.memberId=u,this.autoCommit=o,this.autoCommitInterval=s,this.autoCommitThreshold=i,this.lastCommit=Date.now(),this.topics=a(r),this.clearAllOffsets()}nextOffset(e,t){this.resolvedOffsets[e][t]||(this.resolvedOffsets[e][t]=this.committedOffsets()[e][t]);let r=this.resolvedOffsets[e][t];return s(r)&&(r="0"),o.fromValue(r)}async getCoordinator(){return this.coordinator.isConnected()||(this.coordinator=await this.cluster.findBroker(this.coordinator)),this.coordinator}resetOffset({topic:e,partition:t}){this.resolvedOffsets[e][t]=this.committedOffsets()[e][t]}resolveOffset({topic:e,partition:t,offset:r}){this.resolvedOffsets[e][t]=o.fromValue(r).add(1).toString()}countResolvedOffsets(){const e=this.committedOffsets();return this.topics.flatMap((t=>{return r=this.resolvedOffsets[t],i=e[t],a(r).map((e=>((e,t)=>{const r=o.fromValue(e);return s(t)?r:r.subtract(o.fromValue(t))})(r[e],i[e])));var r,i})).reduce(((e,t)=>e.add(t)),o.fromValue(0))}async setDefaultOffset({topic:e,partition:t}){const{groupId:r,generationId:o,memberId:s}=this,i=this.cluster.defaultOffset(this.topicConfigurations[e]),n=await this.getCoordinator();await n.offsetCommit({groupId:r,memberId:s,groupGenerationId:o,topics:[{topic:e,partitions:[{partition:t,offset:i}]}]}),this.clearOffsets({topic:e,partition:t})}async seek({topic:e,partition:t,offset:r}){if(!this.memberAssignment[e]||!this.memberAssignment[e].includes(t))return;if(!this.autoCommit)return void this.resolveOffset({topic:e,partition:t,offset:o.fromValue(r).subtract(1).toString()});const{groupId:s,generationId:i,memberId:n}=this,a=await this.getCoordinator();await a.offsetCommit({groupId:s,memberId:n,groupGenerationId:i,topics:[{topic:e,partitions:[{partition:t,offset:r}]}]}),this.clearOffsets({topic:e,partition:t})}async commitOffsetsIfNecessary(){const e=Date.now(),t=null!=this.autoCommitInterval&&e>=this.lastCommit+this.autoCommitInterval,r=null!=this.autoCommitThreshold&&this.countResolvedOffsets().gte(o.fromValue(this.autoCommitThreshold));if(t||r)return this.commitOffsets()}uncommittedOffsets(){const e=e=>a(this.resolvedOffsets[e]),t=e=>t=>({partition:t,offset:this.resolvedOffsets[e][t]}),r=e=>({partition:t,offset:r})=>r!==this.committedOffsets()[e][t]&&o.fromValue(r).greaterThanOrEqual(0);return{topics:this.topics.map((o=>({topic:o,partitions:e(o).map(t(o)).filter(r(o))}))).filter((({partitions:e})=>e.length>0))}}async commitOffsets(e={}){const{groupId:t,generationId:r,memberId:o}=this,{topics:s=this.uncommittedOffsets().topics}=e;if(0===s.length)return void(this.lastCommit=Date.now());const i={groupId:t,memberId:o,groupGenerationId:r,topics:s};try{const e=await this.getCoordinator();await e.offsetCommit(i),this.instrumentationEmitter.emit(n,i),s.forEach((({topic:e,partitions:t})=>{const r=t.reduce(((e,{partition:t,offset:r})=>c(e,{[t]:r})),{});this[p][e]=c({},this.committedOffsets()[e],r)})),this.lastCommit=Date.now()}catch(e){throw"NOT_COORDINATOR_FOR_GROUP"===e.type&&await this.cluster.refreshMetadata(),e}}async resolveOffsets(){const{groupId:e}=this,t=e=>t=>s(this.committedOffsets()[e][t]),r=this.topics.map((e=>({topic:e,partitions:this.memberAssignment[e].filter(t(e)).map((e=>({partition:e})))}))).filter((e=>e.partitions.length>0));if(0===r.length)return;const o=await this.getCoordinator(),{responses:n}=await o.offsetFetch({groupId:e,topics:r}),a=n.map((({topic:e,partitions:t})=>c({topic:e,partitions:t.filter((({offset:e})=>s(e))).map((({partition:e})=>c({partition:e})))},this.topicConfigurations[e]))),p=(e,{partition:t,offset:r})=>c(e,{[t]:r});let d=n;if(a.some((e=>e.partitions.length>0))){const e=await this.cluster.fetchTopicsOffset(a);d=i(n,e)}d.forEach((({topic:e,partitions:t})=>{this.committedOffsets()[e]=t.reduce(p,{...this.committedOffsets()[e]})}))}clearOffsets({topic:e,partition:t}){delete this.committedOffsets()[e][t],delete this.resolvedOffsets[e][t]}clearAllOffsets(){const e=this.committedOffsets();for(const t in e)delete e[t];for(const t of this.topics)e[t]={};this.resolvedOffsets=this.topics.reduce(((e,t)=>c(e,{[t]:{}})),{})}committedOffsets(){return this[p]||(this[p]=this.groupId?this.cluster.committedOffsets({groupId:this.groupId}):{}),this[p]}}},4137:(e,t,r)=>{const o=r(6390),{keys:s,assign:i}=Object,n=(e,{partition:t,offset:r})=>i(e,{[t]:r}),a=(e,{topic:t,partitions:r})=>i(e,{[t]:r.reduce(n,{})});e.exports=(e,t)=>{const r=e.reduce(a,{}),i=t.reduce(a,{});return s(r).map((e=>{const t=r[e];return{topic:e,partitions:s(t).map((r=>{const s=t[r],n=o(s)?i[e][r]:s;return{partition:Number(r),offset:n}}))}}))}},6390:(e,t,r)=>{const o=r(3278);e.exports=e=>!e&&0!==e||o.fromValue(e).isNegative()},2436:(e,t,r)=>{const{EventEmitter:o}=r(2361),s=r(3278),i=r(9701),{isKafkaJSError:n,isRebalancing:a}=r(9879),{events:{FETCH:c,FETCH_START:p,START_BATCH_PROCESS:d,END_BATCH_PROCESS:u,REBALANCING:l}}=r(9311),h=r(8359),m="consuming-stop";e.exports=class extends o{constructor({logger:e,consumerGroup:t,instrumentationEmitter:r,eachBatchAutoResolve:o=!0,concurrency:s,eachBatch:n,eachMessage:a,heartbeatInterval:c,onCrash:p,retry:d,autoCommit:u=!0}){super(),this.logger=e.namespace("Runner"),this.consumerGroup=t,this.instrumentationEmitter=r,this.eachBatchAutoResolve=o,this.eachBatch=n,this.eachMessage=a,this.heartbeatInterval=c,this.retrier=i(Object.assign({},d)),this.onCrash=p,this.autoCommit=u,this.fetchManager=h({logger:this.logger,getNodeIds:()=>this.consumerGroup.getNodeIds(),fetch:e=>this.fetch(e),handler:e=>this.handleBatch(e),concurrency:s}),this.running=!1,this.consuming=!1}get consuming(){return this._consuming}set consuming(e){this._consuming!==e&&(this._consuming=e,this.emit(e?"consuming-start":m))}async start(){if(!this.running){try{await this.consumerGroup.connect(),await this.consumerGroup.joinAndSync()}catch(e){return this.onCrash(e)}this.running=!0,this.scheduleFetchManager()}}scheduleFetchManager(){if(!this.running)return this.consuming=!1,void this.logger.info("consumer not running, exiting",{groupId:this.consumerGroup.groupId,memberId:this.consumerGroup.memberId});this.consuming=!0,this.retrier((async(e,t,r)=>{if(this.running)try{await this.fetchManager.start()}catch(o){if(a(o))return this.logger.warn("The group is rebalancing, re-joining",{groupId:this.consumerGroup.groupId,memberId:this.consumerGroup.memberId,error:o.message}),this.instrumentationEmitter.emit(l,{groupId:this.consumerGroup.groupId,memberId:this.consumerGroup.memberId}),void await this.consumerGroup.joinAndSync();if("UNKNOWN_MEMBER_ID"===o.type)return this.logger.error("The coordinator is not aware of this member, re-joining the group",{groupId:this.consumerGroup.groupId,memberId:this.consumerGroup.memberId,error:o.message}),this.consumerGroup.memberId=null,void await this.consumerGroup.joinAndSync();if("KafkaJSNotImplemented"===o.name)return e(o);if("KafkaJSConnectionError"===o.name)return e(o);throw this.logger.debug("Error while scheduling fetch manager, trying again...",{groupId:this.consumerGroup.groupId,memberId:this.consumerGroup.memberId,error:o.message,stack:o.stack,retryCount:t,retryTime:r}),o}})).then((()=>{this.scheduleFetchManager()})).catch((e=>{this.onCrash(e),this.consuming=!1,this.running=!1}))}async stop(){if(this.running){this.logger.debug("stop consumer group",{groupId:this.consumerGroup.groupId,memberId:this.consumerGroup.memberId}),this.running=!1;try{await this.fetchManager.stop(),await this.waitForConsumer(),await this.consumerGroup.leave()}catch(e){}}}waitForConsumer(){return new Promise((e=>{if(!this.consuming)return e();this.logger.debug("waiting for consumer to finish...",{groupId:this.consumerGroup.groupId,memberId:this.consumerGroup.memberId}),this.once(m,(()=>e()))}))}async heartbeat(){try{await this.consumerGroup.heartbeat({interval:this.heartbeatInterval})}catch(e){throw a(e)&&await this.autoCommitOffsets(),e}}async processEachMessage(e){const{topic:t,partition:r}=e,o=()=>(this.consumerGroup.pause([{topic:t,partitions:[r]}]),()=>this.consumerGroup.resume([{topic:t,partitions:[r]}]));for(const s of e.messages){if(!this.running||this.consumerGroup.hasSeekOffset({topic:t,partition:r}))break;try{await this.eachMessage({topic:t,partition:r,message:s,heartbeat:()=>this.heartbeat(),pause:o})}catch(e){throw n(e)||this.logger.error("Error when calling eachMessage",{topic:t,partition:r,offset:s.offset,stack:e.stack,error:e}),await this.autoCommitOffsets(),e}if(this.consumerGroup.resolveOffset({topic:t,partition:r,offset:s.offset}),await this.heartbeat(),await this.autoCommitOffsetsIfNecessary(),this.consumerGroup.isPaused(t,r))break}}async processEachBatch(e){const{topic:t,partition:r}=e,o=e.messages[e.messages.length-1],i=()=>(this.consumerGroup.pause([{topic:t,partitions:[r]}]),()=>this.consumerGroup.resume([{topic:t,partitions:[r]}]));try{await this.eachBatch({batch:e,resolveOffset:i=>{const n=o&&(a=i,c=o.offset,s.fromValue(a).equals(s.fromValue(c)))?e.lastOffset():i;var a,c;this.consumerGroup.resolveOffset({topic:t,partition:r,offset:n})},heartbeat:()=>this.heartbeat(),pause:i,commitOffsetsIfNecessary:async e=>e?this.consumerGroup.commitOffsets(e):this.consumerGroup.commitOffsetsIfNecessary(),uncommittedOffsets:()=>this.consumerGroup.uncommittedOffsets(),isRunning:()=>this.running,isStale:()=>this.consumerGroup.hasSeekOffset({topic:t,partition:r})})}catch(o){throw n(o)||this.logger.error("Error when calling eachBatch",{topic:t,partition:r,offset:e.firstOffset(),stack:o.stack,error:o}),await this.autoCommitOffsets(),o}this.eachBatchAutoResolve&&this.consumerGroup.resolveOffset({topic:t,partition:r,offset:e.lastOffset()})}async fetch(e){if(!this.running)return this.logger.debug("consumer not running, exiting",{groupId:this.consumerGroup.groupId,memberId:this.consumerGroup.memberId}),[];const t=Date.now();this.instrumentationEmitter.emit(p,{nodeId:e});const r=await this.consumerGroup.fetch(e);return this.instrumentationEmitter.emit(c,{numberOfBatches:0,duration:Date.now()-t,nodeId:e}),0===r.length&&await this.heartbeat(),r}async handleBatch(e){this.running?await(async e=>{const t=Date.now(),r={topic:e.topic,partition:e.partition,highWatermark:e.highWatermark,offsetLag:e.offsetLag(),offsetLagLow:e.offsetLagLow(),batchSize:e.messages.length,firstOffset:e.firstOffset(),lastOffset:e.lastOffset()};if(e.isEmptyDueToFiltering())return this.instrumentationEmitter.emit(d,r),this.consumerGroup.resolveOffset({topic:e.topic,partition:e.partition,offset:e.lastOffset()}),await this.autoCommitOffsetsIfNecessary(),this.instrumentationEmitter.emit(u,{...r,duration:Date.now()-t}),void await this.heartbeat();e.isEmpty()||(this.instrumentationEmitter.emit(d,r),this.eachMessage?await this.processEachMessage(e):this.eachBatch&&await this.processEachBatch(e),this.instrumentationEmitter.emit(u,{...r,duration:Date.now()-t}),await this.autoCommitOffsets()),await this.heartbeat()})(e):this.logger.debug("consumer not running, exiting",{groupId:this.consumerGroup.groupId,memberId:this.consumerGroup.memberId})}autoCommitOffsets(){if(this.autoCommit)return this.consumerGroup.commitOffsets()}autoCommitOffsetsIfNecessary(){if(this.autoCommit)return this.consumerGroup.commitOffsetsIfNecessary()}commitOffsets(e){if(this.running)return this.retrier((async(t,r,o)=>{try{await this.consumerGroup.commitOffsets(e)}catch(s){if(!this.running)return void this.logger.debug("consumer not running, exiting",{error:s.message,groupId:this.consumerGroup.groupId,memberId:this.consumerGroup.memberId,offsets:e});if("KafkaJSNotImplemented"===s.name)return t(s);throw this.logger.debug("Error while committing offsets, trying again...",{groupId:this.consumerGroup.groupId,memberId:this.consumerGroup.memberId,error:s.message,stack:s.stack,retryCount:r,retryTime:o,offsets:e}),s}}));this.logger.debug("consumer not running, exiting",{groupId:this.consumerGroup.groupId,memberId:this.consumerGroup.memberId,offsets:e})}}},2499:e=>{e.exports=class extends Map{getKey(e,t){return JSON.stringify([e,t])}set(e,t,r){const o=this.getKey(e,t);super.set(o,r)}has(e,t){const r=this.getKey(e,t);return super.has(r)}pop(e,t){if(0===this.size||!this.has(e,t))return;const r=this.getKey(e,t),o=this.get(r);return this.delete(r),{topic:e,partition:t,offset:o}}}},1381:e=>{const t=e=>({topic:e,paused:new Set,pauseAll:!1,resumed:new Set});e.exports=class{constructor(){this.assignedPartitionsByTopic={},this.subscriptionStatesByTopic={}}assign(e=[]){this.assignedPartitionsByTopic=e.reduce(((e,{topic:t,partitions:r=[]})=>({...e,[t]:{topic:t,partitions:r}})),{})}pause(e=[]){e.forEach((({topic:e,partitions:r})=>{const o=this.subscriptionStatesByTopic[e]||t(e);void 0===r?(o.paused.clear(),o.resumed.clear(),o.pauseAll=!0):Array.isArray(r)&&(r.forEach((e=>{o.paused.add(e),o.resumed.delete(e)})),o.pauseAll=!1),this.subscriptionStatesByTopic[e]=o}))}resume(e=[]){e.forEach((({topic:e,partitions:r})=>{const o=this.subscriptionStatesByTopic[e]||t(e);void 0===r?(o.paused.clear(),o.resumed.clear(),o.pauseAll=!1):Array.isArray(r)&&r.forEach((e=>{o.paused.delete(e),o.pauseAll&&o.resumed.add(e)})),this.subscriptionStatesByTopic[e]=o}))}assigned(){return Object.values(this.assignedPartitionsByTopic).map((({topic:e,partitions:t})=>({topic:e,partitions:t.sort()})))}active(){return Object.values(this.assignedPartitionsByTopic).map((({topic:e,partitions:t})=>({topic:e,partitions:t.filter((t=>!this.isPaused(e,t))).sort()})))}paused(){return Object.values(this.assignedPartitionsByTopic).map((({topic:e,partitions:t})=>({topic:e,partitions:t.filter((t=>this.isPaused(e,t))).sort()}))).filter((({partitions:e})=>0!==e.length))}isPaused(e,t){const r=this.subscriptionStatesByTopic[e];if(!r)return!1;const o=r.resumed.has(t),s=r.paused.has(t);return r.pauseAll&&!o||s}}},8125:(e,t,r)=>{const o=r(9026);e.exports=({handler:e,workerId:t})=>({run:o((async({next:r})=>{for(;;){const o=r();if(!o)break;const{batch:s,resolve:i,reject:n}=o;try{await e(s,{workerId:t}),i()}catch(e){n(e)}}}))})},9689:e=>{e.exports=({workers:e})=>{const t=[];return{push:async(...r)=>{const o=r.map((e=>new Promise(((r,o)=>t.push({batch:e,resolve:r,reject:o})))));e.forEach((e=>e.run({next:()=>t.shift()})));const s=(await Promise.allSettled(o)).find((e=>"rejected"===e.status));if(s)throw s.reason},getWorkers:()=>e}}},9152:e=>{e.exports=()=>({KAFKAJS_DEBUG_PROTOCOL_BUFFERS:process.env.KAFKAJS_DEBUG_PROTOCOL_BUFFERS,KAFKAJS_DEBUG_EXTENDED_PROTOCOL_BUFFERS:process.env.KAFKAJS_DEBUG_EXTENDED_PROTOCOL_BUFFERS})},9879:(e,t,r)=>{const o=r(5557),{bugs:s}=o;class i extends Error{constructor(e,{retriable:t=!0,cause:r}={}){super(e,{cause:r}),Error.captureStackTrace(this,this.constructor),this.message=e.message||e,this.name="KafkaJSError",this.retriable=t,this.helpUrl=e.helpUrl,this.cause=r}}class n extends i{constructor(e,{cause:t}={}){super(e,{retriable:!1,cause:t}),this.name="KafkaJSNonRetriableError"}}class a extends i{constructor(e,{retriable:t=e.retriable}={}){super(e,{retriable:t}),this.type=e.type,this.code=e.code,this.name="KafkaJSProtocolError"}}class c extends i{constructor(e,{broker:t,code:r}={}){super(e),this.broker=t,this.code=r,this.name="KafkaJSConnectionError"}}class p extends i{constructor(){super(...arguments),this.name="KafkaJSMetadataNotLoaded"}}class d extends n{constructor(){super(...arguments),this.name="KafkaJSTimeout"}}const u=s?s.url:null;class l extends Error{constructor(e,t){super(e),this.errors=t,this.name="KafkaJSAggregateError"}}class h extends Error{}e.exports={KafkaJSError:i,KafkaJSNonRetriableError:n,KafkaJSPartialMessageError:class extends n{constructor(){super(...arguments),this.name="KafkaJSPartialMessageError"}},KafkaJSBrokerNotFound:class extends i{constructor(){super(...arguments),this.name="KafkaJSBrokerNotFound"}},KafkaJSProtocolError:a,KafkaJSConnectionError:c,KafkaJSConnectionClosedError:class extends c{constructor(e,{host:t,port:r}={}){super(e,{broker:`${t}:${r}`}),this.host=t,this.port=r,this.name="KafkaJSConnectionClosedError"}},KafkaJSRequestTimeoutError:class extends i{constructor(e,{broker:t,correlationId:r,createdAt:o,sentAt:s,pendingDuration:i}={}){super(e),this.broker=t,this.correlationId=r,this.createdAt=o,this.sentAt=s,this.pendingDuration=i,this.name="KafkaJSRequestTimeoutError"}},KafkaJSSASLAuthenticationError:class extends n{constructor(){super(...arguments),this.name="KafkaJSSASLAuthenticationError"}},KafkaJSNumberOfRetriesExceeded:class extends n{constructor(e,{retryCount:t,retryTime:r}){super(e,{cause:e}),this.stack=`${this.name}\n  Caused by: ${e.stack}`,this.retryCount=t,this.retryTime=r,this.name="KafkaJSNumberOfRetriesExceeded"}},KafkaJSOffsetOutOfRange:class extends a{constructor(e,{topic:t,partition:r}){super(e),this.topic=t,this.partition=r,this.name="KafkaJSOffsetOutOfRange"}},KafkaJSMemberIdRequired:class extends a{constructor(e,{memberId:t}){super(e),this.memberId=t,this.name="KafkaJSMemberIdRequired"}},KafkaJSGroupCoordinatorNotFound:class extends n{constructor(){super(...arguments),this.name="KafkaJSGroupCoordinatorNotFound"}},KafkaJSNotImplemented:class extends n{constructor(){super(...arguments),this.name="KafkaJSNotImplemented"}},KafkaJSMetadataNotLoaded:p,KafkaJSTopicMetadataNotLoaded:class extends p{constructor(e,{topic:t}={}){super(e),this.topic=t,this.name="KafkaJSTopicMetadataNotLoaded"}},KafkaJSStaleTopicMetadataAssignment:class extends i{constructor(e,{topic:t,unknownPartitions:r}={}){super(e),this.topic=t,this.unknownPartitions=r,this.name="KafkaJSStaleTopicMetadataAssignment"}},KafkaJSDeleteGroupsError:class extends i{constructor(e,t=[]){super(e),this.groups=t,this.name="KafkaJSDeleteGroupsError"}},KafkaJSTimeout:d,KafkaJSLockTimeout:class extends d{constructor(){super(...arguments),this.name="KafkaJSLockTimeout"}},KafkaJSServerDoesNotSupportApiKey:class extends n{constructor(e,{apiKey:t,apiName:r}={}){super(e),this.apiKey=t,this.apiName=r,this.name="KafkaJSServerDoesNotSupportApiKey"}},KafkaJSUnsupportedMagicByteInMessageSet:class extends n{constructor(){super(...arguments),this.name="KafkaJSUnsupportedMagicByteInMessageSet"}},KafkaJSDeleteTopicRecordsError:class extends i{constructor({partitions:e}){super("Error while deleting records",{retriable:e.filter((({error:e})=>null!=e)).every((({error:e})=>!0===e.retriable))}),this.name="KafkaJSDeleteTopicRecordsError",this.partitions=e}},KafkaJSInvariantViolation:class extends n{constructor(e){const t=e.message||e;if(super(`Invariant violated: ${t}. This is likely a bug and should be reported.`),this.name="KafkaJSInvariantViolation",null!==u){const e=encodeURIComponent(`Invariant violation: ${t}`);this.helpUrl=`${u}/new?assignees=&labels=bug&template=bug_report.md&title=${e}`}}},KafkaJSInvalidVarIntError:class extends n{constructor(){super(...arguments),this.name="KafkaJSNonRetriableError"}},KafkaJSInvalidLongError:class extends n{constructor(){super(...arguments),this.name="KafkaJSNonRetriableError"}},KafkaJSCreateTopicError:class extends a{constructor(e,t){super(e),this.topic=t,this.name="KafkaJSCreateTopicError"}},KafkaJSAggregateError:l,KafkaJSFetcherRebalanceError:h,isRebalancing:e=>"REBALANCE_IN_PROGRESS"===e.type||"NOT_COORDINATOR_FOR_GROUP"===e.type,isKafkaJSError:e=>e instanceof i}},873:(e,t,r)=>{const{createLogger:o,LEVELS:{INFO:s}}=r(354),i=r(2190),n=r(1230),a=r(8048),c=r(3798),p=r(763),d=r(5929),u=r(2845),l=r(9992),h=r(4278),m=r(6779),f=Symbol("private:Kafka:createCluster"),g=Symbol("private:Kafka:clusterRetry"),I=Symbol("private:Kafka:logger"),y=Symbol("private:Kafka:offsets"),w=h((e=>{null==process.env.KAFKAJS_NO_PARTITIONER_WARNING&&e.warn(`KafkaJS v2.0.0 switched default partitioner. To retain the same partitioning behavior as in previous versions, create the producer with the option "createPartitioner: Partitioners.LegacyPartitioner". See the migration guide at ${m("docs/migration-guide-v2.0.0","producer-new-default-partitioner")} for details. Silence this warning by setting the environment variable "KAFKAJS_NO_PARTITIONER_WARNING=1"`)}));e.exports=class{constructor({brokers:e,ssl:t,sasl:r,clientId:i,connectionTimeout:c=1e3,authenticationTimeout:p,reauthenticationThreshold:d,requestTimeout:u,enforceRequestTimeout:h=!0,retry:m,socketFactory:w=l(),logLevel:T=s,logCreator:E=n}){this[y]=new Map,this[I]=o({level:T,logCreator:E}),this[g]=m,this[f]=({metadataMaxAge:o,allowAutoTopicCreation:s=!0,maxInFlightRequests:n=null,instrumentationEmitter:l=null,isolationLevel:m})=>new a({logger:this[I],retry:this[g],offsets:this[y],socketFactory:w,brokers:e,ssl:t,sasl:r,clientId:i,connectionTimeout:c,authenticationTimeout:p,reauthenticationThreshold:d,requestTimeout:u,enforceRequestTimeout:h,metadataMaxAge:o,instrumentationEmitter:l,allowAutoTopicCreation:s,maxInFlightRequests:n,isolationLevel:m})}producer({createPartitioner:e,retry:t,metadataMaxAge:r=3e5,allowAutoTopicCreation:o,idempotent:s,transactionalId:n,transactionTimeout:a,maxInFlightRequests:p}={}){const d=new i,u=this[f]({metadataMaxAge:r,allowAutoTopicCreation:o,maxInFlightRequests:p,instrumentationEmitter:d});return null==e&&w(this[I]),c({retry:{...this[g],...t},logger:this[I],cluster:u,createPartitioner:e,idempotent:s,transactionalId:n,transactionTimeout:a,instrumentationEmitter:d})}consumer({groupId:e,partitionAssigners:t,metadataMaxAge:r=3e5,sessionTimeout:o,rebalanceTimeout:s,heartbeatInterval:n,maxBytesPerPartition:a,minBytes:c,maxBytes:d,maxWaitTimeInMs:l,retry:h={retries:5},allowAutoTopicCreation:m,maxInFlightRequests:y,readUncommitted:w=!1,rackId:T=""}={}){const E=w?u.READ_UNCOMMITTED:u.READ_COMMITTED,b=new i,S=this[f]({metadataMaxAge:r,allowAutoTopicCreation:m,maxInFlightRequests:y,isolationLevel:E,instrumentationEmitter:b});return p({retry:{...this[g],...h},logger:this[I],cluster:S,groupId:e,partitionAssigners:t,sessionTimeout:o,rebalanceTimeout:s,heartbeatInterval:n,maxBytesPerPartition:a,minBytes:c,maxBytes:d,maxWaitTimeInMs:l,isolationLevel:E,instrumentationEmitter:b,rackId:T,metadataMaxAge:r})}admin({retry:e}={}){const t=new i,r=this[f]({allowAutoTopicCreation:!1,instrumentationEmitter:t});return d({retry:{...this[g],...e},logger:this[I],instrumentationEmitter:t,cluster:r})}logger(){return this[I]}}},2190:(e,t,r)=>{const{EventEmitter:o}=r(2361),s=r(267),{KafkaJSError:i}=r(9879);e.exports=class{constructor(){this.emitter=new o}emit(e,t){if(!e)throw new i("Invalid event name",{retriable:!1});if(this.emitter.listenerCount(e)>0){const r=new s(e,t);this.emitter.emit(e,r)}}addListener(e,t){return this.emitter.addListener(e,t),()=>this.emitter.removeListener(e,t)}}},267:e=>{let t=0;e.exports=class{constructor(e,r){this.id=(t===Number.MAX_VALUE&&(t=0),t++),this.type=e,this.timestamp=Date.now(),this.payload=r}}},1429:e=>{e.exports=e=>t=>`${e}.${t}`},1230:(e,t,r)=>{const{LEVELS:o}=r(354);e.exports=()=>({namespace:e,level:t,label:r,log:s})=>{const i=e?`[${e}] `:"",n=JSON.stringify(Object.assign({level:r},s,{message:`${i}${s.message}`}));switch(t){case o.INFO:return console.info(n);case o.ERROR:return console.error(n);case o.WARN:return console.warn(n);case o.DEBUG:return console.log(n)}}},354:e=>{const{assign:t}=Object,r={NOTHING:0,ERROR:1,WARN:2,INFO:4,DEBUG:5},o=(e,r,o,s,i)=>(n,a={})=>{r>o()||i({namespace:s,level:r,label:e,log:t({timestamp:(new Date).toISOString(),logger:"kafkajs",message:n},a)})},s=e=>{const t=(process.env.KAFKAJS_LOG_LEVEL||"").toUpperCase();return null==r[t]?e:r[t]};e.exports={LEVELS:r,createLogger:({level:e=r.INFO,logCreator:i}={})=>{let n=s(e);const a=i(n),c=(e,t=null)=>{const r=s(t);return p(e,r)},p=(e,s=null)=>{const i=()=>null==s?n:s,p={info:o("INFO",r.INFO,i,e,a),error:o("ERROR",r.ERROR,i,e,a),warn:o("WARN",r.WARN,i,e,a),debug:o("DEBUG",r.DEBUG,i,e,a)};return t(p,{namespace:c,setLogLevel:e=>{n=e}})};return p()}}},2109:(e,t,r)=>{const o=r(6829),s=r(2882),i=r(6341),{KafkaJSConnectionError:n,KafkaJSConnectionClosedError:a}=r(9879),{INT_32_MAX_VALUE:c}=r(3904),p=r(9152),d=r(6472),{CONNECTION_STATUS:u,CONNECTED_STATUS:l}=r(5315),h=r(9026),m=r(3278),f=r(722),g=r(9211),I=({apiName:e,apiKey:t,apiVersion:r})=>`${e}(key: ${t}, version: ${r})`,y=Symbol("private:Connection:shouldReauthenticate"),w=Symbol("private:Connection:authenticate");e.exports=class{constructor({host:e,port:t,logger:r,socketFactory:o,requestTimeout:s,reauthenticationThreshold:n=1e4,rack:a=null,ssl:c=null,sasl:l=null,clientId:g="kafkajs",connectionTimeout:I,enforceRequestTimeout:y=!0,maxInFlightRequests:T=null,instrumentationEmitter:E=null}){this.host=e,this.port=t,this.rack=a,this.clientId=g,this.broker=`${this.host}:${this.port}`,this.logger=r.namespace("Connection"),this.socketFactory=o,this.ssl=c,this.sasl=l,this.requestTimeout=s,this.connectionTimeout=I,this.reauthenticationThreshold=n,this.bytesBuffered=0,this.bytesNeeded=i.int32Size(),this.chunks=[],this.connectionStatus=u.DISCONNECTED,this.correlationId=0,this.requestQueue=new d({instrumentationEmitter:E,maxInFlightRequests:T,requestTimeout:s,enforceRequestTimeout:y,clientId:g,broker:this.broker,logger:r.namespace("RequestQueue"),isConnected:()=>this.isConnected()}),this.versions=null,this.authHandlers=null,this.authExpectResponse=!1;const b=e=>(t,r={})=>{(0,this.logger[e])(t,{broker:this.broker,clientId:g,...r})};this.logDebug=b("debug"),this.logError=b("error");const S=p();this.shouldLogBuffers="1"===S.KAFKAJS_DEBUG_PROTOCOL_BUFFERS,this.shouldLogFetchBuffer=this.shouldLogBuffers&&"1"===S.KAFKAJS_DEBUG_EXTENDED_PROTOCOL_BUFFERS,this.authenticatedAt=null,this.sessionLifetime=m.ZERO,this.supportAuthenticationProtocol=null,this[w]=h((async()=>{if(this.sasl&&!this.isAuthenticated()){const e=new f(this,this.logger,this.versions,this.supportAuthenticationProtocol);await e.authenticate(),this.authenticatedAt=process.hrtime(),this.sessionLifetime=m.fromValue(e.sessionLifetime)}}))}getSupportAuthenticationProtocol(){return this.supportAuthenticationProtocol}setSupportAuthenticationProtocol(e){this.supportAuthenticationProtocol=e}setVersions(e){this.versions=e}isConnected(){return l.includes(this.connectionStatus)}connect(){return new Promise(((e,t)=>{if(this.isConnected())return e(!0);let r;this.authenticatedAt=null;const s=()=>{clearTimeout(r),this.connectionStatus=u.CONNECTED,this.requestQueue.scheduleRequestTimeoutCheck(),e(!0)},i=e=>{this.processData(e)},c=async()=>{clearTimeout(r);const e=this.isConnected();this.authHandlers?this.authHandlers.onError():e&&(this.logDebug("Kafka server has closed connection"),this.rejectRequests(new a("Closed connection",{host:this.host,port:this.port}))),await this.disconnect()},p=async e=>{clearTimeout(r);const o=new n(`Connection error: ${e.message}`,{broker:`${this.host}:${this.port}`,code:e.code});this.logError(o.message,{stack:e.stack}),this.rejectRequests(o),await this.disconnect(),t(o)},d=async()=>{const e=new n("Connection timeout",{broker:`${this.host}:${this.port}`});this.logError(e.message),this.rejectRequests(e),await this.disconnect(),t(e)};this.logDebug("Connecting",{ssl:!!this.ssl,sasl:!!this.sasl});try{r=setTimeout(d,this.connectionTimeout),this.socket=o({socketFactory:this.socketFactory,host:this.host,port:this.port,ssl:this.ssl,onConnect:s,onData:i,onEnd:c,onError:p,onTimeout:d})}catch(e){clearTimeout(r),t(new n(`Failed to connect: ${e.message}`,{broker:`${this.host}:${this.port}`}))}}))}async disconnect(){return this.authenticatedAt=null,this.connectionStatus=u.DISCONNECTING,this.logDebug("disconnecting..."),await this.requestQueue.waitForPendingRequests(),this.requestQueue.destroy(),this.socket&&(this.socket.end(),this.socket.unref()),this.connectionStatus=u.DISCONNECTED,this.logDebug("disconnected"),!0}isAuthenticated(){return null!=this.authenticatedAt&&!this[y]()}[y](){if(this.sessionLifetime.equals(m.ZERO))return!1;if(null==this.authenticatedAt)return!0;const[e,t]=process.hrtime(this.authenticatedAt);return m.fromValue(e).multiply(1e3).add(m.fromValue(t).divide(1e6)).add(this.reauthenticationThreshold).greaterThanOrEqual(this.sessionLifetime)}async authenticate(){await this[w]()}sendAuthRequest({authExpectResponse:e=!1,request:t,response:r}){return this.authExpectResponse=e,new Promise((async(e,o)=>{this.authHandlers={onSuccess:t=>{this.authHandlers=null,this.authExpectResponse=!1,r.decode(t).then((e=>r.parse(e))).then(e).catch(o)},onError:()=>{this.authHandlers=null,this.authExpectResponse=!1,o(new n("Connection closed by the server",{broker:`${this.host}:${this.port}`}))}};try{const e=await t.encode();this.failIfNotConnected(),this.socket.write(e.buffer,"binary")}catch(e){o(e)}}))}async send({request:e,response:t,requestTimeout:r=null,logResponseError:o=!0}){!this.isAuthenticated()&&(e=>![g.ApiVersions,g.SaslHandshake,g.SaslAuthenticate].includes(e.apiKey))(e)&&await this[w](),this.failIfNotConnected();const i=!e.expectResponse||e.expectResponse(),{correlationId:n,size:a,entry:c,payload:p}=await(async()=>{const{clientId:t}=this,o=this.nextCorrelationId(),n=await s({request:e,correlationId:o,clientId:t}),{apiKey:a,apiName:c,apiVersion:p}=e;return this.logDebug(`Request ${I(e)}`,{correlationId:o,expectResponse:i,size:Buffer.byteLength(n.buffer)}),new Promise(((e,t)=>{try{this.failIfNotConnected();const s={apiKey:a,apiName:c,apiVersion:p,correlationId:o,resolve:e,reject:t};this.requestQueue.push({entry:s,expectResponse:i,requestTimeout:r,sendRequest:()=>{this.socket.write(n.buffer,"binary")}})}catch(e){t(e)}}))})();if(i)try{const e=await t.decode(p);this.requestQueue.maybeThrottle(e.clientSideThrottleTime);const r=await t.parse(e),o="Fetch"===c.apiName;return this.logDebug(`Response ${I(c)}`,{correlationId:n,size:a,data:o&&!this.shouldLogFetchBuffer?"[filtered]":r}),r}catch(e){o&&this.logError(`Response ${I(c)}`,{error:e.message,correlationId:n,size:a});const t=Buffer.isBuffer(p);throw this.logDebug(`Response ${I(c)}`,{error:e.message,correlationId:n,payload:t&&!this.shouldLogBuffers?{type:"Buffer",data:"[filtered]"}:p}),e}}failIfNotConnected(){if(!this.isConnected())throw new n("Not connected",{broker:`${this.host}:${this.port}`})}nextCorrelationId(){return this.correlationId>=c&&(this.correlationId=0),this.correlationId++}processData(e){if(this.authHandlers&&!this.authExpectResponse)return this.authHandlers.onSuccess(e);for(this.chunks.push(e),this.bytesBuffered+=Buffer.byteLength(e);this.bytesNeeded<=this.bytesBuffered;){const e=this.chunks.length>1?Buffer.concat(this.chunks):this.chunks[0],t=new i(e),r=t.readInt32();if(!t.canReadBytes(r))return this.chunks=[e],this.bytesBuffered=Buffer.byteLength(e),void(this.bytesNeeded=i.int32Size()+r);const o=new i(t.readBytes(r)),s=t.readAll();if(this.chunks=[s],this.bytesBuffered=Buffer.byteLength(s),this.bytesNeeded=i.int32Size(),this.authHandlers){const t=i.int32Size()+r,o=e.slice(0,t);return this.authHandlers.onSuccess(o)}const n=o.readInt32(),a=o.readAll();this.requestQueue.fulfillRequest({size:r,correlationId:n,payload:a})}}rejectRequests(e){this.requestQueue.rejectAll(e)}}},8661:(e,t,r)=>{const o=r(9211),s=r(2109);e.exports=class{constructor(e){this.logger=e.logger.namespace("ConnectionPool"),this.connectionTimeout=e.connectionTimeout,this.host=e.host,this.port=e.port,this.rack=e.rack,this.ssl=e.ssl,this.sasl=e.sasl,this.clientId=e.clientId,this.socketFactory=e.socketFactory,this.pool=new Array(2).fill().map((()=>new s(e)))}isConnected(){return this.pool.some((e=>e.isConnected()))}isAuthenticated(){return this.pool.some((e=>e.isAuthenticated()))}setSupportAuthenticationProtocol(e){this.map((t=>t.setSupportAuthenticationProtocol(e)))}setVersions(e){this.map((t=>t.setVersions(e)))}map(e){return this.pool.map((t=>e(t)))}async send(e){return(await this.getConnectionByRequest(e)).send(e)}getConnectionByRequest({request:{apiKey:e}}){const t={[o.Fetch]:1}[e]||0;return this.getConnection(t)}async getConnection(e=0){const t=this.pool[e];return t.isConnected()||await t.connect(),t}async destroy(){await Promise.all(this.map((e=>e.disconnect())))}}},5315:e=>{const t={CONNECTED:"connected",DISCONNECTING:"disconnecting",DISCONNECTED:"disconnected"},r=[t.CONNECTED,t.DISCONNECTING];e.exports={CONNECTION_STATUS:t,CONNECTED_STATUS:r}},8202:(e,t,r)=>{const o=r(1429)("network");e.exports={NETWORK_REQUEST:o("request"),NETWORK_REQUEST_TIMEOUT:o("request_timeout"),NETWORK_REQUEST_QUEUE_SIZE:o("request_queue_size")}},6472:(e,t,r)=>{const{EventEmitter:o}=r(2361),s=r(2764),i=r(8202),{KafkaJSInvariantViolation:n}=r(9879),a=Symbol("private:RequestQueue:emitQueueSizeEvent"),c=Symbol("private:RequestQueue:emitQueueEmpty"),p="requestQueueEmpty";e.exports=class extends o{constructor({instrumentationEmitter:e=null,maxInFlightRequests:t,requestTimeout:r,enforceRequestTimeout:o,clientId:s,broker:n,logger:d,isConnected:u=(()=>!0)}){super(),this.instrumentationEmitter=e,this.maxInFlightRequests=t,this.requestTimeout=r,this.enforceRequestTimeout=o,this.clientId=s,this.broker=n,this.logger=d,this.isConnected=u,this.inflight=new Map,this.pending=[],this.throttledUntil=-1,this.throttleCheckTimeoutId=null,this[c]=()=>{0===this.pending.length&&0===this.inflight.size&&this.emit(p)},this[a]=()=>{e&&e.emit(i.NETWORK_REQUEST_QUEUE_SIZE,{broker:this.broker,clientId:this.clientId,queueSize:this.pending.length}),this[c]()}}scheduleRequestTimeoutCheck(){this.enforceRequestTimeout&&(this.destroy(),this.requestTimeoutIntervalId=setInterval((()=>{this.inflight.forEach((e=>{Date.now()-e.sentAt>e.requestTimeout&&e.timeoutRequest()})),this.isConnected()||this.destroy()}),Math.min(this.requestTimeout,100)))}maybeThrottle(e){if(e){const t=Date.now()+e;this.throttledUntil=Math.max(t,this.throttledUntil)}}push(e){const{correlationId:t}=e.entry,r=this.requestTimeout,o=e.requestTimeout,i=Math.max(r,o||0),p=new s({entry:e.entry,expectResponse:e.expectResponse,broker:this.broker,clientId:this.clientId,instrumentationEmitter:this.instrumentationEmitter,requestTimeout:i,send:()=>{if(this.inflight.has(t))throw new n("Correlation id already exists");this.inflight.set(t,p),e.sendRequest()},timeout:()=>{this.inflight.delete(t),this.checkPendingRequests(),this[c]()}});this.canSendSocketRequestImmediately()?this.sendSocketRequest(p):(this.pending.push(p),this.scheduleCheckPendingRequests(),this.logger.debug("Request enqueued",{clientId:this.clientId,broker:this.broker,correlationId:t}),this[a]())}sendSocketRequest(e){e.send(),e.expectResponse||(this.logger.debug("Request does not expect a response, resolving immediately",{clientId:this.clientId,broker:this.broker,correlationId:e.correlationId}),this.inflight.delete(e.correlationId),e.completed({size:0,payload:null}))}fulfillRequest({correlationId:e,payload:t,size:r}){const o=this.inflight.get(e);this.inflight.delete(e),this.checkPendingRequests(),o?o.completed({size:r,payload:t}):this.logger.warn("Response without match",{clientId:this.clientId,broker:this.broker,correlationId:e}),this[c]()}rejectAll(e){const t=[...this.inflight.values(),...this.pending];for(const r of t)r.rejected(e),this.inflight.delete(r.correlationId);this.pending=[],this.inflight.clear(),this[a]()}waitForPendingRequests(){return new Promise((e=>{if(0===this.pending.length&&0===this.inflight.size)return e();this.logger.debug("Waiting for pending requests",{clientId:this.clientId,broker:this.broker,currentInflightRequests:this.inflight.size,currentPendingQueueSize:this.pending.length}),this.once(p,(()=>e()))}))}destroy(){clearInterval(this.requestTimeoutIntervalId),clearTimeout(this.throttleCheckTimeoutId),this.throttleCheckTimeoutId=null}canSendSocketRequestImmediately(){return!(null!=this.maxInFlightRequests&&this.inflight.size>=this.maxInFlightRequests||this.throttledUntil>Date.now())}checkPendingRequests(){for(;this.pending.length>0&&this.canSendSocketRequestImmediately();){const e=this.pending.shift();this.sendSocketRequest(e),this.logger.debug("Consumed pending request",{clientId:this.clientId,broker:this.broker,correlationId:e.correlationId,pendingDuration:e.pendingDuration,currentPendingQueueSize:this.pending.length}),this[a]()}this.scheduleCheckPendingRequests()}scheduleCheckPendingRequests(){const e=this.throttledUntil-Date.now();e>0&&!this.throttleCheckTimeoutId&&(this.throttleCheckTimeoutId=setTimeout((()=>{this.throttleCheckTimeoutId=null,this.checkPendingRequests()}),e))}}},2764:(e,t,r)=>{const{KafkaJSRequestTimeoutError:o,KafkaJSNonRetriableError:s}=r(9879),i=r(8202),n=Symbol("private:SocketRequest:state"),a=Symbol("private:SocketRequest:emitEvent"),c={PENDING:Symbol("PENDING"),SENT:Symbol("SENT"),COMPLETED:Symbol("COMPLETED"),REJECTED:Symbol("REJECTED")};e.exports=class{constructor({requestTimeout:e,broker:t,clientId:r,entry:o,expectResponse:s,send:i,timeout:p,instrumentationEmitter:d=null}){this.createdAt=Date.now(),this.requestTimeout=e,this.broker=t,this.clientId=r,this.entry=o,this.correlationId=o.correlationId,this.expectResponse=s,this.sendRequest=i,this.timeoutHandler=p,this.sentAt=null,this.duration=null,this.pendingDuration=null,this[n]=c.PENDING,this[a]=(e,t)=>d&&d.emit(e,t)}send(){this.throwIfInvalidState({accepted:[c.PENDING],next:c.SENT}),this.sendRequest(),this.sentAt=Date.now(),this.pendingDuration=this.sentAt-this.createdAt,this[n]=c.SENT}timeoutRequest(){const{apiName:e,apiKey:t,apiVersion:r}=this.entry,s=`${e}(key: ${t}, version: ${r})`,n={broker:this.broker,clientId:this.clientId,correlationId:this.correlationId,createdAt:this.createdAt,sentAt:this.sentAt,pendingDuration:this.pendingDuration};this.timeoutHandler(),this.rejected(new o(`Request ${s} timed out`,n)),this[a](i.NETWORK_REQUEST_TIMEOUT,{...n,apiName:e,apiKey:t,apiVersion:r})}completed({size:e,payload:t}){this.throwIfInvalidState({accepted:[c.SENT],next:c.COMPLETED});const{entry:r,correlationId:o,broker:s,clientId:p,createdAt:d,sentAt:u,pendingDuration:l}=this;this[n]=c.COMPLETED,this.duration=Date.now()-this.sentAt,r.resolve({correlationId:o,entry:r,size:e,payload:t}),this[a](i.NETWORK_REQUEST,{broker:s,clientId:p,correlationId:o,size:e,createdAt:d,sentAt:u,pendingDuration:l,duration:this.duration,apiName:r.apiName,apiKey:r.apiKey,apiVersion:r.apiVersion})}rejected(e){this.throwIfInvalidState({accepted:[c.PENDING,c.SENT],next:c.REJECTED}),this[n]=c.REJECTED,this.duration=Date.now()-this.sentAt,this.entry.reject(e)}throwIfInvalidState({accepted:e,next:t}){if(e.includes(this[n]))return;const r=this[n].toString();throw new s(`Invalid state, can't transition from ${r} to ${t.toString()}`)}}},6829:e=>{e.exports=({socketFactory:e,host:t,port:r,ssl:o,onConnect:s,onData:i,onEnd:n,onError:a,onTimeout:c})=>{const p=e({host:t,port:r,ssl:o,onConnect:s});return p.on("data",i),p.on("end",n),p.on("error",a),p.on("timeout",c),p}},9992:(e,t,r)=>{e.exports=()=>{const e=r(1808),t=r(4404);return({host:r,port:o,ssl:s,onConnect:i})=>{const n=s?t.connect(Object.assign({host:r,port:o,servername:r},s),i):e.connect({host:r,port:o},i);return n.setKeepAlive(!0,6e4),n}}},8460:e=>{e.exports=e=>e.map((({topic:e,partitions:t,messagesPerPartition:r,sequencePerPartition:o})=>({topic:e,partitions:t.map((e=>({partition:e,messages:r[e]})))})))},6236:(e,t,r)=>{const o=r(9701),s=r(4105),{KafkaJSNonRetriableError:i}=r(9879),n=r(7022),a=r(1352),{INT_32_MAX_VALUE:c}=r(3904),p=r(9491),d=r(5497),u=["NOT_COORDINATOR_FOR_GROUP","GROUP_COORDINATOR_NOT_AVAILABLE","GROUP_LOAD_IN_PROGRESS","CONCURRENT_TRANSACTIONS"],l=["UNKNOWN_TOPIC_OR_PARTITION","COORDINATOR_LOAD_IN_PROGRESS"],h=["COORDINATOR_NOT_AVAILABLE","NOT_COORDINATOR"];e.exports=({logger:e,cluster:t,transactionTimeout:r=6e4,transactional:m,transactionalId:f})=>{if(m&&!f)throw new i("Cannot manage transactions without a transactionalId");const g=o(t.retry);let I=-1,y=0,w={},T={},E={},b=!1;const S=a({logger:e});S.on("transition",(({to:e})=>{e===d.READY&&(E={},b=!1)}));const A=()=>t.findGroupCoordinator({groupId:f,coordinatorType:n.TRANSACTION}),O=()=>{if(!m)throw new i("Method unavailable if non-transactional")},C=()=>b||Object.entries(E).some((([,e])=>Object.entries(e).some((([,e])=>e)))),N=S.createGuarded({getProducerId:()=>I,getProducerEpoch:()=>y,getTransactionalId:()=>f,initProducerId:async()=>g((async(o,s,i)=>{try{await t.refreshMetadataIfNecessary();const o=await(m?A():t.findControllerBroker()),s=await o.initProducerId({transactionalId:m?f:void 0,transactionTimeout:r});S.transitionTo(d.READY),I=s.producerId,y=s.producerEpoch,w={},T={},e.debug("Initialized producer id & epoch",{producerId:I,producerEpoch:y})}catch(t){if(u.includes(t.type))throw"CONCURRENT_TRANSACTIONS"===t.type&&e.debug("There is an ongoing transaction on this transactionId, retrying",{error:t.message,stack:t.stack,transactionalId:f,retryCount:s,retryTime:i}),t;o(t)}})),getSequence:(e,t)=>N.isInitialized()?(w[e]=w[e]||{},w[e][t]=w[e][t]||0,w[e][t]):0,updateSequence(t,r,o){if(!N.isInitialized())return;let s=N.getSequence(t,r)+o;s>=c&&(e.debug(`Sequence for ${t} ${r} exceeds max value (${s}). Rotating to 0.`),s=0),w[t][r]=s},beginTransaction(){O(),S.transitionTo(d.TRANSACTING)},async addPartitionsToTransaction(e){O();const t={};e.forEach((({topic:e,partitions:r})=>{E[e]=E[e]||{},r.forEach((({partition:r})=>{E[e][r]||(t[e]=t[e]||[],t[e].push(r))}))}));const r=Object.keys(t).map((e=>({topic:e,partitions:t[e]})));if(r.length){const e=await A();await e.addPartitionsToTxn({transactionalId:f,producerId:I,producerEpoch:y,topics:r})}r.forEach((({topic:e,partitions:t})=>{t.forEach((t=>{E[e][t]=!0}))}))},async commit(){if(O(),S.transitionTo(d.COMMITTING),!C())return e.debug("No partitions or offsets registered, not sending EndTxn"),void S.transitionTo(d.READY);const t=await A();await t.endTxn({producerId:I,producerEpoch:y,transactionalId:f,transactionResult:!0}),S.transitionTo(d.READY)},async abort(){if(O(),S.transitionTo(d.ABORTING),!C())return e.debug("No partitions or offsets registered, not sending EndTxn"),void S.transitionTo(d.READY);const t=await A();await t.endTxn({producerId:I,producerEpoch:y,transactionalId:f,transactionResult:!1}),S.transitionTo(d.READY)},isInitialized:()=>-1!==I,isTransactional:()=>m,isInTransaction:()=>S.state()===d.TRANSACTING,async acquireBrokerLock(e){this.isInitialized()&&(T[e.nodeId]=T[e.nodeId]||new s({timeout:65535}),await T[e.nodeId].acquire())},releaseBrokerLock(e){this.isInitialized()&&T[e.nodeId].release()},async sendOffsets({consumerGroupId:r,topics:o}){p(r,"Missing consumerGroupId"),p(o,"Missing offset topics");const s=await A();await s.addOffsetsToTxn({transactionalId:f,producerId:I,producerEpoch:y,groupId:r}),b=!0;let i=await t.findGroupCoordinator({groupId:r,coordinatorType:n.GROUP});return g((async(s,a,c)=>{try{await i.txnOffsetCommit({transactionalId:f,producerId:I,producerEpoch:y,groupId:r,topics:o})}catch(o){if(l.includes(o.type))throw e.debug("Group coordinator is not ready yet, retrying",{error:o.message,stack:o.stack,transactionalId:f,retryCount:a,retryTime:c}),o;if(h.includes(o.type)||"ECONNREFUSED"===o.code)throw e.debug("Invalid group coordinator, finding new group coordinator and retrying",{error:o.message,stack:o.stack,transactionalId:f,retryCount:a,retryTime:c}),i=await t.findGroupCoordinator({groupId:r,coordinatorType:n.GROUP}),o;s(o)}}))}},{initProducerId:{legalStates:[d.UNINITIALIZED,d.READY]},beginTransaction:{legalStates:[d.READY],async:!1},addPartitionsToTransaction:{legalStates:[d.TRANSACTING]},sendOffsets:{legalStates:[d.TRANSACTING]},commit:{legalStates:[d.TRANSACTING]},abort:{legalStates:[d.TRANSACTING]}});return N}},1352:(e,t,r)=>{const{EventEmitter:o}=r(2361),{KafkaJSNonRetriableError:s}=r(9879),i=r(5497),n={[i.UNINITIALIZED]:[i.READY],[i.READY]:[i.READY,i.TRANSACTING],[i.TRANSACTING]:[i.COMMITTING,i.ABORTING],[i.COMMITTING]:[i.READY],[i.ABORTING]:[i.READY]};e.exports=({logger:e,initialState:t=i.UNINITIALIZED})=>{let r=t;const a=Object.assign(new o,{createGuarded(e,t){const o=Object.keys(t).reduce(((o,i)=>(o[i]=((e,t,{legalStates:o,async:i=!0})=>{if(!e[t])throw new s(`Cannot add guard on missing method "${t}"`);return(...n)=>{const a=e[t];if(!o.includes(r)){const e=new s(`Transaction state exception: Cannot call "${t}" in state "${r}"`);if(i)return Promise.reject(e);throw e}return a.apply(e,n)}})(e,i,t[i]),o)),{});return{...e,...o}},transitionTo(t){if(e.debug(`Transaction state transition ${r} --\x3e ${t}`),!n[r].includes(t))throw new s(`Transaction state exception: Invalid transition ${r} --\x3e ${t}`);a.emit("transition",{to:t,from:r}),r=t},state:()=>r});return a}},5497:e=>{e.exports={UNINITIALIZED:"UNINITIALIZED",READY:"READY",TRANSACTING:"TRANSACTING",COMMITTING:"COMMITTING",ABORTING:"ABORTING"}},65:e=>{e.exports=({topic:e,partitionMetadata:t,messages:r,partitioner:o})=>0===t.length?{}:r.reduce(((r,s)=>{const i=o({topic:e,partitionMetadata:t,message:s}),n=r[i]||[];return Object.assign(r,{[i]:[...n,s]})}),{})},3798:(e,t,r)=>{const o=r(9701),{CONNECTION_STATUS:s}=r(5315),{DefaultPartitioner:i}=r(8691),n=r(2190),a=r(6236),c=r(3062),{events:p,wrap:d,unwrap:u}=r(7293),{KafkaJSNonRetriableError:l}=r(9879),{values:h,keys:m}=Object,f=h(p),g=m(p).map((e=>`producer.events.${e}`)).join(", "),{CONNECT:I,DISCONNECT:y}=p;e.exports=({cluster:e,logger:t,createPartitioner:r=i,retry:h,idempotent:m=!1,transactionalId:w,transactionTimeout:T,instrumentationEmitter:E})=>{let b=s.DISCONNECTED;if(h=h||{retries:m?Number.MAX_SAFE_INTEGER:5},m&&h.retries<1)throw new l("Idempotent producer must allow retries to protect against transient errors");const S=t.namespace("Producer");m&&h.retries<Number.MAX_SAFE_INTEGER&&S.warn("Limiting retries for the idempotent producer may invalidate EoS guarantees");const A=r(),O=o(Object.assign({},e.retry,h)),C=E||new n,N=a({logger:S,cluster:e,transactionTimeout:T,transactional:!1,transactionalId:w}),{send:R,sendBatch:k}=c({logger:S,cluster:e,partitioner:A,eosManager:N,idempotent:m,retrier:O,getConnectionStatus:()=>b});let x;return{connect:async()=>{await e.connect(),b=s.CONNECTED,C.emit(I),m&&!N.isInitialized()&&await N.initProducerId()},disconnect:async()=>{b=s.DISCONNECTING,await e.disconnect(),b=s.DISCONNECTED,C.emit(y)},isIdempotent:()=>m,events:p,on:(e,t)=>{if(!f.includes(e))throw new l(`Event name should be one of ${g}`);return C.addListener(u(e),(r=>{r.type=d(r.type),Promise.resolve(t(r)).catch((t=>{S.error(`Failed to execute listener: ${t.message}`,{eventName:e,stack:t.stack})}))}))},send:R,sendBatch:k,transaction:async()=>{if(!w)throw new l("Must provide transactional id for transactional producer");let t=!1;if(x=x||a({logger:S,cluster:e,transactionTimeout:T,transactional:!0,transactionalId:w}),x.isInTransaction())throw new l("There is already an ongoing transaction for this producer. Please end the transaction before beginning another.");x.isInitialized()||await x.initProducerId(),x.beginTransaction();const{send:r,sendBatch:o}=c({logger:S,cluster:e,partitioner:A,retrier:O,eosManager:x,idempotent:!0,getConnectionStatus:()=>b}),s=()=>x.isInTransaction()&&!t,i=e=>(...t)=>s()?e(...t):Promise.reject(new l("Cannot continue to use transaction once ended"));return{sendBatch:i(o),send:i(r),abort:i((async()=>{await x.abort(),t=!0})),commit:i((async()=>{await x.commit(),t=!0})),sendOffsets:i((async({consumerGroupId:t,topics:r})=>{await x.sendOffsets({consumerGroupId:t,topics:r});for(const o of r){const{topic:r,partitions:s}=o;for(const{partition:o,offset:i}of s)e.markOffsetAsCommitted({groupId:t,topic:r,partition:o,offset:i})}})),isActive:s}},logger:()=>S}}},7293:(e,t,r)=>{const o=r(76),s=r(8202),i=r(1429)("producer"),n={CONNECT:i("connect"),DISCONNECT:i("disconnect"),REQUEST:i(s.NETWORK_REQUEST),REQUEST_TIMEOUT:i(s.NETWORK_REQUEST_TIMEOUT),REQUEST_QUEUE_SIZE:i(s.NETWORK_REQUEST_QUEUE_SIZE)},a={[n.REQUEST]:s.NETWORK_REQUEST,[n.REQUEST_TIMEOUT]:s.NETWORK_REQUEST_TIMEOUT,[n.REQUEST_QUEUE_SIZE]:s.NETWORK_REQUEST_QUEUE_SIZE},c=o(a);e.exports={events:n,wrap:e=>c[e]||e,unwrap:e=>a[e]||e}},3062:(e,t,r)=>{const o=r(9326),{KafkaJSError:s,KafkaJSNonRetriableError:i}=r(9879),{CONNECTION_STATUS:n}=r(5315);e.exports=({logger:e,cluster:t,partitioner:r,eosManager:a,idempotent:c,retrier:p,getConnectionStatus:d})=>{const u=o({logger:e,cluster:t,retrier:p,partitioner:r,eosManager:a}),l=async({acks:e=-1,timeout:t,compression:r,topicMessages:o=[]})=>{if(o.some((({topic:e})=>!e)))throw new i("Invalid topic");if(c&&-1!==e)throw new i("Not requiring ack for all messages invalidates the idempotent producer's EoS guarantees");for(const{topic:e,messages:t}of o){if(!t)throw new i(`Invalid messages array [${t}] for topic "${e}"`);const r=t.find((e=>void 0===e.value));if(r)throw new i(`Invalid message without value for topic "${e}": ${JSON.stringify(r)}`)}(()=>{switch(d()){case n.DISCONNECTING:throw new i("The producer is disconnecting; therefore, it can't safely accept messages anymore");case n.DISCONNECTED:throw new s("The producer is disconnected")}})();const a=o.reduce(((e,{topic:t,messages:r})=>{const o=e.findIndex((({topic:e})=>t===e));return-1===o?e.push({topic:t,messages:r}):e[o].messages=[...e[o].messages,...r],e}),[]);return await u({acks:e,timeout:t,compression:r,topicMessages:a})};return{send:async({acks:e,timeout:t,compression:r,topic:o,messages:s})=>l({acks:e,timeout:t,compression:r,topicMessages:[{topic:o,messages:s}]}),sendBatch:l}}},4655:(e,t,r)=>{const o=r(9416),s=r(3731);e.exports=s(o)},9416:(e,t,r)=>{const o=r(3278),s=o.fromValue(2538058380),i=o.fromValue(1540483477),n=o.fromValue(24);e.exports=e=>{const t=Buffer.isBuffer(e)?e:Buffer.from(String(e)),r=t.length;let a=o.fromValue(s.xor(r)),c=Math.floor(r/4);for(let e=0;e<c;e++){const r=4*e;let s=(255&t[r+0])+((255&t[r+1])<<8)+((255&t[r+2])<<16)+((255&t[r+3])<<24);s=o.fromValue(s),s=s.multiply(i),s=s.xor(s.toInt()>>>n),s=o.fromValue(s).multiply(i),a=a.multiply(i),a=a.xor(s)}switch(r%4){case 3:a=a.xor((255&t[2+(-4&r)])<<16);case 2:a=a.xor((255&t[1+(-4&r)])<<8);case 1:a=a.xor(255&t[-4&r]),a=a.multiply(i)}return a=a.xor(a.toInt()>>>13),a=a.multiply(i),a=a.xor(a.toInt()>>>15),a.toInt()}},8691:(e,t,r)=>{const o=r(4655),s=r(7932);e.exports={DefaultPartitioner:o,LegacyPartitioner:s,JavaCompatiblePartitioner:o}},7932:(e,t,r)=>{const o=r(9863),s=r(3731);e.exports=s(o)},9863:e=>{const t=1540483477;e.exports=e=>{const r=Buffer.isBuffer(e)?e:Buffer.from(String(e)),o=r.length;let s=2538058380^o,i=o/4;for(let e=0;e<i;e++){const o=4*e;let i=(255&r[o+0])+((255&r[o+1])<<8)+((255&r[o+2])<<16)+((255&r[o+3])<<24);i*=t,i^=i>>>24,i*=t,s*=t,s^=i}switch(o%4){case 3:s^=(255&r[2+(-4&o)])<<16;case 2:s^=(255&r[1+(-4&o)])<<8;case 1:s^=255&r[-4&o],s*=t}return s^=s>>>13,s*=t,s^=s>>>15,s}},3731:(e,t,r)=>{const o=r(4783),s=e=>2147483647&e;e.exports=e=>()=>{const t={};return({topic:r,partitionMetadata:i,message:n})=>{r in t||(t[r]=o(32).readUInt32BE(0));const a=i.length,c=i.filter((e=>e.leader>=0)),p=c.length;return null!==n.partition&&void 0!==n.partition?n.partition:null!==n.key&&void 0!==n.key?s(e(n.key))%a:p>0?c[s(++t[r])%p].partitionId:s(++t[r])%a}}},4783:(e,t,r)=>{const{KafkaJSNonRetriableError:o}=r(9879),s=e=>({randomBytes:t=>e.getRandomValues(Buffer.allocUnsafe(t))});let i=null;global&&global.crypto?i=void 0===global.crypto.randomBytes?s(global.crypto):global.crypto:global&&global.msCrypto?i=s(global.msCrypto):global&&!global.crypto&&(i=r(6113)),e.exports=e=>{if(e>65536)throw new o(`Byte length (${e}) exceeds the max number of bytes of entropy available (65536)`);if(!i)throw new o("No available crypto implementation");return i.randomBytes(e)}},922:e=>{e.exports=({topics:e})=>e.flatMap((({topicName:e,partitions:t})=>t.map((t=>({topicName:e,...t})))))},9326:(e,t,r)=>{const{KafkaJSMetadataNotLoaded:o}=r(9879),{staleMetadata:s}=r(1701),i=r(65),n=r(8460),a=r(922),{keys:c}=Object;e.exports=({logger:e,cluster:t,partitioner:r,eosManager:p,retrier:d})=>async({acks:u,timeout:l,compression:h,topicMessages:m})=>{const f=new Map;return d((async(d,g,I)=>{const y=m.map((({topic:e})=>e));await t.addMultipleTargetTopics(y);try{const s=await(async s=>{const d=new Map;await t.refreshMetadataIfNecessary();for(const{topic:n,messages:a}of m){const p=t.findTopicPartitionMetadata(n);if(0===p.length)throw e.debug("Producing to topic without metadata",{topic:n,targetTopics:Array.from(t.targetTopics)}),new o("Producing to topic without metadata");const u=i({topic:n,partitionMetadata:p,messages:a,partitioner:r}),l=c(u),h=t.findLeaderForPartitions(n,l),m=c(h);d.set(n,{partitionsPerLeader:h,messagesPerPartition:u});for(const e of m){const r=await t.findBroker({nodeId:e});s.has(r)||s.set(r,null)}}return Array.from(s.keys()).filter((e=>!s.get(e))).map((async e=>{const t=Array.from(d.entries()).filter((([t,{partitionsPerLeader:r}])=>!!r[e.nodeId])).map((([t,{partitionsPerLeader:r,messagesPerPartition:o,sequencePerPartition:s}])=>({topic:t,partitions:r[e.nodeId],messagesPerPartition:o}))),r=n(t);await p.acquireBrokerLock(e);try{let t;p.isTransactional()&&await p.addPartitionsToTransaction(r),r.forEach((({topic:e,partitions:t})=>{t.forEach((t=>{t.firstSequence=p.getSequence(e,t.partition),p.updateSequence(e,t.partition,t.messages.length)}))}));try{t=await e.produce({transactionalId:p.isTransactional()?p.getTransactionalId():void 0,producerId:p.getProducerId(),producerEpoch:p.getProducerEpoch(),acks:u,timeout:l,compression:h,topicData:r})}catch(e){throw r.forEach((({topic:e,partitions:t})=>{t.forEach((t=>{p.updateSequence(e,t.partition,-t.messages.length)}))})),e}const o=0!==u?a(t):[];s.set(e,o)}catch(t){throw s.delete(e),t}finally{await p.releaseBrokerLock(e)}}))})(f);return await Promise.all(s),Array.from(f.values()).flat()}catch(r){if("KafkaJSConnectionClosedError"===r.name&&t.removeBroker({host:r.host,port:r.port}),!t.isConnected())throw e.debug(`Cluster has disconnected, reconnecting: ${r.message}`,{retryCount:g,retryTime:I}),await t.connect(),await t.refreshMetadata(),r;if(s(r)||"KafkaJSMetadataNotLoaded"===r.name||"KafkaJSConnectionError"===r.name||"KafkaJSConnectionClosedError"===r.name||"KafkaJSProtocolError"===r.name&&r.retriable)throw e.error(`Failed to send messages: ${r.message}`,{retryCount:g,retryTime:I}),await t.refreshMetadata(),r;if(e.error(`${r.message}`,{retryCount:g,retryTime:I}),r.retriable)throw r;d(r)}}))}},3595:e=>{e.exports={UNKNOWN:0,ANY:1,ALL:2,READ:3,WRITE:4,CREATE:5,DELETE:6,ALTER:7,DESCRIBE:8,CLUSTER_ACTION:9,DESCRIBE_CONFIGS:10,ALTER_CONFIGS:11,IDEMPOTENT_WRITE:12}},4517:e=>{e.exports={UNKNOWN:0,ANY:1,DENY:2,ALLOW:3}},7666:e=>{e.exports={UNKNOWN:0,ANY:1,TOPIC:2,GROUP:3,CLUSTER:4,TRANSACTIONAL_ID:5,DELEGATION_TOKEN:6}},8279:e=>{e.exports={UNKNOWN:0,TOPIC:2,BROKER:4,BROKER_LOGGER:8}},9955:e=>{e.exports={UNKNOWN:0,TOPIC_CONFIG:1,DYNAMIC_BROKER_CONFIG:2,DYNAMIC_DEFAULT_BROKER_CONFIG:3,STATIC_BROKER_CONFIG:4,DEFAULT_CONFIG:5,DYNAMIC_BROKER_LOGGER_CONFIG:6}},7022:e=>{e.exports={GROUP:0,TRANSACTION:1}},1574:e=>{var t=new Int32Array([0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117]);e.exports=e=>{const{buffer:r}=e,o=r.length;let s=-1;for(let e=0;e<o;e++)s=t[255&(s^r[e])]^s>>>8;return-1^s}},6341:(e,t,r)=>{const{KafkaJSInvalidVarIntError:o,KafkaJSInvalidLongError:s}=r(9879),i=r(3278);e.exports=class e{static int32Size(){return 4}static decodeZigZag(e){return e>>>1^-(1&e)}static decodeZigZag64(e){return e.shiftRightUnsigned(1).xor(e.and(i.fromInt(1)).negate())}constructor(e){this.buffer=e,this.offset=0}readInt8(){const e=this.buffer.readInt8(this.offset);return this.offset+=1,e}canReadInt16(){return this.canReadBytes(2)}readInt16(){const e=this.buffer.readInt16BE(this.offset);return this.offset+=2,e}canReadInt32(){return this.canReadBytes(4)}readInt32(){const e=this.buffer.readInt32BE(this.offset);return this.offset+=4,e}canReadInt64(){return this.canReadBytes(8)}readInt64(){const e=this.buffer[this.offset],t=this.buffer[this.offset+7],r=(e<<24)+65536*this.buffer[this.offset+1]+256*this.buffer[this.offset+2]+this.buffer[this.offset+3],o=this.buffer[this.offset+4]*2**24+65536*this.buffer[this.offset+5]+256*this.buffer[this.offset+6]+t;return this.offset+=8,(BigInt(r)<<32n)+BigInt(o)}readDouble(){const e=this.buffer.readDoubleBE(this.offset);return this.offset+=8,e}readString(){const e=this.readInt16();if(-1===e)return null;const t=this.buffer.slice(this.offset,this.offset+e).toString("utf8");return this.offset+=e,t}readVarIntString(){const e=this.readVarInt();if(-1===e)return null;const t=this.buffer.slice(this.offset,this.offset+e).toString("utf8");return this.offset+=e,t}readUVarIntString(){const e=this.readUVarInt();if(0===e)return null;const t=this.buffer.slice(this.offset,this.offset+e).toString("utf8");return this.offset+=e,t}canReadBytes(e){return Buffer.byteLength(this.buffer)-this.offset>=e}readBytes(e=this.readInt32()){if(-1===e)return null;const t=this.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}readVarIntBytes(){const e=this.readVarInt();if(-1===e)return null;const t=this.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}readUVarIntBytes(){const e=this.readUVarInt();if(0===e)return null;const t=this.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}readBoolean(){return 1===this.readInt8()}readAll(){const e=this.buffer.slice(this.offset);return this.offset+=Buffer.byteLength(this.buffer),e}readArray(e){const t=this.readInt32();if(-1===t)return[];const r=new Array(t);for(let o=0;o<t;o++)r[o]=e(this);return r}readVarIntArray(e){const t=this.readVarInt();if(-1===t)return[];const r=new Array(t);for(let o=0;o<t;o++)r[o]=e(this);return r}readUVarIntArray(e){const t=this.readUVarInt();if(0===t)return[];const r=new Array(t-1);for(let o=0;o<t-1;o++)r[o]=e(this);return r}async readArrayAsync(e){const t=this.readInt32();if(-1===t)return[];const r=new Array(t);for(let o=0;o<t;o++)r[o]=await e(this);return r}readVarInt(){let t,r=0,o=0;do{t=this.buffer[this.offset++],r+=(127&t)<<o,o+=7}while(t>=128);return e.decodeZigZag(r)}readUVarInt(){let e,t=0,r=0;for(;0!=(128&(e=this.buffer[this.offset++]));)if(t|=(127&e)<<r,r+=7,r>28)throw new o("Invalid VarInt, must contain 5 bytes or less");return t|=e<<r,t>>>0}readVarLong(){let t,r=i.fromInt(0),o=0;do{if(o>63)throw new s("Invalid Long, must contain 9 bytes or less");t=this.buffer[this.offset++],r=r.add(i.fromInt(127&t).shiftLeft(o)),o+=7}while(t>=128);return e.decodeZigZag64(r)}slice(t){return new e(this.buffer.slice(this.offset,this.offset+t))}forward(e){this.offset+=e}}},8783:(e,t,r)=>{const o=r(3278),s=4294967168,i=0xffffffffffffff80n;e.exports=class e{static encodeZigZag(e){return e<<1^e>>31}static encodeZigZag64(e){const t=o.fromValue(e);return t.shiftLeft(1).xor(t.shiftRight(63))}static sizeOfVarInt(e){let t=this.encodeZigZag(e),r=1;for(;0!=(t&s);)r+=1,t>>>=7;return r}static sizeOfVarLong(t){let r=e.encodeZigZag64(t),s=1;for(;r.and(i).notEquals(o.fromInt(0));)s+=1,r=r.shiftRightUnsigned(7);return s}static sizeOfVarIntBytes(t){const r=null==t?-1:Buffer.byteLength(t);return r<0?e.sizeOfVarInt(-1):e.sizeOfVarInt(r)+r}static nextPowerOfTwo(e){return 1<<31-Math.clz32(e)+1}constructor(t=511){this.buf=Buffer.alloc(e.nextPowerOfTwo(t)),this.offset=0}writeBufferInternal(e){const t=e.length;this.ensureAvailable(t),e.copy(this.buf,this.offset,0),this.offset+=t}ensureAvailable(t){if(this.offset+t>this.buf.length){const r=e.nextPowerOfTwo(this.offset+t),o=Buffer.alloc(r);this.buf.copy(o,0,0,this.offset),this.buf=o}}get buffer(){return this.buf.slice(0,this.offset)}writeInt8(e){return this.ensureAvailable(1),this.buf.writeInt8(e,this.offset),this.offset+=1,this}writeInt16(e){return this.ensureAvailable(2),this.buf.writeInt16BE(e,this.offset),this.offset+=2,this}writeInt32(e){return this.ensureAvailable(4),this.buf.writeInt32BE(e,this.offset),this.offset+=4,this}writeUInt32(e){return this.ensureAvailable(4),this.buf.writeUInt32BE(e,this.offset),this.offset+=4,this}writeInt64(e){this.ensureAvailable(8);const t=o.fromValue(e);return this.buf.writeInt32BE(t.getHighBits(),this.offset),this.buf.writeInt32BE(t.getLowBits(),this.offset+4),this.offset+=8,this}writeDouble(e){return this.ensureAvailable(8),this.buf.writeDoubleBE(e,this.offset),this.offset+=8,this}writeBoolean(e){return e?this.writeInt8(1):this.writeInt8(0),this}writeString(e){if(null==e)return this.writeInt16(-1),this;const t=Buffer.byteLength(e,"utf8");return this.ensureAvailable(2+t),this.writeInt16(t),this.buf.write(e,this.offset,t,"utf8"),this.offset+=t,this}writeVarIntString(e){if(null==e)return this.writeVarInt(-1),this;const t=Buffer.byteLength(e,"utf8");return this.writeVarInt(t),this.ensureAvailable(t),this.buf.write(e,this.offset,t,"utf8"),this.offset+=t,this}writeUVarIntString(e){if(null==e)return this.writeUVarInt(0),this;const t=Buffer.byteLength(e,"utf8");return this.writeUVarInt(t+1),this.ensureAvailable(t),this.buf.write(e,this.offset,t,"utf8"),this.offset+=t,this}writeBytes(e){if(null==e)return this.writeInt32(-1),this;if(Buffer.isBuffer(e))this.ensureAvailable(4+e.length),this.writeInt32(e.length),this.writeBufferInternal(e);else{const t=String(e),r=Buffer.byteLength(t,"utf8");this.ensureAvailable(4+r),this.writeInt32(r),this.buf.write(t,this.offset,r,"utf8"),this.offset+=r}return this}writeVarIntBytes(e){if(null==e)return this.writeVarInt(-1),this;if(Buffer.isBuffer(e))this.writeVarInt(e.length),this.writeBufferInternal(e);else{const t=String(e),r=Buffer.byteLength(t,"utf8");this.writeVarInt(r),this.ensureAvailable(r),this.buf.write(t,this.offset,r,"utf8"),this.offset+=r}return this}writeUVarIntBytes(e){if(null==e)return this.writeVarInt(0),this;if(Buffer.isBuffer(e))this.writeUVarInt(e.length+1),this.writeBufferInternal(e);else{const t=String(e),r=Buffer.byteLength(t,"utf8");this.writeUVarInt(r+1),this.ensureAvailable(r),this.buf.write(t,this.offset,r,"utf8"),this.offset+=r}return this}writeEncoder(e){if(null==e||!Buffer.isBuffer(e.buf))throw new Error("value should be an instance of Encoder");return this.writeBufferInternal(e.buffer),this}writeEncoderArray(e){if(!Array.isArray(e)||e.some((e=>null==e||!Buffer.isBuffer(e.buf))))throw new Error("all values should be an instance of Encoder[]");return e.forEach((e=>{this.writeBufferInternal(e.buffer)})),this}writeBuffer(e){if(!Buffer.isBuffer(e))throw new Error("value should be an instance of Buffer");return this.writeBufferInternal(e),this}writeNullableArray(e,t){const r=0!==e.length?e.length:-1;return this.writeArray(e,t,r),this}writeArray(e,t,r){const o=null==r?e.length:r;if(this.writeInt32(o),void 0!==t)switch(t){case"int32":case"number":e.forEach((e=>this.writeInt32(e)));break;case"string":e.forEach((e=>this.writeString(e)));break;case"object":this.writeEncoderArray(e)}else e.forEach((e=>{switch(typeof e){case"number":this.writeInt32(e);break;case"string":this.writeString(e);break;case"object":this.writeEncoder(e)}}));return this}writeVarIntArray(e,t){if("object"===t)this.writeVarInt(e.length),this.writeEncoderArray(e);else{const t=e.filter((e=>"object"==typeof e));this.writeVarInt(t.length),this.writeEncoderArray(t)}return this}writeUVarIntArray(e,t){if("object"===t)this.writeUVarInt(e.length+1),this.writeEncoderArray(e);else{const t=e.filter((e=>"object"==typeof e));this.writeUVarInt(t.length+1),this.writeEncoderArray(t)}return this}writeVarInt(t){return this.writeUVarInt(e.encodeZigZag(t))}writeUVarInt(e){const t=[];for(;0!=(e&s);)t.push(127&e|128),e>>>=7;return t.push(127&e),this.writeBufferInternal(Buffer.from(t)),this}writeVarLong(t){const r=[];let s=e.encodeZigZag64(t);for(;s.and(i).notEquals(o.fromInt(0));)r.push(s.and(127).or(128).toInt()),s=s.shiftRightUnsigned(7);return r.push(s.toInt()),this.writeBufferInternal(Buffer.from(r)),this}size(){return this.offset}toJSON(){return this.buffer.toJSON()}}},1701:(e,t,r)=>{const{KafkaJSProtocolError:o}=r(9879),s=r(6779),i=[{type:"UNKNOWN",code:-1,retriable:!1,message:"The server experienced an unexpected error when processing the request"},{type:"OFFSET_OUT_OF_RANGE",code:1,retriable:!1,message:"The requested offset is not within the range of offsets maintained by the server"},{type:"CORRUPT_MESSAGE",code:2,retriable:!0,message:"This message has failed its CRC checksum, exceeds the valid size, or is otherwise corrupt"},{type:"UNKNOWN_TOPIC_OR_PARTITION",code:3,retriable:!0,message:"This server does not host this topic-partition"},{type:"INVALID_FETCH_SIZE",code:4,retriable:!1,message:"The requested fetch size is invalid"},{type:"LEADER_NOT_AVAILABLE",code:5,retriable:!0,message:"There is no leader for this topic-partition as we are in the middle of a leadership election"},{type:"NOT_LEADER_FOR_PARTITION",code:6,retriable:!0,message:"This server is not the leader for that topic-partition"},{type:"REQUEST_TIMED_OUT",code:7,retriable:!0,message:"The request timed out"},{type:"BROKER_NOT_AVAILABLE",code:8,retriable:!1,message:"The broker is not available"},{type:"REPLICA_NOT_AVAILABLE",code:9,retriable:!0,message:"The replica is not available for the requested topic-partition"},{type:"MESSAGE_TOO_LARGE",code:10,retriable:!1,message:"The request included a message larger than the max message size the server will accept"},{type:"STALE_CONTROLLER_EPOCH",code:11,retriable:!1,message:"The controller moved to another broker"},{type:"OFFSET_METADATA_TOO_LARGE",code:12,retriable:!1,message:"The metadata field of the offset request was too large"},{type:"NETWORK_EXCEPTION",code:13,retriable:!0,message:"The server disconnected before a response was received"},{type:"GROUP_LOAD_IN_PROGRESS",code:14,retriable:!0,message:"The coordinator is loading and hence can't process requests for this group"},{type:"GROUP_COORDINATOR_NOT_AVAILABLE",code:15,retriable:!0,message:"The group coordinator is not available"},{type:"NOT_COORDINATOR_FOR_GROUP",code:16,retriable:!0,message:"This is not the correct coordinator for this group"},{type:"INVALID_TOPIC_EXCEPTION",code:17,retriable:!1,message:"The request attempted to perform an operation on an invalid topic"},{type:"RECORD_LIST_TOO_LARGE",code:18,retriable:!1,message:"The request included message batch larger than the configured segment size on the server"},{type:"NOT_ENOUGH_REPLICAS",code:19,retriable:!0,message:"Messages are rejected since there are fewer in-sync replicas than required"},{type:"NOT_ENOUGH_REPLICAS_AFTER_APPEND",code:20,retriable:!0,message:"Messages are written to the log, but to fewer in-sync replicas than required"},{type:"INVALID_REQUIRED_ACKS",code:21,retriable:!1,message:"Produce request specified an invalid value for required acks"},{type:"ILLEGAL_GENERATION",code:22,retriable:!1,message:"Specified group generation id is not valid"},{type:"INCONSISTENT_GROUP_PROTOCOL",code:23,retriable:!1,message:"The group member's supported protocols are incompatible with those of existing members"},{type:"INVALID_GROUP_ID",code:24,retriable:!1,message:"The configured groupId is invalid"},{type:"UNKNOWN_MEMBER_ID",code:25,retriable:!1,message:"The coordinator is not aware of this member"},{type:"INVALID_SESSION_TIMEOUT",code:26,retriable:!1,message:"The session timeout is not within the range allowed by the broker (as configured by group.min.session.timeout.ms and group.max.session.timeout.ms)"},{type:"REBALANCE_IN_PROGRESS",code:27,retriable:!1,message:"The group is rebalancing, so a rejoin is needed",helpUrl:s("docs/faq","what-does-it-mean-to-get-rebalance-in-progress-errors")},{type:"INVALID_COMMIT_OFFSET_SIZE",code:28,retriable:!1,message:"The committing offset data size is not valid"},{type:"TOPIC_AUTHORIZATION_FAILED",code:29,retriable:!1,message:"Not authorized to access topics: [Topic authorization failed]"},{type:"GROUP_AUTHORIZATION_FAILED",code:30,retriable:!1,message:"Not authorized to access group: Group authorization failed"},{type:"CLUSTER_AUTHORIZATION_FAILED",code:31,retriable:!1,message:"Cluster authorization failed"},{type:"INVALID_TIMESTAMP",code:32,retriable:!1,message:"The timestamp of the message is out of acceptable range"},{type:"UNSUPPORTED_SASL_MECHANISM",code:33,retriable:!1,message:"The broker does not support the requested SASL mechanism"},{type:"ILLEGAL_SASL_STATE",code:34,retriable:!1,message:"Request is not valid given the current SASL state"},{type:"UNSUPPORTED_VERSION",code:35,retriable:!1,message:"The version of API is not supported"},{type:"TOPIC_ALREADY_EXISTS",code:36,retriable:!1,message:"Topic with this name already exists"},{type:"INVALID_PARTITIONS",code:37,retriable:!1,message:"Number of partitions is invalid"},{type:"INVALID_REPLICATION_FACTOR",code:38,retriable:!1,message:"Replication-factor is invalid"},{type:"INVALID_REPLICA_ASSIGNMENT",code:39,retriable:!1,message:"Replica assignment is invalid"},{type:"INVALID_CONFIG",code:40,retriable:!1,message:"Configuration is invalid"},{type:"NOT_CONTROLLER",code:41,retriable:!0,message:"This is not the correct controller for this cluster"},{type:"INVALID_REQUEST",code:42,retriable:!1,message:"This most likely occurs because of a request being malformed by the client library or the message was sent to an incompatible broker. See the broker logs for more details"},{type:"UNSUPPORTED_FOR_MESSAGE_FORMAT",code:43,retriable:!1,message:"The message format version on the broker does not support the request"},{type:"POLICY_VIOLATION",code:44,retriable:!1,message:"Request parameters do not satisfy the configured policy"},{type:"OUT_OF_ORDER_SEQUENCE_NUMBER",code:45,retriable:!1,message:"The broker received an out of order sequence number"},{type:"DUPLICATE_SEQUENCE_NUMBER",code:46,retriable:!1,message:"The broker received a duplicate sequence number"},{type:"INVALID_PRODUCER_EPOCH",code:47,retriable:!1,message:"Producer attempted an operation with an old epoch. Either there is a newer producer with the same transactionalId, or the producer's transaction has been expired by the broker"},{type:"INVALID_TXN_STATE",code:48,retriable:!1,message:"The producer attempted a transactional operation in an invalid state"},{type:"INVALID_PRODUCER_ID_MAPPING",code:49,retriable:!1,message:"The producer attempted to use a producer id which is not currently assigned to its transactional id"},{type:"INVALID_TRANSACTION_TIMEOUT",code:50,retriable:!1,message:"The transaction timeout is larger than the maximum value allowed by the broker (as configured by max.transaction.timeout.ms)"},{type:"CONCURRENT_TRANSACTIONS",code:51,retriable:!0,message:"The producer attempted to update a transaction while another concurrent operation on the same transaction was ongoing"},{type:"TRANSACTION_COORDINATOR_FENCED",code:52,retriable:!1,message:"Indicates that the transaction coordinator sending a WriteTxnMarker is no longer the current coordinator for a given producer"},{type:"TRANSACTIONAL_ID_AUTHORIZATION_FAILED",code:53,retriable:!1,message:"Transactional Id authorization failed"},{type:"SECURITY_DISABLED",code:54,retriable:!1,message:"Security features are disabled"},{type:"OPERATION_NOT_ATTEMPTED",code:55,retriable:!1,message:"The broker did not attempt to execute this operation. This may happen for batched RPCs where some operations in the batch failed, causing the broker to respond without trying the rest"},{type:"KAFKA_STORAGE_ERROR",code:56,retriable:!0,message:"Disk error when trying to access log file on the disk"},{type:"LOG_DIR_NOT_FOUND",code:57,retriable:!1,message:"The user-specified log directory is not found in the broker config"},{type:"SASL_AUTHENTICATION_FAILED",code:58,retriable:!1,message:"SASL Authentication failed",helpUrl:s("docs/configuration","sasl")},{type:"UNKNOWN_PRODUCER_ID",code:59,retriable:!1,message:"This exception is raised by the broker if it could not locate the producer metadata associated with the producerId in question. This could happen if, for instance, the producer's records were deleted because their retention time had elapsed. Once the last records of the producerId are removed, the producer's metadata is removed from the broker, and future appends by the producer will return this exception"},{type:"REASSIGNMENT_IN_PROGRESS",code:60,retriable:!1,message:"A partition reassignment is in progress"},{type:"DELEGATION_TOKEN_AUTH_DISABLED",code:61,retriable:!1,message:"Delegation Token feature is not enabled"},{type:"DELEGATION_TOKEN_NOT_FOUND",code:62,retriable:!1,message:"Delegation Token is not found on server"},{type:"DELEGATION_TOKEN_OWNER_MISMATCH",code:63,retriable:!1,message:"Specified Principal is not valid Owner/Renewer"},{type:"DELEGATION_TOKEN_REQUEST_NOT_ALLOWED",code:64,retriable:!1,message:"Delegation Token requests are not allowed on PLAINTEXT/1-way SSL channels and on delegation token authenticated channels"},{type:"DELEGATION_TOKEN_AUTHORIZATION_FAILED",code:65,retriable:!1,message:"Delegation Token authorization failed"},{type:"DELEGATION_TOKEN_EXPIRED",code:66,retriable:!1,message:"Delegation Token is expired"},{type:"INVALID_PRINCIPAL_TYPE",code:67,retriable:!1,message:"Supplied principalType is not supported"},{type:"NON_EMPTY_GROUP",code:68,retriable:!1,message:"The group is not empty"},{type:"GROUP_ID_NOT_FOUND",code:69,retriable:!1,message:"The group id was not found"},{type:"FETCH_SESSION_ID_NOT_FOUND",code:70,retriable:!0,message:"The fetch session ID was not found"},{type:"INVALID_FETCH_SESSION_EPOCH",code:71,retriable:!0,message:"The fetch session epoch is invalid"},{type:"LISTENER_NOT_FOUND",code:72,retriable:!0,message:"There is no listener on the leader broker that matches the listener on which metadata request was processed"},{type:"TOPIC_DELETION_DISABLED",code:73,retriable:!1,message:"Topic deletion is disabled"},{type:"FENCED_LEADER_EPOCH",code:74,retriable:!0,message:"The leader epoch in the request is older than the epoch on the broker"},{type:"UNKNOWN_LEADER_EPOCH",code:75,retriable:!0,message:"The leader epoch in the request is newer than the epoch on the broker"},{type:"UNSUPPORTED_COMPRESSION_TYPE",code:76,retriable:!1,message:"The requesting client does not support the compression type of given partition"},{type:"STALE_BROKER_EPOCH",code:77,retriable:!1,message:"Broker epoch has changed"},{type:"OFFSET_NOT_AVAILABLE",code:78,retriable:!0,message:"The leader high watermark has not caught up from a recent leader election so the offsets cannot be guaranteed to be monotonically increasing"},{type:"MEMBER_ID_REQUIRED",code:79,retriable:!1,message:"The group member needs to have a valid member id before actually entering a consumer group"},{type:"PREFERRED_LEADER_NOT_AVAILABLE",code:80,retriable:!0,message:"The preferred leader was not available"},{type:"GROUP_MAX_SIZE_REACHED",code:81,retriable:!1,message:"The consumer group has reached its max size. It already has the configured maximum number of members"},{type:"FENCED_INSTANCE_ID",code:82,retriable:!1,message:"The broker rejected this static consumer since another consumer with the same group instance id has registered with a different member id"},{type:"ELIGIBLE_LEADERS_NOT_AVAILABLE",code:83,retriable:!0,message:"Eligible topic partition leaders are not available"},{type:"ELECTION_NOT_NEEDED",code:84,retriable:!0,message:"Leader election not needed for topic partition"},{type:"NO_REASSIGNMENT_IN_PROGRESS",code:85,retriable:!1,message:"No partition reassignment is in progress"},{type:"GROUP_SUBSCRIBED_TO_TOPIC",code:86,retriable:!1,message:"Deleting offsets of a topic is forbidden while the consumer group is actively subscribed to it"},{type:"INVALID_RECORD",code:87,retriable:!1,message:"This record has failed the validation on broker and hence be rejected"},{type:"UNSTABLE_OFFSET_COMMIT",code:88,retriable:!0,message:"There are unstable offsets that need to be cleared"}],n=e=>new o(i.find((t=>t.code===e))||{type:"KAFKAJS_UNKNOWN_ERROR_CODE",code:-99,retriable:!1,message:`Unknown error code ${e}`});e.exports={failure:e=>0!==e,errorCodes:i,createErrorFromCode:n,failIfVersionNotSupported:e=>{if(35===e)throw n(35)},staleMetadata:e=>["UNKNOWN_TOPIC_OR_PARTITION","LEADER_NOT_AVAILABLE","NOT_LEADER_FOR_PARTITION"].includes(e.type)}},2845:e=>{e.exports={READ_UNCOMMITTED:0,READ_COMMITTED:1}},4321:(e,t,r)=>{const o=r(3278),s=r(6341),i=r(2691),{lookupCodecByAttributes:n}=r(2972),{KafkaJSPartialMessageError:a}=r(9879);e.exports=async(e,t=null)=>{const r=[],o=t||e.readInt32(),i=e.slice(o);for(;i.offset<o;)try{const e=p(i),t=n(e.attributes);if(t){const o=await t.decompress(e.value);r.push(...c(new s(o),e))}else r.push(e)}catch(e){if("KafkaJSPartialMessageError"===e.name)break;if("KafkaJSUnsupportedMagicByteInMessageSet"===e.name)break;throw e}return e.forward(o),r};const c=(e,t)=>{const r=[];for(;e.offset<e.buffer.length;)r.push(p(e));if(t.magicByte>0&&t.offset>=0){const e=o.fromValue(t.offset)-o.fromValue(r[r.length-1].offset);for(const t of r)t.offset=o.fromValue(t.offset).add(e).toString()}return r},p=e=>{if(!e.canReadInt64())throw new a("Tried to decode a partial message: There isn't enough bytes to read the offset");const t=e.readInt64().toString();if(!e.canReadInt32())throw new a("Tried to decode a partial message: There isn't enough bytes to read the message size");const r=e.readInt32();return i(t,r,e)}},2032:(e,t,r)=>{const o=r(8783),s=r(6615),{Types:i}=r(2972);e.exports=({messageVersion:e=0,compression:t,entries:r})=>{const n=t!==i.None,a=s({version:e}),c=new o;return r.forEach(((e,t)=>{const r=a(e);c.writeInt64(n?t:-1),c.writeInt32(r.size()),c.writeEncoder(r)})),c}},6332:(e,t,r)=>{const{promisify:o}=r(3837),s=r(9796),i=o(s.gzip),n=o(s.unzip);e.exports={compress:async e=>await i(e.buffer),decompress:async e=>await n(e)}},2972:(e,t,r)=>{const{KafkaJSNotImplemented:o}=r(9879),s={None:0,GZIP:1,Snappy:2,LZ4:3,ZSTD:4},i={[s.GZIP]:()=>r(6332),[s.Snappy]:()=>{throw new o("Snappy compression not implemented")},[s.LZ4]:()=>{throw new o("LZ4 compression not implemented")},[s.ZSTD]:()=>{throw new o("ZSTD compression not implemented")}};e.exports={Types:s,Codecs:i,lookupCodec:e=>i[e]?i[e]():null,lookupCodecByAttributes:e=>{const t=i[7&e];return t?t():null},COMPRESSION_CODEC_MASK:7}},2691:(e,t,r)=>{const{KafkaJSPartialMessageError:o,KafkaJSUnsupportedMagicByteInMessageSet:s}=r(9879),i=r(2650),n=r(2801);e.exports=(e,t,r)=>{const a=Buffer.byteLength(r.slice(t).buffer);if(a<t)throw new o(`Tried to decode a partial message: remainingBytes(${a}) < messageSize(${t})`);const c=r.readInt32(),p=r.readInt8(),d=((e,t)=>{switch(t){case 0:return i(e);case 1:return n(e);default:throw new s(`Unsupported MessageSet message version, magic byte: ${t}`)}})(r,p);return Object.assign({offset:e,size:t,crc:c,magicByte:p},d)}},6615:(e,t,r)=>{const o={0:r(3154),1:r(6740)};e.exports=({version:e=0})=>o[e]},2650:e=>{e.exports=e=>({attributes:e.readInt8(),key:e.readBytes(),value:e.readBytes()})},3154:(e,t,r)=>{const o=r(8783),s=r(1574),{Types:i,COMPRESSION_CODEC_MASK:n}=r(2972);e.exports=({compression:e=i.None,key:t,value:r})=>{const a=(new o).writeInt8(0).writeInt8(e&n).writeBytes(t).writeBytes(r),c=s(a);return(new o).writeInt32(c).writeEncoder(a)}},2801:e=>{e.exports=e=>({attributes:e.readInt8(),timestamp:e.readInt64().toString(),key:e.readBytes(),value:e.readBytes()})},6740:(e,t,r)=>{const o=r(8783),s=r(1574),{Types:i,COMPRESSION_CODEC_MASK:n}=r(2972);e.exports=({compression:e=i.None,timestamp:t=Date.now(),key:r,value:a})=>{const c=(new o).writeInt8(1).writeInt8(e&n).writeInt64(t).writeBytes(r).writeBytes(a),p=s(c);return(new o).writeInt32(p).writeEncoder(c)}},6911:e=>{e.exports=e=>{let r=-1;for(let o=0;o<e.length;o++)r=t[255&(r^e[o])]^r>>>8;return(-1^r)>>>0};var t=new Int32Array([0,4067132163,3778769143,324072436,3348797215,904991772,648144872,3570033899,2329499855,2024987596,1809983544,2575936315,1296289744,3207089363,2893594407,1578318884,274646895,3795141740,4049975192,51262619,3619967088,632279923,922689671,3298075524,2592579488,1760304291,2075979607,2312596564,1562183871,2943781820,3156637768,1313733451,549293790,3537243613,3246849577,871202090,3878099393,357341890,102525238,4101499445,2858735121,1477399826,1264559846,3107202533,1845379342,2677391885,2361733625,2125378298,820201905,3263744690,3520608582,598981189,4151959214,85089709,373468761,3827903834,3124367742,1213305469,1526817161,2842354314,2107672161,2412447074,2627466902,1861252501,1098587580,3004210879,2688576843,1378610760,2262928035,1955203488,1742404180,2511436119,3416409459,969524848,714683780,3639785095,205050476,4266873199,3976438427,526918040,1361435347,2739821008,2954799652,1114974503,2529119692,1691668175,2005155131,2247081528,3690758684,697762079,986182379,3366744552,476452099,3993867776,4250756596,255256311,1640403810,2477592673,2164122517,1922457750,2791048317,1412925310,1197962378,3037525897,3944729517,427051182,170179418,4165941337,746937522,3740196785,3451792453,1070968646,1905808397,2213795598,2426610938,1657317369,3053634322,1147748369,1463399397,2773627110,4215344322,153784257,444234805,3893493558,1021025245,3467647198,3722505002,797665321,2197175160,1889384571,1674398607,2443626636,1164749927,3070701412,2757221520,1446797203,137323447,4198817972,3910406976,461344835,3484808360,1037989803,781091935,3705997148,2460548119,1623424788,1939049696,2180517859,1429367560,2807687179,3020495871,1180866812,410100952,3927582683,4182430767,186734380,3756733383,763408580,1053836080,3434856499,2722870694,1344288421,1131464017,2971354706,1708204729,2545590714,2229949006,1988219213,680717673,3673779818,3383336350,1002577565,4010310262,493091189,238226049,4233660802,2987750089,1082061258,1395524158,2705686845,1972364758,2279892693,2494862625,1725896226,952904198,3399985413,3656866545,731699698,4283874585,222117402,510512622,3959836397,3280807620,837199303,582374963,3504198960,68661723,4135334616,3844915500,390545967,1230274059,3141532936,2825850620,1510247935,2395924756,2091215383,1878366691,2644384480,3553878443,565732008,854102364,3229815391,340358836,3861050807,4117890627,119113024,1493875044,2875275879,3090270611,1247431312,2660249211,1828433272,2141937292,2378227087,3811616794,291187481,34330861,4032846830,615137029,3603020806,3314634738,939183345,1776939221,2609017814,2295496738,2058945313,2926798794,1545135305,1330124605,3173225534,4084100981,17165430,307568514,3762199681,888469610,3332340585,3587147933,665062302,2042050490,2346497209,2559330125,1793573966,3190661285,1279665062,1595330642,2910671697])},3398:(e,t,r)=>{const o=r(6911);e.exports=e=>{return t=o(e),Uint32Array.from([t])[0];var t}},7778:e=>{e.exports=e=>({key:e.readVarIntString(),value:e.readVarIntBytes()})},9537:(e,t,r)=>{const o=r(8783);e.exports=({key:e,value:t})=>(new o).writeVarIntString(e).writeVarIntBytes(t)},1240:(e,t,r)=>{const o=r(3278),s=r(7778),i=r(2515);e.exports=(e,t={})=>{const{firstOffset:r,firstTimestamp:n,magicByte:a,isControlBatch:c=!1,timestampType:p,maxTimestamp:d}=t,u=e.readInt8(),l=e.readVarLong(),h=p===i.LOG_APPEND_TIME&&d?d:o.fromValue(n).add(l).toString(),m=e.readVarInt(),f=o.fromValue(r).add(m).toString(),g=e.readVarIntBytes(),I=e.readVarIntBytes(),y=e.readVarIntArray(s).reduce(((e,{key:t,value:r})=>({...e,[t]:void 0===e[t]?r:Array.isArray(e[t])?e[t].concat([r]):[e[t],r]})),{});return{magicByte:a,attributes:u,timestamp:h,offset:f,key:g,value:I,headers:y,isControlRecord:c,batchContext:t}}},6575:(e,t,r)=>{const o=r(8783),s=r(9537);e.exports=({offsetDelta:e=0,timestampDelta:t=0,key:r,value:n,headers:a={}})=>{const c=Object.keys(a).flatMap((e=>Array.isArray(a[e])?a[e].map((t=>({key:e,value:t}))):[{key:e,value:a[e]}])),p=1+o.sizeOfVarLong(t)+o.sizeOfVarInt(e)+o.sizeOfVarIntBytes(r)+o.sizeOfVarIntBytes(n)+i(c);return(new o).writeVarInt(p).writeInt8(0).writeVarLong(t).writeVarInt(e).writeVarIntBytes(r).writeVarIntBytes(n).writeVarIntArray(c.map(s))};const i=e=>{let t=o.sizeOfVarInt(e.length);for(const r of e){const e=Buffer.byteLength(r.key),s=Buffer.byteLength(r.value);t+=o.sizeOfVarInt(e)+e,null===r.value?t+=o.sizeOfVarInt(-1):t+=o.sizeOfVarInt(s)+s}return t}},3294:(e,t,r)=>{const o=r(6341),{KafkaJSPartialMessageError:s}=r(9879),{lookupCodecByAttributes:i}=r(2972),n=r(1240),a=r(2515);e.exports=async e=>{const t=e.readInt64().toString(),r=e.readInt32(),o=e.slice(r);e.forward(r);const n=Buffer.byteLength(o.buffer);if(n<r)throw new s(`Tried to decode a partial record batch: remainingBytes(${n}) < recordBatchLength(${r})`);const p=o.readInt32(),d=o.readInt8(),u=(o.readInt32(),o.readInt16()),l=o.readInt32(),h=o.readInt64().toString(),m=o.readInt64().toString(),f=o.readInt64().toString(),g=o.readInt16(),I=o.readInt32(),y=(16&u)>0,w=(32&u)>0,T=(8&u)>0?a.LOG_APPEND_TIME:a.CREATE_TIME,E=i(u),b={firstOffset:t,firstTimestamp:h,partitionLeaderEpoch:p,inTransaction:y,isControlBatch:w,lastOffsetDelta:l,producerId:f,producerEpoch:g,firstSequence:I,maxTimestamp:m,timestampType:T},S=await c(E,o,{...b,magicByte:d});return{...b,records:S}};const c=async(e,t,r)=>{if(!e)return t.readArray((e=>p(e,r)));const s=t.readInt32();if(s<=0)return[];const i=t.readAll(),n=await e.decompress(i),a=new o(n),c=new Array(s);for(let e=0;e<s;e++)c[e]=p(a,r);return c},p=(e,t)=>{const r=e.readVarIntBytes();return n(new o(r),t)}},2872:(e,t,r)=>{const o=r(3278),s=r(8783),i=r(3398),{Types:n,lookupCodec:a,COMPRESSION_CODEC_MASK:c}=r(2972);e.exports={RecordBatch:async({compression:e=n.None,firstOffset:t=o.fromInt(0),firstTimestamp:r=Date.now(),maxTimestamp:p=Date.now(),partitionLeaderEpoch:d=0,lastOffsetDelta:u=0,transactional:l=!1,producerId:h=o.fromValue(-1),producerEpoch:m=0,firstSequence:f=0,records:g=[]})=>{const I=0|e&c|(l?16:0),y=(new s).writeInt16(I).writeInt32(u).writeInt64(r).writeInt64(p).writeInt64(h).writeInt16(m).writeInt32(f);if(e===n.None)g.every((e=>typeof e==typeof g[0]))?y.writeArray(g,typeof g[0]):y.writeArray(g);else{const t=await(async(e,t)=>{const r=a(e),o=new s;return o.writeEncoderArray(t),r.compress(o)})(e,g);y.writeInt32(g.length).writeBuffer(t)}const w=(new s).writeInt32(d).writeInt8(2).writeUInt32(i(y.buffer)).writeEncoder(y);return(new s).writeInt64(t).writeBytes(w.buffer)},MAGIC_BYTE:2}},2882:(e,t,r)=>{const o=r(8783);e.exports=async({correlationId:e,clientId:t,request:{apiKey:r,apiVersion:s,encode:i}})=>{const n=await i(),a=(new o).writeInt16(r).writeInt16(s).writeInt32(e).writeString(t).writeEncoder(n);return(new o).writeInt32(a.size()).writeEncoder(a)}},4530:(e,t,r)=>{const o={0:({transactionalId:e,producerId:t,producerEpoch:o,groupId:s})=>{const i=r(8831),n=r(2374);return{request:i({transactionalId:e,producerId:t,producerEpoch:o,groupId:s}),response:n}},1:({transactionalId:e,producerId:t,producerEpoch:o,groupId:s})=>{const i=r(3347),n=r(2058);return{request:i({transactionalId:e,producerId:t,producerEpoch:o,groupId:s}),response:n}}};e.exports={versions:Object.keys(o),protocol:({version:e})=>o[e]}},8831:(e,t,r)=>{const o=r(8783),{AddOffsetsToTxn:s}=r(9211);e.exports=({transactionalId:e,producerId:t,producerEpoch:r,groupId:i})=>({apiKey:s,apiVersion:0,apiName:"AddOffsetsToTxn",encode:async()=>(new o).writeString(e).writeInt64(t).writeInt16(r).writeString(i)})},2374:(e,t,r)=>{const o=r(6341),{failure:s,createErrorFromCode:i,failIfVersionNotSupported:n}=r(1701);e.exports={decode:async e=>{const t=new o(e),r=t.readInt32(),s=t.readInt16();return n(s),{throttleTime:r,errorCode:s}},parse:async e=>{if(s(e.errorCode))throw i(e.errorCode);return e}}},3347:(e,t,r)=>{const o=r(8831);e.exports=({transactionalId:e,producerId:t,producerEpoch:r,groupId:s})=>Object.assign(o({transactionalId:e,producerId:t,producerEpoch:r,groupId:s}),{apiVersion:1})},2058:(e,t,r)=>{const{parse:o,decode:s}=r(2374);e.exports={decode:async e=>{const t=await s(e);return{...t,throttleTime:0,clientSideThrottleTime:t.throttleTime}},parse:o}},3350:(e,t,r)=>{const o={0:({transactionalId:e,producerId:t,producerEpoch:o,topics:s})=>{const i=r(1805),n=r(5256);return{request:i({transactionalId:e,producerId:t,producerEpoch:o,topics:s}),response:n}},1:({transactionalId:e,producerId:t,producerEpoch:o,topics:s})=>{const i=r(7919),n=r(1361);return{request:i({transactionalId:e,producerId:t,producerEpoch:o,topics:s}),response:n}}};e.exports={versions:Object.keys(o),protocol:({version:e})=>o[e]}},1805:(e,t,r)=>{const o=r(8783),{AddPartitionsToTxn:s}=r(9211);e.exports=({transactionalId:e,producerId:t,producerEpoch:r,topics:n})=>({apiKey:s,apiVersion:0,apiName:"AddPartitionsToTxn",encode:async()=>(new o).writeString(e).writeInt64(t).writeInt16(r).writeArray(n.map(i))});const i=({topic:e,partitions:t})=>(new o).writeString(e).writeArray(t.map(n)),n=e=>(new o).writeInt32(e)},5256:(e,t,r)=>{const o=r(6341),{failure:s,createErrorFromCode:i}=r(1701),n=async e=>({topic:e.readString(),partitionErrors:await e.readArrayAsync(a)}),a=e=>({partition:e.readInt32(),errorCode:e.readInt16()});e.exports={decode:async e=>{const t=new o(e);return{throttleTime:t.readInt32(),errors:await t.readArrayAsync(n)}},parse:async e=>{const t=e.errors.map((({partitionErrors:e})=>({partitionsWithErrors:e.filter((({errorCode:e})=>s(e)))}))).filter((({partitionsWithErrors:e})=>e.length));if(t.length>0)throw i(t[0].partitionsWithErrors[0].errorCode);return e}}},7919:(e,t,r)=>{const o=r(1805);e.exports=({transactionalId:e,producerId:t,producerEpoch:r,topics:s})=>Object.assign(o({transactionalId:e,producerId:t,producerEpoch:r,topics:s}),{apiVersion:1})},1361:(e,t,r)=>{const{parse:o,decode:s}=r(5256);e.exports={decode:async e=>{const t=await s(e);return{...t,throttleTime:0,clientSideThrottleTime:t.throttleTime}},parse:o}},1858:(e,t,r)=>{const o={0:({resources:e,validateOnly:t})=>{const o=r(7654),s=r(3829);return{request:o({resources:e,validateOnly:t}),response:s}},1:({resources:e,validateOnly:t})=>{const o=r(4836),s=r(9739);return{request:o({resources:e,validateOnly:t}),response:s}}};e.exports={versions:Object.keys(o),protocol:({version:e})=>o[e]}},7654:(e,t,r)=>{const o=r(8783),{AlterConfigs:s}=r(9211);e.exports=({resources:e,validateOnly:t=!1})=>({apiKey:s,apiVersion:0,apiName:"AlterConfigs",encode:async()=>(new o).writeArray(e.map(i)).writeBoolean(t)});const i=({type:e,name:t,configEntries:r})=>(new o).writeInt8(e).writeString(t).writeArray(r.map(n)),n=({name:e,value:t})=>(new o).writeString(e).writeString(t)},3829:(e,t,r)=>{const o=r(6341),{failure:s,createErrorFromCode:i}=r(1701),n=e=>({errorCode:e.readInt16(),errorMessage:e.readString(),resourceType:e.readInt8(),resourceName:e.readString()});e.exports={decode:async e=>{const t=new o(e);return{throttleTime:t.readInt32(),resources:t.readArray(n)}},parse:async e=>{const t=e.resources.filter((({errorCode:e})=>s(e)));if(t.length>0)throw i(t[0].errorCode);return e}}},4836:(e,t,r)=>{const o=r(7654);e.exports=({resources:e,validateOnly:t})=>Object.assign(o({resources:e,validateOnly:t}),{apiVersion:1})},9739:(e,t,r)=>{const{parse:o,decode:s}=r(3829);e.exports={decode:async e=>{const t=await s(e);return{...t,throttleTime:0,clientSideThrottleTime:t.throttleTime}},parse:o}},9211:e=>{e.exports={Produce:0,Fetch:1,ListOffsets:2,Metadata:3,LeaderAndIsr:4,StopReplica:5,UpdateMetadata:6,ControlledShutdown:7,OffsetCommit:8,OffsetFetch:9,GroupCoordinator:10,JoinGroup:11,Heartbeat:12,LeaveGroup:13,SyncGroup:14,DescribeGroups:15,ListGroups:16,SaslHandshake:17,ApiVersions:18,CreateTopics:19,DeleteTopics:20,DeleteRecords:21,InitProducerId:22,OffsetForLeaderEpoch:23,AddPartitionsToTxn:24,AddOffsetsToTxn:25,EndTxn:26,WriteTxnMarkers:27,TxnOffsetCommit:28,DescribeAcls:29,CreateAcls:30,DeleteAcls:31,DescribeConfigs:32,AlterConfigs:33,AlterReplicaLogDirs:34,DescribeLogDirs:35,SaslAuthenticate:36,CreatePartitions:37,CreateDelegationToken:38,RenewDelegationToken:39,ExpireDelegationToken:40,DescribeDelegationToken:41,DeleteGroups:42,ElectPreferredLeaders:43}},7020:(e,t,r)=>{const o={0:()=>{const e=r(92),t=r(2839);return{request:e(),response:t,logResponseError:!0}},1:()=>{const e=r(4778),t=r(4313);return{request:e(),response:t,logResponseError:!1}},2:()=>{const e=r(4125),t=r(3267);return{request:e(),response:t,logResponseError:!1}}};e.exports={versions:Object.keys(o),protocol:({version:e})=>o[e]}},92:(e,t,r)=>{const o=r(8783),{ApiVersions:s}=r(9211);e.exports=()=>({apiKey:s,apiVersion:0,apiName:"ApiVersions",encode:async()=>new o})},2839:(e,t,r)=>{const o=r(6341),{failure:s,createErrorFromCode:i,failIfVersionNotSupported:n}=r(1701),a=e=>({apiKey:e.readInt16(),minVersion:e.readInt16(),maxVersion:e.readInt16()});e.exports={decode:async e=>{const t=new o(e),r=t.readInt16();return n(r),{errorCode:r,apiVersions:t.readArray(a)}},parse:async e=>{if(s(e.errorCode))throw i(e.errorCode);return e}}},4778:(e,t,r)=>{const o=r(92);e.exports=()=>({...o(),apiVersion:1})},4313:(e,t,r)=>{const o=r(6341),{failIfVersionNotSupported:s}=r(1701),{parse:i}=r(2839),n=e=>({apiKey:e.readInt16(),minVersion:e.readInt16(),maxVersion:e.readInt16()});e.exports={decode:async e=>{const t=new o(e),r=t.readInt16();return s(r),{errorCode:r,apiVersions:t.readArray(n),throttleTime:t.canReadInt32()?t.readInt32():0}},parse:i}},4125:(e,t,r)=>{const o=r(92);e.exports=()=>({...o(),apiVersion:2})},3267:(e,t,r)=>{const{parse:o,decode:s}=r(4313);e.exports={decode:async e=>{const t=await s(e);return{...t,throttleTime:0,clientSideThrottleTime:t.throttleTime}},parse:o}},4950:(e,t,r)=>{const o={0:({creations:e})=>{const t=r(2073),o=r(8650);return{request:t({creations:e}),response:o}},1:({creations:e})=>{const t=r(160),o=r(1274);return{request:t({creations:e}),response:o}}};e.exports={versions:Object.keys(o),protocol:({version:e})=>o[e]}},2073:(e,t,r)=>{const o=r(8783),{CreateAcls:s}=r(9211),i=({resourceType:e,resourceName:t,principal:r,host:s,operation:i,permissionType:n})=>(new o).writeInt8(e).writeString(t).writeString(r).writeString(s).writeInt8(i).writeInt8(n);e.exports=({creations:e})=>({apiKey:s,apiVersion:0,apiName:"CreateAcls",encode:async()=>(new o).writeArray(e.map(i))})},8650:(e,t,r)=>{const o=r(6341),{failure:s,createErrorFromCode:i}=r(1701),n=e=>({errorCode:e.readInt16(),errorMessage:e.readString()});e.exports={decode:async e=>{const t=new o(e);return{throttleTime:t.readInt32(),creationResponses:t.readArray(n)}},parse:async e=>{const t=e.creationResponses.filter((({errorCode:e})=>s(e)));if(t.length>0)throw i(t[0].errorCode);return e}}},160:(e,t,r)=>{const o=r(8783),{CreateAcls:s}=r(9211),i=({resourceType:e,resourceName:t,resourcePatternType:r,principal:s,host:i,operation:n,permissionType:a})=>(new o).writeInt8(e).writeString(t).writeInt8(r).writeString(s).writeString(i).writeInt8(n).writeInt8(a);e.exports=({creations:e})=>({apiKey:s,apiVersion:1,apiName:"CreateAcls",encode:async()=>(new o).writeArray(e.map(i))})},1274:(e,t,r)=>{const{parse:o,decode:s}=r(8650);e.exports={decode:async e=>{const t=await s(e);return{...t,throttleTime:0,clientSideThrottleTime:t.throttleTime}},parse:o}},4842:(e,t,r)=>{const o={0:({topicPartitions:e,timeout:t,validateOnly:o})=>{const s=r(3272),i=r(1451);return{request:s({topicPartitions:e,timeout:t,validateOnly:o}),response:i}},1:({topicPartitions:e,validateOnly:t,timeout:o})=>{const s=r(2620),i=r(1932);return{request:s({topicPartitions:e,validateOnly:t,timeout:o}),response:i}}};e.exports={versions:Object.keys(o),protocol:({version:e})=>o[e]}},3272:(e,t,r)=>{const o=r(8783),{CreatePartitions:s}=r(9211);e.exports=({topicPartitions:e,validateOnly:t=!1,timeout:r=5e3})=>({apiKey:s,apiVersion:0,apiName:"CreatePartitions",encode:async()=>(new o).writeArray(e.map(i)).writeInt32(r).writeBoolean(t)});const i=({topic:e,count:t,assignments:r=[]})=>(new o).writeString(e).writeInt32(t).writeNullableArray(r.map(n)),n=e=>(new o).writeNullableArray(e)},1451:(e,t,r)=>{const o=r(6341),{failure:s,createErrorFromCode:i}=r(1701),n=(e,t)=>e.topic.localeCompare(t.topic),a=e=>({topic:e.readString(),errorCode:e.readInt16(),errorMessage:e.readString()});e.exports={decode:async e=>{const t=new o(e);return{throttleTime:t.readInt32(),topicErrors:t.readArray(a).sort(n)}},parse:async e=>{const t=e.topicErrors.filter((({errorCode:e})=>s(e)));if(t.length>0)throw i(t[0].errorCode);return e}}},2620:(e,t,r)=>{const o=r(3272);e.exports=({topicPartitions:e,validateOnly:t,timeout:r})=>Object.assign(o({topicPartitions:e,validateOnly:t,timeout:r}),{apiVersion:1})},1932:(e,t,r)=>{const{parse:o,decode:s}=r(1451);e.exports={decode:async e=>{const t=await s(e);return{...t,throttleTime:0,clientSideThrottleTime:t.throttleTime}},parse:o}},2346:(e,t,r)=>{const o={0:({topics:e,timeout:t})=>{const o=r(9752),s=r(4108);return{request:o({topics:e,timeout:t}),response:s}},1:({topics:e,validateOnly:t,timeout:o})=>{const s=r(4098),i=r(8053);return{request:s({topics:e,validateOnly:t,timeout:o}),response:i}},2:({topics:e,validateOnly:t,timeout:o})=>{const s=r(5669),i=r(9695);return{request:s({topics:e,validateOnly:t,timeout:o}),response:i}},3:({topics:e,validateOnly:t,timeout:o})=>{const s=r(4208),i=r(9264);return{request:s({topics:e,validateOnly:t,timeout:o}),response:i}}};e.exports={versions:Object.keys(o),protocol:({version:e})=>o[e]}},9752:(e,t,r)=>{const o=r(8783),{CreateTopics:s}=r(9211);e.exports=({topics:e,timeout:t=5e3})=>({apiKey:s,apiVersion:0,apiName:"CreateTopics",encode:async()=>(new o).writeArray(e.map(i)).writeInt32(t)});const i=({topic:e,numPartitions:t=-1,replicationFactor:r=-1,replicaAssignment:s=[],configEntries:i=[]})=>(new o).writeString(e).writeInt32(t).writeInt16(r).writeArray(s.map(n)).writeArray(i.map(a)),n=({partition:e,replicas:t})=>(new o).writeInt32(e).writeArray(t),a=({name:e,value:t})=>(new o).writeString(e).writeString(t)},4108:(e,t,r)=>{const o=r(6341),{failure:s,createErrorFromCode:i}=r(1701),{KafkaJSAggregateError:n,KafkaJSCreateTopicError:a}=r(9879),c=(e,t)=>e.topic.localeCompare(t.topic),p=e=>({topic:e.readString(),errorCode:e.readInt16()});e.exports={decode:async e=>({topicErrors:new o(e).readArray(p).sort(c)}),parse:async e=>{const t=e.topicErrors.filter((({errorCode:e})=>s(e)));if(t.length>0)throw new n("Topic creation errors",t.map((e=>new a(i(e.errorCode),e.topic))));return e}}},4098:(e,t,r)=>{const o=r(8783),{CreateTopics:s}=r(9211);e.exports=({topics:e,validateOnly:t=!1,timeout:r=5e3})=>({apiKey:s,apiVersion:1,apiName:"CreateTopics",encode:async()=>(new o).writeArray(e.map(i)).writeInt32(r).writeBoolean(t)});const i=({topic:e,numPartitions:t=-1,replicationFactor:r=-1,replicaAssignment:s=[],configEntries:i=[]})=>(new o).writeString(e).writeInt32(t).writeInt16(r).writeArray(s.map(n)).writeArray(i.map(a)),n=({partition:e,replicas:t})=>(new o).writeInt32(e).writeArray(t),a=({name:e,value:t})=>(new o).writeString(e).writeString(t)},8053:(e,t,r)=>{const o=r(6341),{parse:s}=r(4108),i=(e,t)=>e.topic.localeCompare(t.topic),n=e=>({topic:e.readString(),errorCode:e.readInt16(),errorMessage:e.readString()});e.exports={decode:async e=>({topicErrors:new o(e).readArray(n).sort(i)}),parse:s}},5669:(e,t,r)=>{const o=r(4098);e.exports=({topics:e,validateOnly:t,timeout:r})=>Object.assign(o({topics:e,validateOnly:t,timeout:r}),{apiVersion:2})},9695:(e,t,r)=>{const o=r(6341),{parse:s}=r(8053),i=(e,t)=>e.topic.localeCompare(t.topic),n=e=>({topic:e.readString(),errorCode:e.readInt16(),errorMessage:e.readString()});e.exports={decode:async e=>{const t=new o(e);return{throttleTime:t.readInt32(),topicErrors:t.readArray(n).sort(i)}},parse:s}},4208:(e,t,r)=>{const o=r(5669);e.exports=({topics:e,validateOnly:t,timeout:r})=>Object.assign(o({topics:e,validateOnly:t,timeout:r}),{apiVersion:3})},9264:(e,t,r)=>{const{parse:o,decode:s}=r(9695);e.exports={decode:async e=>{const t=await s(e);return{...t,throttleTime:0,clientSideThrottleTime:t.throttleTime}},parse:o}},1491:(e,t,r)=>{const o={0:({filters:e})=>{const t=r(6054),o=r(6061);return{request:t({filters:e}),response:o}},1:({filters:e})=>{const t=r(2349),o=r(1765);return{request:t({filters:e}),response:o}}};e.exports={versions:Object.keys(o),protocol:({version:e})=>o[e]}},6054:(e,t,r)=>{const o=r(8783),{DeleteAcls:s}=r(9211),i=({resourceType:e,resourceName:t,principal:r,host:s,operation:i,permissionType:n})=>(new o).writeInt8(e).writeString(t).writeString(r).writeString(s).writeInt8(i).writeInt8(n);e.exports=({filters:e})=>({apiKey:s,apiVersion:0,apiName:"DeleteAcls",encode:async()=>(new o).writeArray(e.map(i))})},6061:(e,t,r)=>{const o=r(6341),{failure:s,createErrorFromCode:i}=r(1701),n=e=>({errorCode:e.readInt16(),errorMessage:e.readString(),resourceType:e.readInt8(),resourceName:e.readString(),principal:e.readString(),host:e.readString(),operation:e.readInt8(),permissionType:e.readInt8()}),a=e=>({errorCode:e.readInt16(),errorMessage:e.readString(),matchingAcls:e.readArray(n)});e.exports={decodeMatchingAcls:n,decodeFilterResponse:a,decode:async e=>{const t=new o(e);return{throttleTime:t.readInt32(),filterResponses:t.readArray(a)}},parse:async e=>{const t=e.filterResponses.filter((({errorCode:e})=>s(e)));if(t.length>0)throw i(t[0].errorCode);for(const t of e.filterResponses){const e=t.matchingAcls.filter((({errorCode:e})=>s(e)));if(e.length>0)throw i(e[0].errorCode)}return e}}},2349:(e,t,r)=>{const o=r(8783),{DeleteAcls:s}=r(9211),i=({resourceType:e,resourceName:t,resourcePatternType:r,principal:s,host:i,operation:n,permissionType:a})=>(new o).writeInt8(e).writeString(t).writeInt8(r).writeString(s).writeString(i).writeInt8(n).writeInt8(a);e.exports=({filters:e})=>({apiKey:s,apiVersion:1,apiName:"DeleteAcls",encode:async()=>(new o).writeArray(e.map(i))})},1765:(e,t,r)=>{const o=r(6341),{parse:s}=r(6061),i=e=>({errorCode:e.readInt16(),errorMessage:e.readString(),resourceType:e.readInt8(),resourceName:e.readString(),resourcePatternType:e.readInt8(),principal:e.readString(),host:e.readString(),operation:e.readInt8(),permissionType:e.readInt8()}),n=e=>({errorCode:e.readInt16(),errorMessage:e.readString(),matchingAcls:e.readArray(i)});e.exports={decode:async e=>{const t=new o(e);return{throttleTime:0,clientSideThrottleTime:t.readInt32(),filterResponses:t.readArray(n)}},parse:s}},2086:(e,t,r)=>{const o={0:e=>{const t=r(1254),o=r(5276);return{request:t(e),response:o}},1:e=>{const t=r(7967),o=r(4782);return{request:t(e),response:o}}};e.exports={versions:Object.keys(o),protocol:({version:e})=>o[e]}},1254:(e,t,r)=>{const o=r(8783),{DeleteGroups:s}=r(9211);e.exports=e=>({apiKey:s,apiVersion:0,apiName:"DeleteGroups",encode:async()=>(new o).writeArray(e.map(i))});const i=e=>(new o).writeString(e)},5276:(e,t,r)=>{const o=r(6341),{failure:s,createErrorFromCode:i}=r(1701),n=e=>({groupId:e.readString(),errorCode:e.readInt16()});e.exports={decode:async e=>{const t=new o(e),r=t.readInt32(),a=t.readArray(n);for(const e of a)s(e.errorCode)&&(e.error=i(e.errorCode));return{throttleTimeMs:r,results:a}},parse:async e=>e}},7967:(e,t,r)=>{const o=r(1254);e.exports=e=>Object.assign(o(e),{apiVersion:1})},4782:(e,t,r)=>{const{parse:o,decode:s}=r(5276);e.exports={decode:async e=>{const t=await s(e);return{...t,throttleTime:0,clientSideThrottleTime:t.throttleTime}},parse:o}},8035:(e,t,r)=>{const o={0:({topics:e,timeout:t})=>{const o=r(2970),s=r(9645);return{request:o({topics:e,timeout:t}),response:s({topics:e})}},1:({topics:e,timeout:t})=>{const o=r(8993),s=r(2328);return{request:o({topics:e,timeout:t}),response:s({topics:e})}}};e.exports={versions:Object.keys(o),protocol:({version:e})=>o[e]}},2970:(e,t,r)=>{const o=r(8783),{DeleteRecords:s}=r(9211);e.exports=({topics:e,timeout:t=5e3})=>({apiKey:s,apiVersion:0,apiName:"DeleteRecords",encode:async()=>(new o).writeArray(e.map((({topic:e,partitions:t})=>(new o).writeString(e).writeArray(t.map((({partition:e,offset:t})=>(new o).writeInt32(e).writeInt64(t))))))).writeInt32(t)})},9645:(e,t,r)=>{const o=r(6341),{KafkaJSDeleteTopicRecordsError:s}=r(9879),{failure:i,createErrorFromCode:n}=r(1701),a=(e,t)=>e.topic.localeCompare(t.topic),c=async e=>{const t=new o(e);return{throttleTime:t.readInt32(),topics:t.readArray((e=>({topic:e.readString(),partitions:e.readArray((e=>({partition:e.readInt32(),lowWatermark:e.readInt64(),errorCode:e.readInt16()})))}))).sort(a)}};e.exports=({topics:e})=>{return{decode:c,parse:(t=e,async e=>{const r=e.topics.map((({partitions:e})=>({partitionsWithErrors:e.filter((({errorCode:e})=>i(e)))}))).filter((({partitionsWithErrors:e})=>e.length));if(r.length>0){const[{topic:o}]=e.topics,[{partitions:i}]=t,[{partitionsWithErrors:a}]=r;throw new s({topic:o,partitions:a.map((({partition:e,errorCode:t})=>({partition:e,error:n(t),offset:i.find((t=>t.partition===e)).offset})))})}return e})};var t}},8993:(e,t,r)=>{const o=r(2970);e.exports=({topics:e,timeout:t})=>Object.assign(o({topics:e,timeout:t}),{apiVersion:1})},2328:(e,t,r)=>{const o=r(9645);e.exports=({topics:e})=>{const{parse:t,decode:r}=o({topics:e});return{decode:async e=>{const t=await r(e);return{...t,throttleTime:0,clientSideThrottleTime:t.throttleTime}},parse:t}}},9038:(e,t,r)=>{const o={0:({topics:e,timeout:t})=>{const o=r(4255),s=r(8534);return{request:o({topics:e,timeout:t}),response:s}},1:({topics:e,timeout:t})=>{const o=r(7827),s=r(7530);return{request:o({topics:e,timeout:t}),response:s}}};e.exports={versions:Object.keys(o),protocol:({version:e})=>o[e]}},4255:(e,t,r)=>{const o=r(8783),{DeleteTopics:s}=r(9211);e.exports=({topics:e,timeout:t=5e3})=>({apiKey:s,apiVersion:0,apiName:"DeleteTopics",encode:async()=>(new o).writeArray(e).writeInt32(t)})},8534:(e,t,r)=>{const o=r(6341),{failure:s,createErrorFromCode:i}=r(1701),n=(e,t)=>e.topic.localeCompare(t.topic),a=e=>({topic:e.readString(),errorCode:e.readInt16()});e.exports={decode:async e=>({topicErrors:new o(e).readArray(a).sort(n)}),parse:async e=>{const t=e.topicErrors.filter((({errorCode:e})=>s(e)));if(t.length>0)throw i(t[0].errorCode);return e}}},7827:(e,t,r)=>{const o=r(4255);e.exports=({topics:e,timeout:t})=>Object.assign(o({topics:e,timeout:t}),{apiVersion:1})},7530:(e,t,r)=>{const o=r(6341),{parse:s}=r(8534),i=(e,t)=>e.topic.localeCompare(t.topic),n=e=>({topic:e.readString(),errorCode:e.readInt16()});e.exports={decode:async e=>{const t=new o(e);return{throttleTime:0,clientSideThrottleTime:t.readInt32(),topicErrors:t.readArray(n).sort(i)}},parse:s}},5665:(e,t,r)=>{const o={0:({resourceType:e,resourceName:t,principal:o,host:s,operation:i,permissionType:n})=>{const a=r(1106),c=r(2590);return{request:a({resourceType:e,resourceName:t,principal:o,host:s,operation:i,permissionType:n}),response:c}},1:({resourceType:e,resourceName:t,resourcePatternType:o,principal:s,host:i,operation:n,permissionType:a})=>{const c=r(7696),p=r(7952);return{request:c({resourceType:e,resourceName:t,resourcePatternType:o,principal:s,host:i,operation:n,permissionType:a}),response:p}}};e.exports={versions:Object.keys(o),protocol:({version:e})=>o[e]}},1106:(e,t,r)=>{const o=r(8783),{DescribeAcls:s}=r(9211);e.exports=({resourceType:e,resourceName:t,principal:r,host:i,operation:n,permissionType:a})=>({apiKey:s,apiVersion:0,apiName:"DescribeAcls",encode:async()=>(new o).writeInt8(e).writeString(t).writeString(r).writeString(i).writeInt8(n).writeInt8(a)})},2590:(e,t,r)=>{const o=r(6341),{failure:s,createErrorFromCode:i}=r(1701),n=e=>({principal:e.readString(),host:e.readString(),operation:e.readInt8(),permissionType:e.readInt8()}),a=e=>({resourceType:e.readInt8(),resourceName:e.readString(),acls:e.readArray(n)});e.exports={decode:async e=>{const t=new o(e);return{throttleTime:t.readInt32(),errorCode:t.readInt16(),errorMessage:t.readString(),resources:t.readArray(a)}},parse:async e=>{if(s(e.errorCode))throw i(e.errorCode);return e}}},7696:(e,t,r)=>{const o=r(8783),{DescribeAcls:s}=r(9211);e.exports=({resourceType:e,resourceName:t,resourcePatternType:r,principal:i,host:n,operation:a,permissionType:c})=>({apiKey:s,apiVersion:1,apiName:"DescribeAcls",encode:async()=>(new o).writeInt8(e).writeString(t).writeInt8(r).writeString(i).writeString(n).writeInt8(a).writeInt8(c)})},7952:(e,t,r)=>{const{parse:o}=r(2590),s=r(6341),i=e=>({principal:e.readString(),host:e.readString(),operation:e.readInt8(),permissionType:e.readInt8()}),n=e=>({resourceType:e.readInt8(),resourceName:e.readString(),resourcePatternType:e.readInt8(),acls:e.readArray(i)});e.exports={decode:async e=>{const t=new s(e);return{throttleTime:0,clientSideThrottleTime:t.readInt32(),errorCode:t.readInt16(),errorMessage:t.readString(),resources:t.readArray(n)}},parse:o}},6450:(e,t,r)=>{const o={0:({resources:e})=>{const t=r(7511),o=r(3707);return{request:t({resources:e}),response:o}},1:({resources:e,includeSynonyms:t})=>{const o=r(4017),s=r(1636);return{request:o({resources:e,includeSynonyms:t}),response:s}},2:({resources:e,includeSynonyms:t})=>{const o=r(942),s=r(4410);return{request:o({resources:e,includeSynonyms:t}),response:s}}};e.exports={versions:Object.keys(o),protocol:({version:e})=>o[e]}},7511:(e,t,r)=>{const o=r(8783),{DescribeConfigs:s}=r(9211);e.exports=({resources:e})=>({apiKey:s,apiVersion:0,apiName:"DescribeConfigs",encode:async()=>(new o).writeArray(e.map(i))});const i=({type:e,name:t,configNames:r=[]})=>(new o).writeInt8(e).writeString(t).writeNullableArray(r)},3707:(e,t,r)=>{const o=r(6341),{failure:s,createErrorFromCode:i}=r(1701),n=r(9955),a=r(8279),c=e=>{const t=e.readInt16(),r=e.readString(),o=e.readInt8(),s=e.readString(),i=e.readArray((e=>((e,t)=>{const r=e.readString(),o=e.readString(),s=e.readBoolean(),i=e.readBoolean(),c=e.readBoolean();let p;if(i)p=n.DEFAULT_CONFIG;else switch(t){case a.BROKER:p=n.STATIC_BROKER_CONFIG;break;case a.TOPIC:p=n.TOPIC_CONFIG;break;default:p=n.UNKNOWN}return{configName:r,configValue:o,readOnly:s,isDefault:i,configSource:p,isSensitive:c}})(e,o)));return{errorCode:t,errorMessage:r,resourceType:o,resourceName:s,configEntries:i}};e.exports={decode:async e=>{const t=new o(e);return{throttleTime:t.readInt32(),resources:t.readArray(c)}},parse:async e=>{const t=e.resources.filter((({errorCode:e})=>s(e)));if(t.length>0)throw i(t[0].errorCode);return e}}},4017:(e,t,r)=>{const o=r(8783),{DescribeConfigs:s}=r(9211);e.exports=({resources:e,includeSynonyms:t=!1})=>({apiKey:s,apiVersion:1,apiName:"DescribeConfigs",encode:async()=>(new o).writeArray(e.map(i)).writeBoolean(t)});const i=({type:e,name:t,configNames:r=[]})=>(new o).writeInt8(e).writeString(t).writeNullableArray(r)},1636:(e,t,r)=>{const o=r(6341),{parse:s}=r(3707),{DEFAULT_CONFIG:i}=r(9955),n=e=>({configName:e.readString(),configValue:e.readString(),configSource:e.readInt8()}),a=e=>{const t=e.readString(),r=e.readString(),o=e.readBoolean(),s=e.readInt8(),a=e.readBoolean(),c=e.readArray(n);return{configName:t,configValue:r,readOnly:o,isDefault:s===i,configSource:s,isSensitive:a,configSynonyms:c}},c=e=>({errorCode:e.readInt16(),errorMessage:e.readString(),resourceType:e.readInt8(),resourceName:e.readString(),configEntries:e.readArray(a)});e.exports={decode:async e=>{const t=new o(e);return{throttleTime:t.readInt32(),resources:t.readArray(c)}},parse:s}},942:(e,t,r)=>{const o=r(4017);e.exports=({resources:e,includeSynonyms:t})=>Object.assign(o({resources:e,includeSynonyms:t}),{apiVersion:2})},4410:(e,t,r)=>{const{parse:o,decode:s}=r(1636);e.exports={decode:async e=>{const t=await s(e);return{...t,throttleTime:0,clientSideThrottleTime:t.throttleTime}},parse:o}},7927:(e,t,r)=>{const o={0:({groupIds:e})=>{const t=r(2228),o=r(3251);return{request:t({groupIds:e}),response:o}},1:({groupIds:e})=>{const t=r(6106),o=r(4332);return{request:t({groupIds:e}),response:o}},2:({groupIds:e})=>{const t=r(4106),o=r(5902);return{request:t({groupIds:e}),response:o}}};e.exports={versions:Object.keys(o),protocol:({version:e})=>o[e]}},2228:(e,t,r)=>{const o=r(8783),{DescribeGroups:s}=r(9211);e.exports=({groupIds:e})=>({apiKey:s,apiVersion:0,apiName:"DescribeGroups",encode:async()=>(new o).writeArray(e)})},3251:(e,t,r)=>{const o=r(6341),{failure:s,createErrorFromCode:i}=r(1701),n=e=>({memberId:e.readString(),clientId:e.readString(),clientHost:e.readString(),memberMetadata:e.readBytes(),memberAssignment:e.readBytes()}),a=e=>({errorCode:e.readInt16(),groupId:e.readString(),state:e.readString(),protocolType:e.readString(),protocol:e.readString(),members:e.readArray(n)});e.exports={decode:async e=>({groups:new o(e).readArray(a)}),parse:async e=>{const t=e.groups.filter((({errorCode:e})=>s(e)));if(t.length>0)throw i(t[0].errorCode);return e}}},6106:(e,t,r)=>{const o=r(2228);e.exports=({groupIds:e})=>Object.assign(o({groupIds:e}),{apiVersion:1})},4332:(e,t,r)=>{const o=r(6341),{parse:s}=r(3251),i=e=>({memberId:e.readString(),clientId:e.readString(),clientHost:e.readString(),memberMetadata:e.readBytes(),memberAssignment:e.readBytes()}),n=e=>({errorCode:e.readInt16(),groupId:e.readString(),state:e.readString(),protocolType:e.readString(),protocol:e.readString(),members:e.readArray(i)});e.exports={decode:async e=>{const t=new o(e);return{throttleTime:t.readInt32(),groups:t.readArray(n)}},parse:s}},4106:(e,t,r)=>{const o=r(6106);e.exports=({groupIds:e})=>Object.assign(o({groupIds:e}),{apiVersion:2})},5902:(e,t,r)=>{const{parse:o,decode:s}=r(4332);e.exports={decode:async e=>{const t=await s(e);return{...t,throttleTime:0,clientSideThrottleTime:t.throttleTime}},parse:o}},2059:(e,t,r)=>{const o={0:({transactionalId:e,producerId:t,producerEpoch:o,transactionResult:s})=>{const i=r(7446),n=r(1707);return{request:i({transactionalId:e,producerId:t,producerEpoch:o,transactionResult:s}),response:n}},1:({transactionalId:e,producerId:t,producerEpoch:o,transactionResult:s})=>{const i=r(5306),n=r(4786);return{request:i({transactionalId:e,producerId:t,producerEpoch:o,transactionResult:s}),response:n}}};e.exports={versions:Object.keys(o),protocol:({version:e})=>o[e]}},7446:(e,t,r)=>{const o=r(8783),{EndTxn:s}=r(9211);e.exports=({transactionalId:e,producerId:t,producerEpoch:r,transactionResult:i})=>({apiKey:s,apiVersion:0,apiName:"EndTxn",encode:async()=>(new o).writeString(e).writeInt64(t).writeInt16(r).writeBoolean(i)})},1707:(e,t,r)=>{const o=r(6341),{failure:s,createErrorFromCode:i,failIfVersionNotSupported:n}=r(1701);e.exports={decode:async e=>{const t=new o(e),r=t.readInt32(),s=t.readInt16();return n(s),{throttleTime:r,errorCode:s}},parse:async e=>{if(s(e.errorCode))throw i(e.errorCode);return e}}},5306:(e,t,r)=>{const o=r(7446);e.exports=({transactionalId:e,producerId:t,producerEpoch:r,transactionResult:s})=>Object.assign(o({transactionalId:e,producerId:t,producerEpoch:r,transactionResult:s}),{apiVersion:1})},4786:(e,t,r)=>{const{parse:o,decode:s}=r(1707);e.exports={decode:async e=>{const t=await s(e);return{...t,throttleTime:0,clientSideThrottleTime:t.throttleTime}},parse:o}},8681:(e,t,r)=>{const o=r(2845),s=e=>Number.isSafeInteger(e+100)?e+100:e,i={0:({replicaId:e=-1,maxWaitTime:t,minBytes:o,topics:i})=>{const n=r(2818),a=r(3583);return{request:n({replicaId:e,maxWaitTime:t,minBytes:o,topics:i}),response:a,requestTimeout:s(t)}},1:({replicaId:e=-1,maxWaitTime:t,minBytes:o,topics:i})=>{const n=r(8087),a=r(2155);return{request:n({replicaId:e,maxWaitTime:t,minBytes:o,topics:i}),response:a,requestTimeout:s(t)}},2:({replicaId:e=-1,maxWaitTime:t,minBytes:o,topics:i})=>{const n=r(2045),a=r(7628);return{request:n({replicaId:e,maxWaitTime:t,minBytes:o,topics:i}),response:a,requestTimeout:s(t)}},3:({replicaId:e=-1,maxWaitTime:t,minBytes:o,maxBytes:i,topics:n})=>{const a=r(4704),c=r(1828);return{request:a({replicaId:e,maxWaitTime:t,minBytes:o,maxBytes:i,topics:n}),response:c,requestTimeout:s(t)}},4:({replicaId:e=-1,isolationLevel:t=o.READ_COMMITTED,maxWaitTime:i,minBytes:n,maxBytes:a,topics:c})=>{const p=r(7737),d=r(6668);return{request:p({replicaId:e,isolationLevel:t,maxWaitTime:i,minBytes:n,maxBytes:a,topics:c}),response:d,requestTimeout:s(i)}},5:({replicaId:e=-1,isolationLevel:t=o.READ_COMMITTED,maxWaitTime:i,minBytes:n,maxBytes:a,topics:c})=>{const p=r(2881),d=r(9214);return{request:p({replicaId:e,isolationLevel:t,maxWaitTime:i,minBytes:n,maxBytes:a,topics:c}),response:d,requestTimeout:s(i)}},6:({replicaId:e=-1,isolationLevel:t=o.READ_COMMITTED,maxWaitTime:i,minBytes:n,maxBytes:a,topics:c})=>{const p=r(4939),d=r(5646);return{request:p({replicaId:e,isolationLevel:t,maxWaitTime:i,minBytes:n,maxBytes:a,topics:c}),response:d,requestTimeout:s(i)}},7:({replicaId:e=-1,isolationLevel:t=o.READ_COMMITTED,sessionId:i=0,sessionEpoch:n=-1,forgottenTopics:a=[],maxWaitTime:c,minBytes:p,maxBytes:d,topics:u})=>{const l=r(3431),h=r(3456);return{request:l({replicaId:e,isolationLevel:t,sessionId:i,sessionEpoch:n,forgottenTopics:a,maxWaitTime:c,minBytes:p,maxBytes:d,topics:u}),response:h,requestTimeout:s(c)}},8:({replicaId:e=-1,isolationLevel:t=o.READ_COMMITTED,sessionId:i=0,sessionEpoch:n=-1,forgottenTopics:a=[],maxWaitTime:c,minBytes:p,maxBytes:d,topics:u})=>{const l=r(4427),h=r(7004);return{request:l({replicaId:e,isolationLevel:t,sessionId:i,sessionEpoch:n,forgottenTopics:a,maxWaitTime:c,minBytes:p,maxBytes:d,topics:u}),response:h,requestTimeout:s(c)}},9:({replicaId:e=-1,isolationLevel:t=o.READ_COMMITTED,sessionId:i=0,sessionEpoch:n=-1,forgottenTopics:a=[],maxWaitTime:c,minBytes:p,maxBytes:d,topics:u})=>{const l=r(7988),h=r(9272);return{request:l({replicaId:e,isolationLevel:t,sessionId:i,sessionEpoch:n,forgottenTopics:a,maxWaitTime:c,minBytes:p,maxBytes:d,topics:u}),response:h,requestTimeout:s(c)}},10:({replicaId:e=-1,isolationLevel:t=o.READ_COMMITTED,sessionId:i=0,sessionEpoch:n=-1,forgottenTopics:a=[],maxWaitTime:c,minBytes:p,maxBytes:d,topics:u})=>{const l=r(3504),h=r(3882);return{request:l({replicaId:e,isolationLevel:t,sessionId:i,sessionEpoch:n,forgottenTopics:a,maxWaitTime:c,minBytes:p,maxBytes:d,topics:u}),response:h,requestTimeout:s(c)}},11:({replicaId:e=-1,isolationLevel:t=o.READ_COMMITTED,sessionId:i=0,sessionEpoch:n=-1,forgottenTopics:a=[],maxWaitTime:c,minBytes:p,maxBytes:d,topics:u,rackId:l})=>{const h=r(1592),m=r(8405);return{request:h({replicaId:e,isolationLevel:t,sessionId:i,sessionEpoch:n,forgottenTopics:a,maxWaitTime:c,minBytes:p,maxBytes:d,topics:u,rackId:l}),response:m,requestTimeout:s(c)}}};e.exports={versions:Object.keys(i),protocol:({version:e})=>i[e]}},2818:(e,t,r)=>{const o=r(8783),{Fetch:s}=r(9211);e.exports=({replicaId:e,maxWaitTime:t,minBytes:r,topics:n})=>({apiKey:s,apiVersion:0,apiName:"Fetch",encode:async()=>(new o).writeInt32(e).writeInt32(t).writeInt32(r).writeArray(n.map(i))});const i=({topic:e,partitions:t})=>(new o).writeString(e).writeArray(t.map(n)),n=({partition:e,fetchOffset:t,maxBytes:r})=>(new o).writeInt32(e).writeInt64(t).writeInt32(r)},3583:(e,t,r)=>{const o=r(6341),{KafkaJSOffsetOutOfRange:s}=r(9879),{failure:i,createErrorFromCode:n,errorCodes:a}=r(1701),c=r(4321),p=async e=>({partition:e.readInt32(),errorCode:e.readInt16(),highWatermark:e.readInt64().toString(),messages:await c(e)}),d=async e=>({topicName:e.readString(),partitions:await e.readArrayAsync(p)}),{code:u}=a.find((e=>"OFFSET_OUT_OF_RANGE"===e.type));e.exports={decode:async e=>{const t=new o(e);return{responses:await t.readArrayAsync(d)}},parse:async e=>{const t=e.responses.flatMap((({topicName:e,partitions:t})=>t.filter((e=>i(e.errorCode))).map((t=>Object.assign({},t,{topic:e})))));if(t.length>0){const{errorCode:e,topic:r,partition:o}=t[0];if(e===u)throw new s(n(e),{topic:r,partition:o});throw n(e)}return e}}},3504:(e,t,r)=>{const o=r(2845),s=r(7988);e.exports=({replicaId:e,maxWaitTime:t,minBytes:r,maxBytes:i,topics:n,isolationLevel:a=o.READ_COMMITTED,sessionId:c=0,sessionEpoch:p=-1,forgottenTopics:d=[]})=>Object.assign(s({replicaId:e,maxWaitTime:t,minBytes:r,maxBytes:i,topics:n,isolationLevel:a,sessionId:c,sessionEpoch:p,forgottenTopics:d}),{apiVersion:10})},3882:(e,t,r)=>{const{decode:o,parse:s}=r(9272);e.exports={decode:o,parse:s}},1592:(e,t,r)=>{const o=r(8783),{Fetch:s}=r(9211),i=r(2845);e.exports=({replicaId:e,maxWaitTime:t,minBytes:r,maxBytes:c,topics:p,rackId:d="",isolationLevel:u=i.READ_COMMITTED,sessionId:l=0,sessionEpoch:h=-1,forgottenTopics:m=[]})=>({apiKey:s,apiVersion:11,apiName:"Fetch",encode:async()=>(new o).writeInt32(e).writeInt32(t).writeInt32(r).writeInt32(c).writeInt8(u).writeInt32(l).writeInt32(h).writeArray(p.map(a)).writeArray(m.map(n)).writeString(d)});const n=({topic:e,partitions:t})=>(new o).writeString(e).writeArray(t),a=({topic:e,partitions:t})=>(new o).writeString(e).writeArray(t.map(c)),c=({partition:e,currentLeaderEpoch:t=-1,fetchOffset:r,logStartOffset:s=-1,maxBytes:i})=>(new o).writeInt32(e).writeInt32(t).writeInt64(r).writeInt64(s).writeInt32(i)},8405:(e,t,r)=>{const o=r(6341),{parse:s}=r(2155),i=r(5643),n=e=>({producerId:e.readInt64().toString(),firstOffset:e.readInt64().toString()}),a=async e=>({partition:e.readInt32(),errorCode:e.readInt16(),highWatermark:e.readInt64().toString(),lastStableOffset:e.readInt64().toString(),lastStartOffset:e.readInt64().toString(),abortedTransactions:e.readArray(n),preferredReadReplica:e.readInt32(),messages:await i(e)}),c=async e=>({topicName:e.readString(),partitions:await e.readArrayAsync(a)});e.exports={decode:async e=>{const t=new o(e);return{throttleTime:0,clientSideThrottleTime:t.readInt32(),errorCode:t.readInt16(),sessionId:t.readInt32(),responses:await t.readArrayAsync(c)}},parse:s}},8087:(e,t,r)=>{const o=r(2818);e.exports=({replicaId:e,maxWaitTime:t,minBytes:r,topics:s})=>Object.assign(o({replicaId:e,maxWaitTime:t,minBytes:r,topics:s}),{apiVersion:1})},2155:(e,t,r)=>{const o=r(6341),{parse:s}=r(3583),i=r(4321),n=async e=>({partition:e.readInt32(),errorCode:e.readInt16(),highWatermark:e.readInt64().toString(),messages:await i(e)}),a=async e=>({topicName:e.readString(),partitions:await e.readArrayAsync(n)});e.exports={decode:async e=>{const t=new o(e);return{throttleTime:t.readInt32(),responses:await t.readArrayAsync(a)}},parse:s}},2045:(e,t,r)=>{const o=r(2818);e.exports=({replicaId:e,maxWaitTime:t,minBytes:r,topics:s})=>Object.assign(o({replicaId:e,maxWaitTime:t,minBytes:r,topics:s}),{apiVersion:2})},7628:(e,t,r)=>{const{decode:o,parse:s}=r(2155);e.exports={decode:o,parse:s}},4704:(e,t,r)=>{const o=r(8783),{Fetch:s}=r(9211);e.exports=({replicaId:e,maxWaitTime:t,minBytes:r,maxBytes:n,topics:a})=>({apiKey:s,apiVersion:3,apiName:"Fetch",encode:async()=>(new o).writeInt32(e).writeInt32(t).writeInt32(r).writeInt32(n).writeArray(a.map(i))});const i=({topic:e,partitions:t})=>(new o).writeString(e).writeArray(t.map(n)),n=({partition:e,fetchOffset:t,maxBytes:r})=>(new o).writeInt32(e).writeInt64(t).writeInt32(r)},1828:(e,t,r)=>{const{decode:o,parse:s}=r(2155);e.exports={decode:o,parse:s}},5643:(e,t,r)=>{const o=r(6341),s=r(4321),i=r(3294),{MAGIC_BYTE:n}=r(2872);e.exports=async e=>{const t=e.readInt32();if(t<=0||!e.canReadBytes(t))return[];const r=e.readBytes(t),a=new o(r);if(r.slice(16).readInt8(0)===n){const e=[];for(;a.canReadBytes(49);)try{const t=await i(a);e.push(...t.records)}catch(e){if("KafkaJSPartialMessageError"===e.name)break;throw e}return e}return s(a,t)}},7737:(e,t,r)=>{const o=r(8783),{Fetch:s}=r(9211),i=r(2845);e.exports=({replicaId:e,maxWaitTime:t,minBytes:r,maxBytes:a,topics:c,isolationLevel:p=i.READ_COMMITTED})=>({apiKey:s,apiVersion:4,apiName:"Fetch",encode:async()=>(new o).writeInt32(e).writeInt32(t).writeInt32(r).writeInt32(a).writeInt8(p).writeArray(c.map(n))});const n=({topic:e,partitions:t})=>(new o).writeString(e).writeArray(t.map(a)),a=({partition:e,fetchOffset:t,maxBytes:r})=>(new o).writeInt32(e).writeInt64(t).writeInt32(r)},6668:(e,t,r)=>{const o=r(6341),{parse:s}=r(2155),i=r(5643),n=e=>({producerId:e.readInt64().toString(),firstOffset:e.readInt64().toString()}),a=async e=>({partition:e.readInt32(),errorCode:e.readInt16(),highWatermark:e.readInt64().toString(),lastStableOffset:e.readInt64().toString(),abortedTransactions:e.readArray(n),messages:await i(e)}),c=async e=>({topicName:e.readString(),partitions:await e.readArrayAsync(a)});e.exports={decode:async e=>{const t=new o(e);return{throttleTime:t.readInt32(),responses:await t.readArrayAsync(c)}},parse:s}},2881:(e,t,r)=>{const o=r(8783),{Fetch:s}=r(9211),i=r(2845);e.exports=({replicaId:e,maxWaitTime:t,minBytes:r,maxBytes:a,topics:c,isolationLevel:p=i.READ_COMMITTED})=>({apiKey:s,apiVersion:5,apiName:"Fetch",encode:async()=>(new o).writeInt32(e).writeInt32(t).writeInt32(r).writeInt32(a).writeInt8(p).writeArray(c.map(n))});const n=({topic:e,partitions:t})=>(new o).writeString(e).writeArray(t.map(a)),a=({partition:e,fetchOffset:t,logStartOffset:r=-1,maxBytes:s})=>(new o).writeInt32(e).writeInt64(t).writeInt64(r).writeInt32(s)},9214:(e,t,r)=>{const o=r(6341),{parse:s}=r(2155),i=r(5643),n=e=>({producerId:e.readInt64().toString(),firstOffset:e.readInt64().toString()}),a=async e=>({partition:e.readInt32(),errorCode:e.readInt16(),highWatermark:e.readInt64().toString(),lastStableOffset:e.readInt64().toString(),lastStartOffset:e.readInt64().toString(),abortedTransactions:e.readArray(n),messages:await i(e)}),c=async e=>({topicName:e.readString(),partitions:await e.readArrayAsync(a)});e.exports={decode:async e=>{const t=new o(e);return{throttleTime:t.readInt32(),responses:await t.readArrayAsync(c)}},parse:s}},4939:(e,t,r)=>{const o=r(2845),s=r(2881);e.exports=({replicaId:e,maxWaitTime:t,minBytes:r,maxBytes:i,topics:n,isolationLevel:a=o.READ_COMMITTED})=>Object.assign(s({replicaId:e,maxWaitTime:t,minBytes:r,maxBytes:i,topics:n,isolationLevel:a}),{apiVersion:6})},5646:(e,t,r)=>{const{decode:o,parse:s}=r(9214);e.exports={decode:o,parse:s}},3431:(e,t,r)=>{const o=r(8783),{Fetch:s}=r(9211),i=r(2845);e.exports=({replicaId:e,maxWaitTime:t,minBytes:r,maxBytes:c,topics:p,isolationLevel:d=i.READ_COMMITTED,sessionId:u=0,sessionEpoch:l=-1,forgottenTopics:h=[]})=>({apiKey:s,apiVersion:7,apiName:"Fetch",encode:async()=>(new o).writeInt32(e).writeInt32(t).writeInt32(r).writeInt32(c).writeInt8(d).writeInt32(u).writeInt32(l).writeArray(p.map(a)).writeArray(h.map(n))});const n=({topic:e,partitions:t})=>(new o).writeString(e).writeArray(t),a=({topic:e,partitions:t})=>(new o).writeString(e).writeArray(t.map(c)),c=({partition:e,fetchOffset:t,logStartOffset:r=-1,maxBytes:s})=>(new o).writeInt32(e).writeInt64(t).writeInt64(r).writeInt32(s)},3456:(e,t,r)=>{const o=r(6341),{parse:s}=r(2155),i=r(5643),n=e=>({producerId:e.readInt64().toString(),firstOffset:e.readInt64().toString()}),a=async e=>({partition:e.readInt32(),errorCode:e.readInt16(),highWatermark:e.readInt64().toString(),lastStableOffset:e.readInt64().toString(),lastStartOffset:e.readInt64().toString(),abortedTransactions:e.readArray(n),messages:await i(e)}),c=async e=>({topicName:e.readString(),partitions:await e.readArrayAsync(a)});e.exports={decode:async e=>{const t=new o(e);return{throttleTime:t.readInt32(),errorCode:t.readInt16(),sessionId:t.readInt32(),responses:await t.readArrayAsync(c)}},parse:s}},4427:(e,t,r)=>{const o=r(2845),s=r(3431);e.exports=({replicaId:e,maxWaitTime:t,minBytes:r,maxBytes:i,topics:n,isolationLevel:a=o.READ_COMMITTED,sessionId:c=0,sessionEpoch:p=-1,forgottenTopics:d=[]})=>Object.assign(s({replicaId:e,maxWaitTime:t,minBytes:r,maxBytes:i,topics:n,isolationLevel:a,sessionId:c,sessionEpoch:p,forgottenTopics:d}),{apiVersion:8})},7004:(e,t,r)=>{const o=r(6341),{parse:s}=r(2155),i=r(5643),n=e=>({producerId:e.readInt64().toString(),firstOffset:e.readInt64().toString()}),a=async e=>({partition:e.readInt32(),errorCode:e.readInt16(),highWatermark:e.readInt64().toString(),lastStableOffset:e.readInt64().toString(),lastStartOffset:e.readInt64().toString(),abortedTransactions:e.readArray(n),messages:await i(e)}),c=async e=>({topicName:e.readString(),partitions:await e.readArrayAsync(a)});e.exports={decode:async e=>{const t=new o(e);return{throttleTime:0,clientSideThrottleTime:t.readInt32(),errorCode:t.readInt16(),sessionId:t.readInt32(),responses:await t.readArrayAsync(c)}},parse:s}},7988:(e,t,r)=>{const o=r(8783),{Fetch:s}=r(9211),i=r(2845);e.exports=({replicaId:e,maxWaitTime:t,minBytes:r,maxBytes:c,topics:p,isolationLevel:d=i.READ_COMMITTED,sessionId:u=0,sessionEpoch:l=-1,forgottenTopics:h=[]})=>({apiKey:s,apiVersion:9,apiName:"Fetch",encode:async()=>(new o).writeInt32(e).writeInt32(t).writeInt32(r).writeInt32(c).writeInt8(d).writeInt32(u).writeInt32(l).writeArray(p.map(a)).writeArray(h.map(n))});const n=({topic:e,partitions:t})=>(new o).writeString(e).writeArray(t),a=({topic:e,partitions:t})=>(new o).writeString(e).writeArray(t.map(c)),c=({partition:e,currentLeaderEpoch:t=-1,fetchOffset:r,logStartOffset:s=-1,maxBytes:i})=>(new o).writeInt32(e).writeInt32(t).writeInt64(r).writeInt64(s).writeInt32(i)},9272:(e,t,r)=>{const{decode:o,parse:s}=r(7004);e.exports={decode:o,parse:s}},163:(e,t,r)=>{const o=r(7022),s={0:({groupId:e})=>{const t=r(6592),o=r(3419);return{request:t({groupId:e}),response:o}},1:({groupId:e,coordinatorType:t=o.GROUP})=>{const s=r(7664),i=r(7451);return{request:s({coordinatorKey:e,coordinatorType:t}),response:i}},2:({groupId:e,coordinatorType:t=o.GROUP})=>{const s=r(9050),i=r(8179);return{request:s({coordinatorKey:e,coordinatorType:t}),response:i}}};e.exports={versions:Object.keys(s),protocol:({version:e})=>s[e]}},6592:(e,t,r)=>{const o=r(8783),{GroupCoordinator:s}=r(9211);e.exports=({groupId:e})=>({apiKey:s,apiVersion:0,apiName:"GroupCoordinator",encode:async()=>(new o).writeString(e)})},3419:(e,t,r)=>{const o=r(6341),{failure:s,createErrorFromCode:i,failIfVersionNotSupported:n}=r(1701);e.exports={decode:async e=>{const t=new o(e),r=t.readInt16();return n(r),{errorCode:r,coordinator:{nodeId:t.readInt32(),host:t.readString(),port:t.readInt32()}}},parse:async e=>{if(s(e.errorCode))throw i(e.errorCode);return e}}},7664:(e,t,r)=>{const o=r(8783),{GroupCoordinator:s}=r(9211);e.exports=({coordinatorKey:e,coordinatorType:t})=>({apiKey:s,apiVersion:1,apiName:"GroupCoordinator",encode:async()=>(new o).writeString(e).writeInt8(t)})},7451:(e,t,r)=>{const o=r(6341),{failure:s,createErrorFromCode:i,failIfVersionNotSupported:n}=r(1701);e.exports={decode:async e=>{const t=new o(e),r=t.readInt32(),s=t.readInt16();return n(s),{throttleTime:r,errorCode:s,errorMessage:t.readString(),coordinator:{nodeId:t.readInt32(),host:t.readString(),port:t.readInt32()}}},parse:async e=>{if(s(e.errorCode))throw i(e.errorCode);return e}}},9050:(e,t,r)=>{const o=r(7664);e.exports=({coordinatorKey:e,coordinatorType:t})=>Object.assign(o({coordinatorKey:e,coordinatorType:t}),{apiVersion:2})},8179:(e,t,r)=>{const{parse:o,decode:s}=r(7451);e.exports={decode:async e=>{const t=await s(e);return{...t,throttleTime:0,clientSideThrottleTime:t.throttleTime}},parse:o}},6641:(e,t,r)=>{const o={0:({groupId:e,groupGenerationId:t,memberId:o})=>{const s=r(7533),i=r(4732);return{request:s({groupId:e,groupGenerationId:t,memberId:o}),response:i}},1:({groupId:e,groupGenerationId:t,memberId:o})=>{const s=r(7694),i=r(1199);return{request:s({groupId:e,groupGenerationId:t,memberId:o}),response:i}},2:({groupId:e,groupGenerationId:t,memberId:o})=>{const s=r(686),i=r(2394);return{request:s({groupId:e,groupGenerationId:t,memberId:o}),response:i}},3:({groupId:e,groupGenerationId:t,memberId:o,groupInstanceId:s})=>{const i=r(34),n=r(1194);return{request:i({groupId:e,groupGenerationId:t,memberId:o,groupInstanceId:s}),response:n}}};e.exports={versions:Object.keys(o),protocol:({version:e})=>o[e]}},7533:(e,t,r)=>{const o=r(8783),{Heartbeat:s}=r(9211);e.exports=({groupId:e,groupGenerationId:t,memberId:r})=>({apiKey:s,apiVersion:0,apiName:"Heartbeat",encode:async()=>(new o).writeString(e).writeInt32(t).writeString(r)})},4732:(e,t,r)=>{const o=r(6341),{failure:s,createErrorFromCode:i,failIfVersionNotSupported:n}=r(1701);e.exports={decode:async e=>{const t=new o(e).readInt16();return n(t),{errorCode:t}},parse:async e=>{if(s(e.errorCode))throw i(e.errorCode);return e}}},7694:(e,t,r)=>{const o=r(7533);e.exports=({groupId:e,groupGenerationId:t,memberId:r})=>Object.assign(o({groupId:e,groupGenerationId:t,memberId:r}),{apiVersion:1})},1199:(e,t,r)=>{const o=r(6341),{failIfVersionNotSupported:s}=r(1701),{parse:i}=r(4732);e.exports={decode:async e=>{const t=new o(e),r=t.readInt32(),i=t.readInt16();return s(i),{throttleTime:r,errorCode:i}},parse:i}},686:(e,t,r)=>{const o=r(7694);e.exports=({groupId:e,groupGenerationId:t,memberId:r})=>Object.assign(o({groupId:e,groupGenerationId:t,memberId:r}),{apiVersion:2})},2394:(e,t,r)=>{const{parse:o,decode:s}=r(1199);e.exports={decode:async e=>{const t=await s(e);return{...t,throttleTime:0,clientSideThrottleTime:t.throttleTime}},parse:o}},34:(e,t,r)=>{const o=r(8783),{Heartbeat:s}=r(9211);e.exports=({groupId:e,groupGenerationId:t,memberId:r,groupInstanceId:i})=>({apiKey:s,apiVersion:3,apiName:"Heartbeat",encode:async()=>(new o).writeString(e).writeInt32(t).writeString(r).writeString(i)})},1194:(e,t,r)=>{const{parse:o,decode:s}=r(2394);e.exports={decode:s,parse:o}},3146:(e,t,r)=>{const o=r(9211),{KafkaJSServerDoesNotSupportApiKey:s,KafkaJSNotImplemented:i}=r(9879),n={versions:[],protocol:()=>{throw new i}},a={Produce:r(7609),Fetch:r(8681),ListOffsets:r(364),Metadata:r(1747),LeaderAndIsr:n,StopReplica:n,UpdateMetadata:n,ControlledShutdown:n,OffsetCommit:r(7789),OffsetFetch:r(1761),GroupCoordinator:r(163),JoinGroup:r(583),Heartbeat:r(6641),LeaveGroup:r(3083),SyncGroup:r(6096),DescribeGroups:r(7927),ListGroups:r(8119),SaslHandshake:r(6184),ApiVersions:r(7020),CreateTopics:r(2346),DeleteTopics:r(9038),DeleteRecords:r(8035),InitProducerId:r(6961),OffsetForLeaderEpoch:n,AddPartitionsToTxn:r(3350),AddOffsetsToTxn:r(4530),EndTxn:r(2059),WriteTxnMarkers:n,TxnOffsetCommit:r(5302),DescribeAcls:r(5665),CreateAcls:r(4950),DeleteAcls:r(1491),DescribeConfigs:r(6450),AlterConfigs:r(1858),AlterReplicaLogDirs:n,DescribeLogDirs:n,SaslAuthenticate:r(886),CreatePartitions:r(4842),CreateDelegationToken:n,RenewDelegationToken:n,ExpireDelegationToken:n,DescribeDelegationToken:n,DeleteGroups:r(2086)},c=Object.keys(o),p=Object.values(o),d=e=>c[p.indexOf(e)];e.exports={requests:a,lookup:e=>(t,r)=>{const o=e[t],i=r.versions.map(Number),n=Math.max(...i);if(!o||null==o.maxVersion)throw new s("The Kafka server does not support the requested API version",{apiKey:t,apiName:d(t)});const a=Math.min(n,o.maxVersion);return r.protocol({version:a})}}},6961:(e,t,r)=>{const o={0:({transactionalId:e,transactionTimeout:t=5e3})=>{const o=r(6862),s=r(7280);return{request:o({transactionalId:e,transactionTimeout:t}),response:s}},1:({transactionalId:e,transactionTimeout:t=5e3})=>{const o=r(5427),s=r(2826);return{request:o({transactionalId:e,transactionTimeout:t}),response:s}}};e.exports={versions:Object.keys(o),protocol:({version:e})=>o[e]}},6862:(e,t,r)=>{const o=r(8783),{InitProducerId:s}=r(9211);e.exports=({transactionalId:e,transactionTimeout:t})=>({apiKey:s,apiVersion:0,apiName:"InitProducerId",encode:async()=>(new o).writeString(e).writeInt32(t)})},7280:(e,t,r)=>{const o=r(6341),{failure:s,createErrorFromCode:i,failIfVersionNotSupported:n}=r(1701);e.exports={decode:async e=>{const t=new o(e),r=t.readInt32(),s=t.readInt16();return n(s),{throttleTime:r,errorCode:s,producerId:t.readInt64().toString(),producerEpoch:t.readInt16()}},parse:async e=>{if(s(e.errorCode))throw i(e.errorCode);return e}}},5427:(e,t,r)=>{const o=r(6862);e.exports=({transactionalId:e,transactionTimeout:t})=>Object.assign(o({transactionalId:e,transactionTimeout:t}),{apiVersion:1})},2826:(e,t,r)=>{const{parse:o,decode:s}=r(7280);e.exports={decode:async e=>{const t=await s(e);return{...t,throttleTime:0,clientSideThrottleTime:t.throttleTime}},parse:o}},583:(e,t,r)=>{const o=({rebalanceTimeout:e,sessionTimeout:t})=>{const r=e||t;return Number.isSafeInteger(r+5e3)?r+5e3:r},s=e=>null!=e&&""!==e,i={0:({groupId:e,sessionTimeout:t,memberId:s,protocolType:i,groupProtocols:n})=>{const a=r(9369),c=r(259);return{request:a({groupId:e,sessionTimeout:t,memberId:s,protocolType:i,groupProtocols:n}),response:c,requestTimeout:o({rebalanceTimeout:null,sessionTimeout:t})}},1:({groupId:e,sessionTimeout:t,rebalanceTimeout:s,memberId:i,protocolType:n,groupProtocols:a})=>{const c=r(6737),p=r(9801);return{request:c({groupId:e,sessionTimeout:t,rebalanceTimeout:s,memberId:i,protocolType:n,groupProtocols:a}),response:p,requestTimeout:o({rebalanceTimeout:s,sessionTimeout:t})}},2:({groupId:e,sessionTimeout:t,rebalanceTimeout:s,memberId:i,protocolType:n,groupProtocols:a})=>{const c=r(6146),p=r(1989);return{request:c({groupId:e,sessionTimeout:t,rebalanceTimeout:s,memberId:i,protocolType:n,groupProtocols:a}),response:p,requestTimeout:o({rebalanceTimeout:s,sessionTimeout:t})}},3:({groupId:e,sessionTimeout:t,rebalanceTimeout:s,memberId:i,protocolType:n,groupProtocols:a})=>{const c=r(5318),p=r(9106);return{request:c({groupId:e,sessionTimeout:t,rebalanceTimeout:s,memberId:i,protocolType:n,groupProtocols:a}),response:p,requestTimeout:o({rebalanceTimeout:s,sessionTimeout:t})}},4:({groupId:e,sessionTimeout:t,rebalanceTimeout:i,memberId:n,protocolType:a,groupProtocols:c})=>{const p=r(5125),d=r(2285);return{request:p({groupId:e,sessionTimeout:t,rebalanceTimeout:i,memberId:n,protocolType:a,groupProtocols:c}),response:d,requestTimeout:o({rebalanceTimeout:i,sessionTimeout:t}),logResponseError:s(n)}},5:({groupId:e,sessionTimeout:t,rebalanceTimeout:i,memberId:n,groupInstanceId:a,protocolType:c,groupProtocols:p})=>{const d=r(4454),u=r(6845);return{request:d({groupId:e,sessionTimeout:t,rebalanceTimeout:i,memberId:n,groupInstanceId:a,protocolType:c,groupProtocols:p}),response:u,requestTimeout:o({rebalanceTimeout:i,sessionTimeout:t}),logResponseError:s(n)}}};e.exports={versions:Object.keys(i),protocol:({version:e})=>i[e]}},9369:(e,t,r)=>{const o=r(8783),{JoinGroup:s}=r(9211);e.exports=({groupId:e,sessionTimeout:t,memberId:r,protocolType:n,groupProtocols:a})=>({apiKey:s,apiVersion:0,apiName:"JoinGroup",encode:async()=>(new o).writeString(e).writeInt32(t).writeString(r).writeString(n).writeArray(a.map(i))});const i=({name:e,metadata:t=Buffer.alloc(0)})=>(new o).writeString(e).writeBytes(t)},259:(e,t,r)=>{const o=r(6341),{failure:s,createErrorFromCode:i,failIfVersionNotSupported:n}=r(1701);e.exports={decode:async e=>{const t=new o(e),r=t.readInt16();return n(r),{errorCode:r,generationId:t.readInt32(),groupProtocol:t.readString(),leaderId:t.readString(),memberId:t.readString(),members:t.readArray((e=>({memberId:e.readString(),memberMetadata:e.readBytes()})))}},parse:async e=>{if(s(e.errorCode))throw i(e.errorCode);return e}}},6737:(e,t,r)=>{const o=r(8783),{JoinGroup:s}=r(9211);e.exports=({groupId:e,sessionTimeout:t,rebalanceTimeout:r,memberId:n,protocolType:a,groupProtocols:c})=>({apiKey:s,apiVersion:1,apiName:"JoinGroup",encode:async()=>(new o).writeString(e).writeInt32(t).writeInt32(r).writeString(n).writeString(a).writeArray(c.map(i))});const i=({name:e,metadata:t=Buffer.alloc(0)})=>(new o).writeString(e).writeBytes(t)},9801:(e,t,r)=>{const{parse:o,decode:s}=r(259);e.exports={decode:s,parse:o}},6146:(e,t,r)=>{const o=r(6737);e.exports=({groupId:e,sessionTimeout:t,rebalanceTimeout:r,memberId:s,protocolType:i,groupProtocols:n})=>Object.assign(o({groupId:e,sessionTimeout:t,rebalanceTimeout:r,memberId:s,protocolType:i,groupProtocols:n}),{apiVersion:2})},1989:(e,t,r)=>{const o=r(6341),{failIfVersionNotSupported:s}=r(1701),{parse:i}=r(259);e.exports={decode:async e=>{const t=new o(e),r=t.readInt32(),i=t.readInt16();return s(i),{throttleTime:r,errorCode:i,generationId:t.readInt32(),groupProtocol:t.readString(),leaderId:t.readString(),memberId:t.readString(),members:t.readArray((e=>({memberId:e.readString(),memberMetadata:e.readBytes()})))}},parse:i}},5318:(e,t,r)=>{const o=r(6146);e.exports=({groupId:e,sessionTimeout:t,rebalanceTimeout:r,memberId:s,protocolType:i,groupProtocols:n})=>Object.assign(o({groupId:e,sessionTimeout:t,rebalanceTimeout:r,memberId:s,protocolType:i,groupProtocols:n}),{apiVersion:3})},9106:(e,t,r)=>{const{parse:o,decode:s}=r(1989);e.exports={decode:async e=>{const t=await s(e);return{...t,throttleTime:0,clientSideThrottleTime:t.throttleTime}},parse:o}},5125:(e,t,r)=>{const o=r(5318);e.exports=({groupId:e,sessionTimeout:t,rebalanceTimeout:r,memberId:s,protocolType:i,groupProtocols:n})=>Object.assign(o({groupId:e,sessionTimeout:t,rebalanceTimeout:r,memberId:s,protocolType:i,groupProtocols:n}),{apiVersion:4})},2285:(e,t,r)=>{const{decode:o}=r(9106),{KafkaJSMemberIdRequired:s}=r(9879),{failure:i,createErrorFromCode:n,errorCodes:a}=r(1701),{code:c}=a.find((e=>"MEMBER_ID_REQUIRED"===e.type));e.exports={decode:o,parse:async e=>{if(i(e.errorCode)){if(e.errorCode===c)throw new s(n(e.errorCode),{memberId:e.memberId});throw n(e.errorCode)}return e}}},4454:(e,t,r)=>{const o=r(8783),{JoinGroup:s}=r(9211);e.exports=({groupId:e,sessionTimeout:t,rebalanceTimeout:r,memberId:n,groupInstanceId:a=null,protocolType:c,groupProtocols:p})=>({apiKey:s,apiVersion:5,apiName:"JoinGroup",encode:async()=>(new o).writeString(e).writeInt32(t).writeInt32(r).writeString(n).writeString(a).writeString(c).writeArray(p.map(i))});const i=({name:e,metadata:t=Buffer.alloc(0)})=>(new o).writeString(e).writeBytes(t)},6845:(e,t,r)=>{const o=r(6341),{KafkaJSMemberIdRequired:s}=r(9879),{failure:i,createErrorFromCode:n,errorCodes:a,failIfVersionNotSupported:c}=r(1701),{code:p}=a.find((e=>"MEMBER_ID_REQUIRED"===e.type));e.exports={decode:async e=>{const t=new o(e),r=t.readInt32(),s=t.readInt16();return c(s),{throttleTime:0,clientSideThrottleTime:r,errorCode:s,generationId:t.readInt32(),groupProtocol:t.readString(),leaderId:t.readString(),memberId:t.readString(),members:t.readArray((e=>({memberId:e.readString(),groupInstanceId:e.readString(),memberMetadata:e.readBytes()})))}},parse:async e=>{if(i(e.errorCode)){if(e.errorCode===p)throw new s(n(e.errorCode),{memberId:e.memberId});throw n(e.errorCode)}return e}}},3083:(e,t,r)=>{const o={0:({groupId:e,memberId:t})=>{const o=r(6413),s=r(9376);return{request:o({groupId:e,memberId:t}),response:s}},1:({groupId:e,memberId:t})=>{const o=r(885),s=r(679);return{request:o({groupId:e,memberId:t}),response:s}},2:({groupId:e,memberId:t})=>{const o=r(5191),s=r(8235);return{request:o({groupId:e,memberId:t}),response:s}},3:({groupId:e,memberId:t,groupInstanceId:o})=>{const s=r(5680),i=r(1105);return{request:s({groupId:e,members:[{memberId:t,groupInstanceId:o}]}),response:i}}};e.exports={versions:Object.keys(o),protocol:({version:e})=>o[e]}},6413:(e,t,r)=>{const o=r(8783),{LeaveGroup:s}=r(9211);e.exports=({groupId:e,memberId:t})=>({apiKey:s,apiVersion:0,apiName:"LeaveGroup",encode:async()=>(new o).writeString(e).writeString(t)})},9376:(e,t,r)=>{const o=r(6341),{failure:s,createErrorFromCode:i,failIfVersionNotSupported:n}=r(1701);e.exports={decode:async e=>{const t=new o(e).readInt16();return n(t),{errorCode:t}},parse:async e=>{if(s(e.errorCode))throw i(e.errorCode);return e}}},885:(e,t,r)=>{const o=r(6413);e.exports=({groupId:e,memberId:t})=>Object.assign(o({groupId:e,memberId:t}),{apiVersion:1})},679:(e,t,r)=>{const o=r(6341),{failIfVersionNotSupported:s}=r(1701),{parse:i}=r(9376);e.exports={decode:async e=>{const t=new o(e),r=t.readInt32(),i=t.readInt16();return s(i),{throttleTime:r,errorCode:i}},parse:i}},5191:(e,t,r)=>{const o=r(885);e.exports=({groupId:e,memberId:t})=>Object.assign(o({groupId:e,memberId:t}),{apiVersion:2})},8235:(e,t,r)=>{const{parse:o,decode:s}=r(679);e.exports={decode:async e=>{const t=await s(e);return{...t,throttleTime:0,clientSideThrottleTime:t.throttleTime}},parse:o}},5680:(e,t,r)=>{const o=r(8783),{LeaveGroup:s}=r(9211);e.exports=({groupId:e,members:t})=>({apiKey:s,apiVersion:3,apiName:"LeaveGroup",encode:async()=>(new o).writeString(e).writeArray(t.map((e=>i(e))))});const i=({memberId:e,groupInstanceId:t=null})=>(new o).writeString(e).writeString(t)},1105:(e,t,r)=>{const o=r(6341),{failIfVersionNotSupported:s,failure:i,createErrorFromCode:n}=r(1701),{parse:a}=r(8235),c=e=>({memberId:e.readString(),groupInstanceId:e.readString(),errorCode:e.readInt16()});e.exports={decode:async e=>{const t=new o(e),r=t.readInt32(),i=t.readInt16(),n=t.readArray(c);return s(i),{throttleTime:0,clientSideThrottleTime:r,errorCode:i,members:n}},parse:async e=>{const t=a(e),r=e.members.find((e=>i(e.errorCode)));if(r)throw n(r.errorCode);return t}}},8119:(e,t,r)=>{const o={0:()=>{const e=r(1660),t=r(1356);return{request:e(),response:t}},1:()=>{const e=r(740),t=r(9644);return{request:e(),response:t}},2:()=>{const e=r(3058),t=r(7225);return{request:e(),response:t}}};e.exports={versions:Object.keys(o),protocol:({version:e})=>o[e]}},1660:(e,t,r)=>{const o=r(8783),{ListGroups:s}=r(9211);e.exports=()=>({apiKey:s,apiVersion:0,apiName:"ListGroups",encode:async()=>new o})},1356:(e,t,r)=>{const o=r(6341),{failure:s,createErrorFromCode:i}=r(1701),n=e=>({groupId:e.readString(),protocolType:e.readString()});e.exports={decodeGroup:n,decode:async e=>{const t=new o(e);return{errorCode:t.readInt16(),groups:t.readArray(n)}},parse:async e=>{if(s(e.errorCode))throw i(e.errorCode);return e}}},740:(e,t,r)=>{const o=r(1660);e.exports=()=>Object.assign(o(),{apiVersion:1})},9644:(e,t,r)=>{const o=r(1356),s=r(6341);e.exports={decode:async e=>{const t=new s(e);return{throttleTime:t.readInt32(),errorCode:t.readInt16(),groups:t.readArray(o.decodeGroup)}},parse:o.parse}},3058:(e,t,r)=>{const o=r(740);e.exports=()=>Object.assign(o(),{apiVersion:2})},7225:(e,t,r)=>{const{parse:o,decode:s}=r(9644);e.exports={decode:async e=>{const t=await s(e);return{...t,throttleTime:0,clientSideThrottleTime:t.throttleTime}},parse:o}},364:(e,t,r)=>{const o=r(2845),s={0:({replicaId:e=-1,topics:t})=>{const o=r(130),s=r(9440);return{request:o({replicaId:e,topics:t}),response:s}},1:({replicaId:e=-1,topics:t})=>{const o=r(1452),s=r(2922);return{request:o({replicaId:e,topics:t}),response:s}},2:({replicaId:e=-1,isolationLevel:t=o.READ_COMMITTED,topics:s})=>{const i=r(8246),n=r(156);return{request:i({replicaId:e,isolationLevel:t,topics:s}),response:n}},3:({replicaId:e=-1,isolationLevel:t=o.READ_COMMITTED,topics:s})=>{const i=r(330),n=r(2004);return{request:i({replicaId:e,isolationLevel:t,topics:s}),response:n}}};e.exports={versions:Object.keys(s),protocol:({version:e})=>s[e]}},130:(e,t,r)=>{const o=r(8783),{ListOffsets:s}=r(9211);e.exports=({replicaId:e,topics:t})=>({apiKey:s,apiVersion:0,apiName:"ListOffsets",encode:async()=>(new o).writeInt32(e).writeArray(t.map(i))});const i=({topic:e,partitions:t})=>(new o).writeString(e).writeArray(t.map(n)),n=({partition:e,timestamp:t=-1,maxNumOffsets:r=1})=>(new o).writeInt32(e).writeInt64(t).writeInt32(r)},9440:(e,t,r)=>{const o=r(6341),{failure:s,createErrorFromCode:i}=r(1701),n=e=>({topic:e.readString(),partitions:e.readArray(a)}),a=e=>({partition:e.readInt32(),errorCode:e.readInt16(),offsets:e.readArray(c)}),c=e=>e.readInt64().toString();e.exports={decode:async e=>({responses:new o(e).readArray(n)}),parse:async e=>{const t=e.responses.flatMap((e=>e.partitions.filter((e=>s(e.errorCode)))))[0];if(t)throw i(t.errorCode);return e}}},1452:(e,t,r)=>{const o=r(8783),{ListOffsets:s}=r(9211);e.exports=({replicaId:e,topics:t})=>({apiKey:s,apiVersion:1,apiName:"ListOffsets",encode:async()=>(new o).writeInt32(e).writeArray(t.map(i))});const i=({topic:e,partitions:t})=>(new o).writeString(e).writeArray(t.map(n)),n=({partition:e,timestamp:t=-1})=>(new o).writeInt32(e).writeInt64(t)},2922:(e,t,r)=>{const o=r(6341),{failure:s,createErrorFromCode:i}=r(1701),n=e=>({topic:e.readString(),partitions:e.readArray(a)}),a=e=>({partition:e.readInt32(),errorCode:e.readInt16(),timestamp:e.readInt64().toString(),offset:e.readInt64().toString()});e.exports={decode:async e=>({responses:new o(e).readArray(n)}),parse:async e=>{const t=e.responses.flatMap((e=>e.partitions.filter((e=>s(e.errorCode)))))[0];if(t)throw i(t.errorCode);return e}}},8246:(e,t,r)=>{const o=r(8783),{ListOffsets:s}=r(9211);e.exports=({replicaId:e,isolationLevel:t,topics:r})=>({apiKey:s,apiVersion:2,apiName:"ListOffsets",encode:async()=>(new o).writeInt32(e).writeInt8(t).writeArray(r.map(i))});const i=({topic:e,partitions:t})=>(new o).writeString(e).writeArray(t.map(n)),n=({partition:e,timestamp:t=-1})=>(new o).writeInt32(e).writeInt64(t)},156:(e,t,r)=>{const o=r(6341),{failure:s,createErrorFromCode:i}=r(1701),n=e=>({topic:e.readString(),partitions:e.readArray(a)}),a=e=>({partition:e.readInt32(),errorCode:e.readInt16(),timestamp:e.readInt64().toString(),offset:e.readInt64().toString()});e.exports={decode:async e=>{const t=new o(e);return{throttleTime:t.readInt32(),responses:t.readArray(n)}},parse:async e=>{const t=e.responses.flatMap((e=>e.partitions.filter((e=>s(e.errorCode)))))[0];if(t)throw i(t.errorCode);return e}}},330:(e,t,r)=>{const o=r(8246);e.exports=({replicaId:e,isolationLevel:t,topics:r})=>Object.assign(o({replicaId:e,isolationLevel:t,topics:r}),{apiVersion:3})},2004:(e,t,r)=>{const{parse:o,decode:s}=r(156);e.exports={decode:async e=>{const t=await s(e);return{...t,throttleTime:0,clientSideThrottleTime:t.throttleTime}},parse:o}},1747:(e,t,r)=>{const o={0:({topics:e})=>{const t=r(8838),o=r(7995);return{request:t({topics:e}),response:o}},1:({topics:e})=>{const t=r(4063),o=r(8972);return{request:t({topics:e}),response:o}},2:({topics:e})=>{const t=r(9853),o=r(3248);return{request:t({topics:e}),response:o}},3:({topics:e})=>{const t=r(6067),o=r(626);return{request:t({topics:e}),response:o}},4:({topics:e,allowAutoTopicCreation:t})=>{const o=r(227),s=r(1901);return{request:o({topics:e,allowAutoTopicCreation:t}),response:s}},5:({topics:e,allowAutoTopicCreation:t})=>{const o=r(5620),s=r(2068);return{request:o({topics:e,allowAutoTopicCreation:t}),response:s}},6:({topics:e,allowAutoTopicCreation:t})=>{const o=r(4234),s=r(4771);return{request:o({topics:e,allowAutoTopicCreation:t}),response:s}}};e.exports={versions:Object.keys(o),protocol:({version:e})=>o[e]}},8838:(e,t,r)=>{const o=r(8783),{Metadata:s}=r(9211);e.exports=({topics:e})=>({apiKey:s,apiVersion:0,apiName:"Metadata",encode:async()=>(new o).writeArray(e)})},7995:(e,t,r)=>{const o=r(6341),{failure:s,createErrorFromCode:i}=r(1701),n=e=>({nodeId:e.readInt32(),host:e.readString(),port:e.readInt32()}),a=e=>({topicErrorCode:e.readInt16(),topic:e.readString(),partitionMetadata:e.readArray(c)}),c=e=>({partitionErrorCode:e.readInt16(),partitionId:e.readInt32(),leader:e.readInt32(),replicas:e.readArray((e=>e.readInt32())),isr:e.readArray((e=>e.readInt32()))});e.exports={decode:async e=>{const t=new o(e);return{brokers:t.readArray(n),topicMetadata:t.readArray(a)}},parse:async e=>{const t=e.topicMetadata.filter((e=>s(e.topicErrorCode)));if(t.length>0){const{topicErrorCode:e}=t[0];throw i(e)}const r=e.topicMetadata.flatMap((e=>e.partitionMetadata.filter((e=>s(e.partitionErrorCode)))));if(r.length>0){const{partitionErrorCode:e}=r[0];throw i(e)}return e}}},4063:(e,t,r)=>{const o=r(8783),{Metadata:s}=r(9211);e.exports=({topics:e})=>({apiKey:s,apiVersion:1,apiName:"Metadata",encode:async()=>(new o).writeNullableArray(e)})},8972:(e,t,r)=>{const o=r(6341),{parse:s}=r(7995),i=e=>({nodeId:e.readInt32(),host:e.readString(),port:e.readInt32(),rack:e.readString()}),n=e=>({topicErrorCode:e.readInt16(),topic:e.readString(),isInternal:e.readBoolean(),partitionMetadata:e.readArray(a)}),a=e=>({partitionErrorCode:e.readInt16(),partitionId:e.readInt32(),leader:e.readInt32(),replicas:e.readArray((e=>e.readInt32())),isr:e.readArray((e=>e.readInt32()))});e.exports={decode:async e=>{const t=new o(e);return{brokers:t.readArray(i),controllerId:t.readInt32(),topicMetadata:t.readArray(n)}},parse:s}},9853:(e,t,r)=>{const o=r(4063);e.exports=({topics:e})=>Object.assign(o({topics:e}),{apiVersion:2})},3248:(e,t,r)=>{const o=r(6341),{parse:s}=r(7995),i=e=>({nodeId:e.readInt32(),host:e.readString(),port:e.readInt32(),rack:e.readString()}),n=e=>({topicErrorCode:e.readInt16(),topic:e.readString(),isInternal:e.readBoolean(),partitionMetadata:e.readArray(a)}),a=e=>({partitionErrorCode:e.readInt16(),partitionId:e.readInt32(),leader:e.readInt32(),replicas:e.readArray((e=>e.readInt32())),isr:e.readArray((e=>e.readInt32()))});e.exports={decode:async e=>{const t=new o(e);return{brokers:t.readArray(i),clusterId:t.readString(),controllerId:t.readInt32(),topicMetadata:t.readArray(n)}},parse:s}},6067:(e,t,r)=>{const o=r(4063);e.exports=({topics:e})=>Object.assign(o({topics:e}),{apiVersion:3})},626:(e,t,r)=>{const o=r(6341),{parse:s}=r(7995),i=e=>({nodeId:e.readInt32(),host:e.readString(),port:e.readInt32(),rack:e.readString()}),n=e=>({topicErrorCode:e.readInt16(),topic:e.readString(),isInternal:e.readBoolean(),partitionMetadata:e.readArray(a)}),a=e=>({partitionErrorCode:e.readInt16(),partitionId:e.readInt32(),leader:e.readInt32(),replicas:e.readArray((e=>e.readInt32())),isr:e.readArray((e=>e.readInt32()))});e.exports={decode:async e=>{const t=new o(e);return{throttleTime:t.readInt32(),brokers:t.readArray(i),clusterId:t.readString(),controllerId:t.readInt32(),topicMetadata:t.readArray(n)}},parse:s}},227:(e,t,r)=>{const o=r(8783),{Metadata:s}=r(9211);e.exports=({topics:e,allowAutoTopicCreation:t=!0})=>({apiKey:s,apiVersion:4,apiName:"Metadata",encode:async()=>(new o).writeNullableArray(e).writeBoolean(t)})},1901:(e,t,r)=>{const{parse:o,decode:s}=r(626);e.exports={parse:o,decode:s}},5620:(e,t,r)=>{const o=r(227);e.exports=({topics:e,allowAutoTopicCreation:t=!0})=>Object.assign(o({topics:e,allowAutoTopicCreation:t}),{apiVersion:5})},2068:(e,t,r)=>{const o=r(6341),{parse:s}=r(7995),i=e=>({nodeId:e.readInt32(),host:e.readString(),port:e.readInt32(),rack:e.readString()}),n=e=>({topicErrorCode:e.readInt16(),topic:e.readString(),isInternal:e.readBoolean(),partitionMetadata:e.readArray(a)}),a=e=>({partitionErrorCode:e.readInt16(),partitionId:e.readInt32(),leader:e.readInt32(),replicas:e.readArray((e=>e.readInt32())),isr:e.readArray((e=>e.readInt32())),offlineReplicas:e.readArray((e=>e.readInt32()))});e.exports={decode:async e=>{const t=new o(e);return{throttleTime:t.readInt32(),brokers:t.readArray(i),clusterId:t.readString(),controllerId:t.readInt32(),topicMetadata:t.readArray(n)}},parse:s}},4234:(e,t,r)=>{const o=r(5620);e.exports=({topics:e,allowAutoTopicCreation:t=!0})=>Object.assign(o({topics:e,allowAutoTopicCreation:t}),{apiVersion:6})},4771:(e,t,r)=>{const{parse:o,decode:s}=r(2068);e.exports={decode:async e=>{const t=await s(e);return{...t,throttleTime:0,clientSideThrottleTime:t.throttleTime}},parse:o}},7789:(e,t,r)=>{const o={0:({groupId:e,topics:t})=>{const o=r(204),s=r(6941);return{request:o({groupId:e,topics:t}),response:s}},1:({groupId:e,groupGenerationId:t,memberId:o,topics:s})=>{const i=r(8698),n=r(6);return{request:i({groupId:e,groupGenerationId:t,memberId:o,topics:s}),response:n}},2:({groupId:e,groupGenerationId:t,memberId:o,retentionTime:s=-1,topics:i})=>{const n=r(4078),a=r(3865);return{request:n({groupId:e,groupGenerationId:t,memberId:o,retentionTime:s,topics:i}),response:a}},3:({groupId:e,groupGenerationId:t,memberId:o,retentionTime:s=-1,topics:i})=>{const n=r(7344),a=r(4369);return{request:n({groupId:e,groupGenerationId:t,memberId:o,retentionTime:s,topics:i}),response:a}},4:({groupId:e,groupGenerationId:t,memberId:o,retentionTime:s=-1,topics:i})=>{const n=r(161),a=r(3831);return{request:n({groupId:e,groupGenerationId:t,memberId:o,retentionTime:s,topics:i}),response:a}},5:({groupId:e,groupGenerationId:t,memberId:o,topics:s})=>{const i=r(4024),n=r(434);return{request:i({groupId:e,groupGenerationId:t,memberId:o,topics:s}),response:n}}};e.exports={versions:Object.keys(o),protocol:({version:e})=>o[e]}},204:(e,t,r)=>{const o=r(8783),{OffsetCommit:s}=r(9211);e.exports=({groupId:e,topics:t})=>({apiKey:s,apiVersion:0,apiName:"OffsetCommit",encode:async()=>(new o).writeString(e).writeArray(t.map(i))});const i=({topic:e,partitions:t})=>(new o).writeString(e).writeArray(t.map(n)),n=({partition:e,offset:t,metadata:r=null})=>(new o).writeInt32(e).writeInt64(t).writeString(r)},6941:(e,t,r)=>{const o=r(6341),{failure:s,createErrorFromCode:i}=r(1701),n=e=>({topic:e.readString(),partitions:e.readArray(a)}),a=e=>({partition:e.readInt32(),errorCode:e.readInt16()});e.exports={decode:async e=>({responses:new o(e).readArray(n)}),parse:async e=>{const t=e.responses.flatMap((e=>e.partitions.filter((e=>s(e.errorCode)))))[0];if(t)throw i(t.errorCode);return e}}},8698:(e,t,r)=>{const o=r(8783),{OffsetCommit:s}=r(9211);e.exports=({groupId:e,groupGenerationId:t,memberId:r,topics:n})=>({apiKey:s,apiVersion:1,apiName:"OffsetCommit",encode:async()=>(new o).writeString(e).writeInt32(t).writeString(r).writeArray(n.map(i))});const i=({topic:e,partitions:t})=>(new o).writeString(e).writeArray(t.map(n)),n=({partition:e,offset:t,timestamp:r=Date.now(),metadata:s=null})=>(new o).writeInt32(e).writeInt64(t).writeInt64(r).writeString(s)},6:(e,t,r)=>{const{parse:o,decode:s}=r(6941);e.exports={decode:s,parse:o}},4078:(e,t,r)=>{const o=r(8783),{OffsetCommit:s}=r(9211);e.exports=({groupId:e,groupGenerationId:t,memberId:r,retentionTime:n,topics:a})=>({apiKey:s,apiVersion:2,apiName:"OffsetCommit",encode:async()=>(new o).writeString(e).writeInt32(t).writeString(r).writeInt64(n).writeArray(a.map(i))});const i=({topic:e,partitions:t})=>(new o).writeString(e).writeArray(t.map(n)),n=({partition:e,offset:t,metadata:r=null})=>(new o).writeInt32(e).writeInt64(t).writeString(r)},3865:(e,t,r)=>{const{parse:o,decode:s}=r(6941);e.exports={decode:s,parse:o}},7344:(e,t,r)=>{const o=r(4078);e.exports=({groupId:e,groupGenerationId:t,memberId:r,retentionTime:s,topics:i})=>Object.assign(o({groupId:e,groupGenerationId:t,memberId:r,retentionTime:s,topics:i}),{apiVersion:3})},4369:(e,t,r)=>{const o=r(6341),{parse:s}=r(6941),i=e=>({topic:e.readString(),partitions:e.readArray(n)}),n=e=>({partition:e.readInt32(),errorCode:e.readInt16()});e.exports={decode:async e=>{const t=new o(e);return{throttleTime:t.readInt32(),responses:t.readArray(i)}},parse:s}},161:(e,t,r)=>{const o=r(7344);e.exports=({groupId:e,groupGenerationId:t,memberId:r,retentionTime:s,topics:i})=>Object.assign(o({groupId:e,groupGenerationId:t,memberId:r,retentionTime:s,topics:i}),{apiVersion:4})},3831:(e,t,r)=>{const{parse:o,decode:s}=r(4369);e.exports={decode:async e=>{const t=await s(e);return{...t,throttleTime:0,clientSideThrottleTime:t.throttleTime}},parse:o}},4024:(e,t,r)=>{const o=r(8783),{OffsetCommit:s}=r(9211);e.exports=({groupId:e,groupGenerationId:t,memberId:r,topics:n})=>({apiKey:s,apiVersion:5,apiName:"OffsetCommit",encode:async()=>(new o).writeString(e).writeInt32(t).writeString(r).writeArray(n.map(i))});const i=({topic:e,partitions:t})=>(new o).writeString(e).writeArray(t.map(n)),n=({partition:e,offset:t,metadata:r=null})=>(new o).writeInt32(e).writeInt64(t).writeString(r)},434:(e,t,r)=>{const{parse:o,decode:s}=r(3831);e.exports={decode:s,parse:o}},1761:(e,t,r)=>{const o={1:({groupId:e,topics:t})=>{const o=r(8047),s=r(2522);return{request:o({groupId:e,topics:t}),response:s}},2:({groupId:e,topics:t})=>{const o=r(9519),s=r(7269);return{request:o({groupId:e,topics:t}),response:s}},3:({groupId:e,topics:t})=>{const o=r(1640),s=r(8414);return{request:o({groupId:e,topics:t}),response:s}},4:({groupId:e,topics:t})=>{const o=r(633),s=r(2871);return{request:o({groupId:e,topics:t}),response:s}}};e.exports={versions:Object.keys(o),protocol:({version:e})=>o[e]}},8047:(e,t,r)=>{const o=r(8783),{OffsetFetch:s}=r(9211);e.exports=({groupId:e,topics:t})=>({apiKey:s,apiVersion:1,apiName:"OffsetFetch",encode:async()=>(new o).writeString(e).writeArray(t.map(i))});const i=({topic:e,partitions:t})=>(new o).writeString(e).writeArray(t.map(n)),n=({partition:e})=>(new o).writeInt32(e)},2522:(e,t,r)=>{const o=r(6341),{failure:s,createErrorFromCode:i}=r(1701),n=e=>({topic:e.readString(),partitions:e.readArray(a)}),a=e=>({partition:e.readInt32(),offset:e.readInt64().toString(),metadata:e.readString(),errorCode:e.readInt16()});e.exports={decode:async e=>({responses:new o(e).readArray(n)}),parse:async e=>{const t=e.responses.flatMap((e=>e.partitions.filter((e=>s(e.errorCode)))))[0];if(t)throw i(t.errorCode);return e}}},9519:(e,t,r)=>{const o=r(8047);e.exports=({groupId:e,topics:t})=>Object.assign(o({groupId:e,topics:t}),{apiVersion:2})},7269:(e,t,r)=>{const o=r(6341),{failure:s,createErrorFromCode:i}=r(1701),n=e=>({topic:e.readString(),partitions:e.readArray(a)}),a=e=>({partition:e.readInt32(),offset:e.readInt64().toString(),metadata:e.readString(),errorCode:e.readInt16()});e.exports={decode:async e=>{const t=new o(e);return{responses:t.readArray(n),errorCode:t.readInt16()}},parse:async e=>{if(s(e.errorCode))throw i(e.errorCode);const t=e.responses.flatMap((e=>e.partitions.filter((e=>s(e.errorCode)))))[0];if(t)throw i(t.errorCode);return e}}},1640:(e,t,r)=>{const o=r(8783),{OffsetFetch:s}=r(9211);e.exports=({groupId:e,topics:t})=>({apiKey:s,apiVersion:3,apiName:"OffsetFetch",encode:async()=>(new o).writeString(e).writeNullableArray(t.map(i))});const i=({topic:e,partitions:t})=>(new o).writeString(e).writeArray(t.map(n)),n=({partition:e})=>(new o).writeInt32(e)},8414:(e,t,r)=>{const o=r(6341),{parse:s}=r(7269),i=e=>({topic:e.readString(),partitions:e.readArray(n)}),n=e=>({partition:e.readInt32(),offset:e.readInt64().toString(),metadata:e.readString(),errorCode:e.readInt16()});e.exports={decode:async e=>{const t=new o(e);return{throttleTime:t.readInt32(),responses:t.readArray(i),errorCode:t.readInt16()}},parse:s}},633:(e,t,r)=>{const o=r(1640);e.exports=({groupId:e,topics:t})=>Object.assign(o({groupId:e,topics:t}),{apiVersion:4})},2871:(e,t,r)=>{const{parse:o,decode:s}=r(8414);e.exports={decode:async e=>{const t=await s(e);return{...t,throttleTime:0,clientSideThrottleTime:t.throttleTime}},parse:o}},7609:(e,t,r)=>{const o={0:({acks:e,timeout:t,topicData:o})=>{const s=r(5127),i=r(2615);return{request:s({acks:e,timeout:t,topicData:o}),response:i}},1:({acks:e,timeout:t,topicData:o})=>{const s=r(6807),i=r(8683);return{request:s({acks:e,timeout:t,topicData:o}),response:i}},2:({acks:e,timeout:t,topicData:o,compression:s})=>{const i=r(749),n=r(5468);return{request:i({acks:e,timeout:t,compression:s,topicData:o}),response:n}},3:({acks:e,timeout:t,compression:o,topicData:s,transactionalId:i,producerId:n,producerEpoch:a})=>{const c=r(6088),p=r(4635);return{request:c({acks:e,timeout:t,compression:o,topicData:s,transactionalId:i,producerId:n,producerEpoch:a}),response:p}},4:({acks:e,timeout:t,compression:o,topicData:s,transactionalId:i,producerId:n,producerEpoch:a})=>{const c=r(9221),p=r(4206);return{request:c({acks:e,timeout:t,compression:o,topicData:s,transactionalId:i,producerId:n,producerEpoch:a}),response:p}},5:({acks:e,timeout:t,compression:o,topicData:s,transactionalId:i,producerId:n,producerEpoch:a})=>{const c=r(5353),p=r(4708);return{request:c({acks:e,timeout:t,compression:o,topicData:s,transactionalId:i,producerId:n,producerEpoch:a}),response:p}},6:({acks:e,timeout:t,compression:o,topicData:s,transactionalId:i,producerId:n,producerEpoch:a})=>{const c=r(1392),p=r(1988);return{request:c({acks:e,timeout:t,compression:o,topicData:s,transactionalId:i,producerId:n,producerEpoch:a}),response:p}},7:({acks:e,timeout:t,compression:o,topicData:s,transactionalId:i,producerId:n,producerEpoch:a})=>{const c=r(637),p=r(5250);return{request:c({acks:e,timeout:t,compression:o,topicData:s,transactionalId:i,producerId:n,producerEpoch:a}),response:p}}};e.exports={versions:Object.keys(o),protocol:({version:e})=>o[e]}},5127:(e,t,r)=>{const o=r(8783),{Produce:s}=r(9211),i=r(2032);e.exports=({acks:e,timeout:t,topicData:r})=>({apiKey:s,apiVersion:0,apiName:"Produce",expectResponse:()=>0!==e,encode:async()=>(new o).writeInt16(e).writeInt32(t).writeArray(r.map(n))});const n=({topic:e,partitions:t})=>(new o).writeString(e).writeArray(t.map(a)),a=({partition:e,messages:t})=>{const r=i({messageVersion:0,entries:t});return(new o).writeInt32(e).writeInt32(r.size()).writeEncoder(r)}},2615:(e,t,r)=>{const o=r(6341),{failure:s,createErrorFromCode:i}=r(1701),n=e=>({partition:e.readInt32(),errorCode:e.readInt16(),offset:e.readInt64().toString()});e.exports={decode:async e=>({topics:new o(e).readArray((e=>({topicName:e.readString(),partitions:e.readArray(n)})))}),parse:async e=>{const t=e.topics.flatMap((e=>e.partitions.filter((e=>s(e.errorCode)))));if(t.length>0){const{errorCode:e}=t[0];throw i(e)}return e}}},6807:(e,t,r)=>{const o=r(5127);e.exports=({acks:e,timeout:t,topicData:r})=>Object.assign(o({acks:e,timeout:t,topicData:r}),{apiVersion:1})},8683:(e,t,r)=>{const o=r(6341),{parse:s}=r(2615),i=e=>({partition:e.readInt32(),errorCode:e.readInt16(),offset:e.readInt64().toString()});e.exports={decode:async e=>{const t=new o(e),r=t.readArray((e=>({topicName:e.readString(),partitions:e.readArray(i)})));return{topics:r,throttleTime:t.readInt32()}},parse:s}},749:(e,t,r)=>{const o=r(8783),{Produce:s}=r(9211),i=r(2032),{Types:n,lookupCodec:a}=r(2972);e.exports=({acks:e,timeout:t,compression:r=n.None,topicData:i})=>({apiKey:s,apiVersion:2,apiName:"Produce",expectResponse:()=>0!==e,encode:async()=>{const s=c(r),n=[];for(const e of i)n.push(await s(e));return(new o).writeInt16(e).writeInt32(t).writeArray(n)}});const c=e=>{const t=p(e);return async({topic:e,partitions:r})=>{const s=[];for(const e of r)s.push(await t(e));return(new o).writeString(e).writeArray(s)}},p=e=>async({partition:t,messages:r})=>{const s=i({messageVersion:1,compression:e,entries:r});if(e===n.None)return(new o).writeInt32(t).writeInt32(s.size()).writeEncoder(s);const c=r[0].timestamp||Date.now(),p=a(e),d=await p.compress(s),u=i({messageVersion:1,entries:[{compression:e,timestamp:c,value:d}]});return(new o).writeInt32(t).writeInt32(u.size()).writeEncoder(u)}},5468:(e,t,r)=>{const o=r(6341),{parse:s}=r(2615),i=e=>({partition:e.readInt32(),errorCode:e.readInt16(),offset:e.readInt64().toString(),timestamp:e.readInt64().toString()});e.exports={decode:async e=>{const t=new o(e),r=t.readArray((e=>({topicName:e.readString(),partitions:e.readArray(i)})));return{topics:r,throttleTime:t.readInt32()}},parse:s}},6088:(e,t,r)=>{const o=r(3278),s=r(8783),{Produce:i}=r(9211),{Types:n}=r(2972),a=r(6575),{RecordBatch:c}=r(2872);e.exports=({acks:e,timeout:t,transactionalId:r=null,producerId:a=o.fromInt(-1),producerEpoch:c=0,compression:d=n.None,topicData:u})=>({apiKey:i,apiVersion:3,apiName:"Produce",expectResponse:()=>0!==e,encode:async()=>{const o=p(d),i=[];for(const e of u)i.push(await o({...e,transactionalId:r,producerId:a,producerEpoch:c}));return(new s).writeString(r).writeInt16(e).writeInt32(t).writeArray(i)}});const p=e=>async({topic:t,partitions:r,transactionalId:o,producerId:i,producerEpoch:n})=>{const a=d(e),c=[];for(const e of r)c.push(await a({...e,transactionalId:o,producerId:i,producerEpoch:n}));return(new s).writeString(t).writeArray(c)},d=e=>async({partition:t,messages:r,transactionalId:o,firstSequence:i,producerId:n,producerEpoch:p})=>{const d=Date.now(),u=r.map((e=>e.timestamp)).filter((e=>null!=e)).sort(),l=0===u.length?[d]:u,h=l[0],m=l[l.length-1],f=r.map(((e,t)=>a({...e,offsetDelta:t,timestampDelta:(e.timestamp||d)-h}))),g=await c({compression:e,records:f,firstTimestamp:h,maxTimestamp:m,producerId:n,producerEpoch:p,firstSequence:i,transactional:!!o,lastOffsetDelta:f.length-1});return(new s).writeInt32(t).writeInt32(g.size()).writeEncoder(g)}},4635:(e,t,r)=>{const o=r(6341),{failure:s,createErrorFromCode:i}=r(1701),n=e=>({partition:e.readInt32(),errorCode:e.readInt16(),baseOffset:e.readInt64().toString(),logAppendTime:e.readInt64().toString()});e.exports={decode:async e=>{const t=new o(e),r=t.readArray((e=>({topicName:e.readString(),partitions:e.readArray(n)})));return{topics:r,throttleTime:t.readInt32()}},parse:async e=>{const t=e.topics.flatMap((e=>e.partitions.filter((e=>s(e.errorCode)))));if(t.length>0){const{errorCode:e}=t[0];throw i(e)}return e}}},9221:(e,t,r)=>{const o=r(6088);e.exports=({acks:e,timeout:t,transactionalId:r,producerId:s,producerEpoch:i,compression:n,topicData:a})=>Object.assign(o({acks:e,timeout:t,transactionalId:r,producerId:s,producerEpoch:i,compression:n,topicData:a}),{apiVersion:4})},4206:(e,t,r)=>{const{decode:o,parse:s}=r(4635);e.exports={decode:o,parse:s}},5353:(e,t,r)=>{const o=r(6088);e.exports=({acks:e,timeout:t,transactionalId:r,producerId:s,producerEpoch:i,compression:n,topicData:a})=>Object.assign(o({acks:e,timeout:t,transactionalId:r,producerId:s,producerEpoch:i,compression:n,topicData:a}),{apiVersion:5})},4708:(e,t,r)=>{const o=r(6341),{parse:s}=r(4635),i=e=>({partition:e.readInt32(),errorCode:e.readInt16(),baseOffset:e.readInt64().toString(),logAppendTime:e.readInt64().toString(),logStartOffset:e.readInt64().toString()});e.exports={decode:async e=>{const t=new o(e),r=t.readArray((e=>({topicName:e.readString(),partitions:e.readArray(i)})));return{topics:r,throttleTime:t.readInt32()}},parse:s}},1392:(e,t,r)=>{const o=r(5353);e.exports=({acks:e,timeout:t,transactionalId:r,producerId:s,producerEpoch:i,compression:n,topicData:a})=>Object.assign(o({acks:e,timeout:t,transactionalId:r,producerId:s,producerEpoch:i,compression:n,topicData:a}),{apiVersion:6})},1988:(e,t,r)=>{const{parse:o,decode:s}=r(4708);e.exports={decode:async e=>{const t=await s(e);return{...t,throttleTime:0,clientSideThrottleTime:t.throttleTime}},parse:o}},637:(e,t,r)=>{const o=r(1392);e.exports=({acks:e,timeout:t,transactionalId:r,producerId:s,producerEpoch:i,compression:n,topicData:a})=>Object.assign(o({acks:e,timeout:t,transactionalId:r,producerId:s,producerEpoch:i,compression:n,topicData:a}),{apiVersion:7})},5250:(e,t,r)=>{const{decode:o,parse:s}=r(1988);e.exports={decode:o,parse:s}},886:(e,t,r)=>{const o={0:({authBytes:e})=>{const t=r(7383),o=r(9305);return{request:t({authBytes:e}),response:o}},1:({authBytes:e})=>{const t=r(8439),o=r(5986);return{request:t({authBytes:e}),response:o}}};e.exports={versions:Object.keys(o),protocol:({version:e})=>o[e]}},7383:(e,t,r)=>{const o=r(8783),{SaslAuthenticate:s}=r(9211);e.exports=({authBytes:e})=>({apiKey:s,apiVersion:0,apiName:"SaslAuthenticate",encode:async()=>(new o).writeBuffer(e)})},9305:(e,t,r)=>{const o=r(6341),s=r(8783),{failure:i,createErrorFromCode:n,failIfVersionNotSupported:a,errorCodes:c}=r(1701),{KafkaJSProtocolError:p}=r(9879),d=c.find((e=>58===e.code));e.exports={decode:async e=>{const t=new o(e),r=t.readInt16();return a(r),{errorCode:r,errorMessage:t.readString(),authBytes:(new s).writeBytes(t.readBytes()).buffer}},parse:async e=>{if(58===e.errorCode&&e.errorMessage)throw new p({...d,message:e.errorMessage});if(i(e.errorCode))throw n(e.errorCode);return e}}},8439:(e,t,r)=>{const o=r(7383);e.exports=({authBytes:e})=>Object.assign(o({authBytes:e}),{apiVersion:1})},5986:(e,t,r)=>{const o=r(6341),s=r(8783),{parse:i}=r(9305),{failIfVersionNotSupported:n}=r(1701);e.exports={decode:async e=>{const t=new o(e),r=t.readInt16();return n(r),{errorCode:r,errorMessage:t.readString(),authBytes:(new s).writeBytes(t.readBytes()).buffer,sessionLifetimeMs:t.readInt64().toString()}},parse:i}},6184:(e,t,r)=>{const o={0:({mechanism:e})=>{const t=r(8143),o=r(6190);return{request:t({mechanism:e}),response:o}},1:({mechanism:e})=>{const t=r(5389),o=r(525);return{request:t({mechanism:e}),response:o}}};e.exports={versions:Object.keys(o),protocol:({version:e})=>o[e]}},8143:(e,t,r)=>{const o=r(8783),{SaslHandshake:s}=r(9211);e.exports=({mechanism:e})=>({apiKey:s,apiVersion:0,apiName:"SaslHandshake",encode:async()=>(new o).writeString(e)})},6190:(e,t,r)=>{const o=r(6341),{failure:s,createErrorFromCode:i,failIfVersionNotSupported:n}=r(1701);e.exports={decode:async e=>{const t=new o(e),r=t.readInt16();return n(r),{errorCode:r,enabledMechanisms:t.readArray((e=>e.readString()))}},parse:async e=>{if(s(e.errorCode))throw i(e.errorCode);return e}}},5389:(e,t,r)=>{const o=r(8143);e.exports=({mechanism:e})=>({...o({mechanism:e}),apiVersion:1})},525:(e,t,r)=>{const{decode:o,parse:s}=r(6190);e.exports={decode:o,parse:s}},6096:(e,t,r)=>{const o={0:({groupId:e,generationId:t,memberId:o,groupAssignment:s})=>{const i=r(2322),n=r(5509);return{request:i({groupId:e,generationId:t,memberId:o,groupAssignment:s}),response:n}},1:({groupId:e,generationId:t,memberId:o,groupAssignment:s})=>{const i=r(2596),n=r(3155);return{request:i({groupId:e,generationId:t,memberId:o,groupAssignment:s}),response:n}},2:({groupId:e,generationId:t,memberId:o,groupAssignment:s})=>{const i=r(8039),n=r(15);return{request:i({groupId:e,generationId:t,memberId:o,groupAssignment:s}),response:n}},3:({groupId:e,generationId:t,memberId:o,groupInstanceId:s,groupAssignment:i})=>{const n=r(7203),a=r(2745);return{request:n({groupId:e,generationId:t,memberId:o,groupInstanceId:s,groupAssignment:i}),response:a}}};e.exports={versions:Object.keys(o),protocol:({version:e})=>o[e]}},2322:(e,t,r)=>{const o=r(8783),{SyncGroup:s}=r(9211);e.exports=({groupId:e,generationId:t,memberId:r,groupAssignment:n})=>({apiKey:s,apiVersion:0,apiName:"SyncGroup",encode:async()=>(new o).writeString(e).writeInt32(t).writeString(r).writeArray(n.map(i))});const i=({memberId:e,memberAssignment:t})=>(new o).writeString(e).writeBytes(t)},5509:(e,t,r)=>{const o=r(6341),{failure:s,createErrorFromCode:i,failIfVersionNotSupported:n}=r(1701);e.exports={decode:async e=>{const t=new o(e),r=t.readInt16();return n(r),{errorCode:r,memberAssignment:t.readBytes()}},parse:async e=>{if(s(e.errorCode))throw i(e.errorCode);return e}}},2596:(e,t,r)=>{const o=r(2322);e.exports=({groupId:e,generationId:t,memberId:r,groupAssignment:s})=>Object.assign(o({groupId:e,generationId:t,memberId:r,groupAssignment:s}),{apiVersion:1})},3155:(e,t,r)=>{const o=r(6341),{failIfVersionNotSupported:s}=r(1701),{parse:i}=r(5509);e.exports={decode:async e=>{const t=new o(e),r=t.readInt32(),i=t.readInt16();return s(i),{throttleTime:r,errorCode:i,memberAssignment:t.readBytes()}},parse:i}},8039:(e,t,r)=>{const o=r(2596);e.exports=({groupId:e,generationId:t,memberId:r,groupAssignment:s})=>Object.assign(o({groupId:e,generationId:t,memberId:r,groupAssignment:s}),{apiVersion:2})},15:(e,t,r)=>{const{parse:o,decode:s}=r(3155);e.exports={decode:async e=>{const t=await s(e);return{...t,throttleTime:0,clientSideThrottleTime:t.throttleTime}},parse:o}},7203:(e,t,r)=>{const o=r(8783),{SyncGroup:s}=r(9211);e.exports=({groupId:e,generationId:t,memberId:r,groupInstanceId:n=null,groupAssignment:a})=>({apiKey:s,apiVersion:3,apiName:"SyncGroup",encode:async()=>(new o).writeString(e).writeInt32(t).writeString(r).writeString(n).writeArray(a.map(i))});const i=({memberId:e,memberAssignment:t})=>(new o).writeString(e).writeBytes(t)},2745:(e,t,r)=>{const{decode:o,parse:s}=r(15);e.exports={decode:o,parse:s}},5302:(e,t,r)=>{const o={0:({transactionalId:e,groupId:t,producerId:o,producerEpoch:s,topics:i})=>{const n=r(4021),a=r(4272);return{request:n({transactionalId:e,groupId:t,producerId:o,producerEpoch:s,topics:i}),response:a}},1:({transactionalId:e,groupId:t,producerId:o,producerEpoch:s,topics:i})=>{const n=r(2944),a=r(9560);return{request:n({transactionalId:e,groupId:t,producerId:o,producerEpoch:s,topics:i}),response:a}}};e.exports={versions:Object.keys(o),protocol:({version:e})=>o[e]}},4021:(e,t,r)=>{const o=r(8783),{TxnOffsetCommit:s}=r(9211);e.exports=({transactionalId:e,groupId:t,producerId:r,producerEpoch:n,topics:a})=>({apiKey:s,apiVersion:0,apiName:"TxnOffsetCommit",encode:async()=>(new o).writeString(e).writeString(t).writeInt64(r).writeInt16(n).writeArray(a.map(i))});const i=({topic:e,partitions:t})=>(new o).writeString(e).writeArray(t.map(n)),n=({partition:e,offset:t,metadata:r})=>(new o).writeInt32(e).writeInt64(t).writeString(r)},4272:(e,t,r)=>{const o=r(6341),{failure:s,createErrorFromCode:i}=r(1701),n=async e=>({topic:e.readString(),partitions:await e.readArrayAsync(a)}),a=e=>({partition:e.readInt32(),errorCode:e.readInt16()});e.exports={decode:async e=>{const t=new o(e);return{throttleTime:t.readInt32(),topics:await t.readArrayAsync(n)}},parse:async e=>{const t=e.topics.map((({partitions:e})=>({partitionsWithErrors:e.filter((({errorCode:e})=>s(e)))}))).filter((({partitionsWithErrors:e})=>e.length));if(t.length>0)throw i(t[0].partitionsWithErrors[0].errorCode);return e}}},2944:(e,t,r)=>{const o=r(4021);e.exports=({transactionalId:e,groupId:t,producerId:r,producerEpoch:s,topics:i})=>Object.assign(o({transactionalId:e,groupId:t,producerId:r,producerEpoch:s,topics:i}),{apiVersion:1})},9560:(e,t,r)=>{const{parse:o,decode:s}=r(4272);e.exports={decode:async e=>{const t=await s(e);return{...t,throttleTime:0,clientSideThrottleTime:t.throttleTime}},parse:o}},8203:e=>{e.exports={UNKNOWN:0,ANY:1,MATCH:2,LITERAL:3,PREFIXED:4}},1128:(e,t,r)=>{e.exports={request:r(326),response:r(1391)}},326:(e,t,r)=>{const o=r(8783);e.exports=({authorizationIdentity:e,accessKeyId:t,secretAccessKey:r,sessionToken:s=""})=>({encode:async()=>(new o).writeBytes([e,t,r,s].join("\0"))})},1391:e=>{e.exports={decode:async()=>!0,parse:async()=>!0}},3860:(e,t,r)=>{e.exports={request:r(8824),response:r(5196)}},8824:(e,t,r)=>{const o=r(8783);e.exports=async({authorizationIdentity:e=null},t)=>{const r=null==e?"":`"a=${e}`;let s=function(e){let t="";if(null==e)return t;let r="";for(const o in e)t+=`${r}${o}=${e[o]}`,r="";return t}(t.extensions);s.length>0&&(s=`${s}`);const i=`n,${r},auth=Bearer ${t.value}${s}`;return{encode:async()=>(new o).writeBytes(Buffer.from(i))}}},5196:e=>{e.exports={decode:async()=>!0,parse:async()=>!0}},7733:(e,t,r)=>{e.exports={request:r(7985),response:r(7914)}},7985:(e,t,r)=>{const o=r(8783);e.exports=({authorizationIdentity:e=null,username:t,password:r})=>({encode:async()=>(new o).writeBytes([e,t,r].join("\0"))})},7914:e=>{e.exports={decode:async()=>!0,parse:async()=>!0}},9410:(e,t,r)=>{const o=r(8783);e.exports=({finalMessage:e})=>({encode:async()=>(new o).writeBytes(e)})},776:(e,t,r)=>{e.exports=r(8703)},1224:(e,t,r)=>{const o=r(8783);e.exports=({clientFirstMessage:e})=>({encode:async()=>(new o).writeBytes(e)})},8703:(e,t,r)=>{const o=r(6341),s=/^([rsiev])=(.*)$/;e.exports={decode:async e=>new o(e).readBytes(),parse:async e=>{const t=e.toString().split(",").map((e=>{const[t,r,o]=e.match(s);return[r,o]})).reduce(((e,t)=>({...e,[t[0]]:t[1]})),{});return{original:e.toString(),...t}}}},2337:(e,t,r)=>{e.exports={firstMessage:{request:r(1224),response:r(8703)},finalMessage:{request:r(9410),response:r(776)}}},2515:e=>{e.exports={NO_TIMESTAMP:-1,CREATE_TIME:0,LOG_APPEND_TIME:1}},7727:e=>{e.exports={maxRetryTime:3e4,initialRetryTime:300,factor:.2,multiplier:2,retries:5}},6045:e=>{e.exports={maxRetryTime:1e3,initialRetryTime:50,factor:.02,multiplier:1.5,retries:15}},9701:(e,t,r)=>{const{KafkaJSNumberOfRetriesExceeded:o,KafkaJSNonRetriableError:s}=r(9879),i=r(7727),n=(e,t)=>{const r=e*t;return Math.ceil((o=t-r,s=t+r,Math.random()*(s-o)+o));var o,s},a=["RangeError","ReferenceError","SyntaxError","TypeError"],c=(e,t,r,i)=>{let c=!1;const{factor:p,multiplier:d,maxRetryTime:u,retries:l}=e,h=e=>{c=!0,r(e||new Error("Aborted"))},m=(e,f=0)=>{if(c)return;const g=(e=>Math.min(n(p,e)*d,u))(e),I=f<l;i(h,f,e).then(t).catch((t=>{(e=>{return(e.retriable||!1!==e.retriable)&&(t=e,!a.includes(t.name));var t})(t)?I?setTimeout((()=>m(g,f+1)),e):r(new o(t,{retryCount:f,retryTime:e,cause:t.cause||t})):r(new s(t,{cause:t.cause||t}))}))};return m};e.exports=(e={})=>t=>new Promise(((r,o)=>{const s=Object.assign({},i,e);c(s,r,o,t)(n(s.factor,s.initialRetryTime))}))},8351:e=>{e.exports=(e,t)=>{const r=[],o=e.length;let s=0;for(;s<o;)-1===t.indexOf(e[s])&&r.push(e[s]),s+=1;return r}},3163:e=>{e.exports=async(e,t)=>{const r=new Map;for(const o of e){const e=await Promise.resolve(t(o));r.set(e,r.has(e)?[...r.get(e),o]:[o])}return r}},4105:(e,t,r)=>{const{format:o}=r(3837),{KafkaJSLockTimeout:s}=r(9879),i=Symbol("private:Lock:locked"),n=Symbol("private:Lock:timeout"),a=Symbol("private:Lock:waiting"),c=Symbol("private:Lock:timeoutErrorMessage");e.exports=class{constructor({timeout:e,description:t=null}={}){if("number"!=typeof e)throw new TypeError(`'timeout' is not a number, received '${typeof e}'`);this[i]=!1,this[n]=e,this[a]=new Set,this[c]=()=>{const e=o("Timeout while acquiring lock (%d waiting locks)",this[a].size);return t?`${e}: "${t}"`:e}}async acquire(){return new Promise(((e,t)=>{if(!this[i])return this[i]=!0,e();let r=null;const o=async()=>{if(!this[i])return this[i]=!0,clearTimeout(r),this[a].delete(o),e()};this[a].add(o),r=setTimeout((()=>{const e=new s(this[c]());this[a].delete(o),t(e)}),this[n])}))}async release(){this[i]=!1;const e=this[a].values().next().value;if(e)return e()}}},3278:e=>{class t{constructor(e){this.value=e}static isLong(e){return"bigint"==typeof e.value}static fromBits(e){return new t(BigInt(e))}static fromInt(e){return isNaN(e)?t.ZERO:new t(BigInt.asIntN(64,BigInt(e)))}static fromNumber(e){return isNaN(e)?t.ZERO:new t(BigInt(e))}static fromValue(e){return"number"==typeof e?this.fromNumber(e):"string"==typeof e?this.fromString(e):"bigint"==typeof e?new t(e):this.isLong(e)?new t(BigInt(e.value)):new t(BigInt(e))}static fromString(e){if(0===e.length)throw Error("empty string");return"NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e?t.ZERO:new t(BigInt(e))}isZero(){return this.value===BigInt(0)}isNegative(){return this.value<BigInt(0)}toString(){return String(this.value)}toNumber(){return Number(this.value)}toInt(){return Number(BigInt.asIntN(32,this.value))}toJSON(){return this.toString()}shiftLeft(e){return new t(this.value<<BigInt(e))}shiftRight(e){return new t(this.value>>BigInt(e))}or(e){return t.isLong(e)||(e=t.fromValue(e)),t.fromBits(this.value|e.value)}xor(e){return t.isLong(e)||(e=t.fromValue(e)),new t(this.value^e.value)}and(e){return t.isLong(e)||(e=t.fromValue(e)),new t(this.value&e.value)}not(){return new t(~this.value)}shiftRightUnsigned(e){return new t(this.value>>BigInt.asUintN(64,BigInt(e)))}equals(e){return t.isLong(e)||(e=t.fromValue(e)),this.value===e.value}greaterThanOrEqual(e){return t.isLong(e)||(e=t.fromValue(e)),this.value>=e.value}gte(e){return this.greaterThanOrEqual(e)}notEquals(e){return t.isLong(e)||(e=t.fromValue(e)),!this.equals(e)}add(e){return t.isLong(e)||(e=t.fromValue(e)),new t(this.value+e.value)}subtract(e){return t.isLong(e)||(e=t.fromValue(e)),this.add(e.negate())}multiply(e){return this.isZero()?t.ZERO:(t.isLong(e)||(e=t.fromValue(e)),new t(this.value*e.value))}divide(e){if(t.isLong(e)||(e=t.fromValue(e)),e.isZero())throw Error("division by zero");return new t(this.value/e.value)}compare(e){return t.isLong(e)||(e=t.fromValue(e)),this.value===e.value?0:this.value>e.value?1:e.value>this.value?-1:void 0}lessThan(e){return t.isLong(e)||(e=t.fromValue(e)),this.value<e.value}negate(){return this.equals(t.MIN_VALUE)?t.MIN_VALUE:this.not().add(t.ONE)}getHighBits(){return Number(BigInt.asIntN(32,this.value>>BigInt(32)))}getLowBits(){return Number(BigInt.asIntN(32,this.value))}}t.MIN_VALUE=new t(BigInt("-9223372036854775808")),t.MAX_VALUE=new t(BigInt("9223372036854775807")),t.ZERO=t.fromInt(0),t.ONE=t.fromInt(1),e.exports=t},4278:e=>{e.exports=e=>{let t=!1;return(...r)=>{if(!t)return t=!0,e(...r)}}},8217:e=>{e.exports=(e,t=(e=>e))=>new Array(e).fill(0).map(((e,r)=>t(r)))},9026:e=>{e.exports=e=>{let t=null;return(...r)=>(null==t&&(t=e(...r).finally((()=>t=null))),t)}},2464:e=>{e.exports=e=>{if(!Array.isArray(e))throw new TypeError("'array' is not an array");if(e.length<2)return e;const t=e.slice();for(let e=t.length-1;e>0;e--){const r=Math.floor(Math.random()*(e+1)),o=t[e];t[e]=t[r],t[r]=o}return t}},4742:e=>{e.exports=e=>new Promise((t=>{setTimeout(t,e)}))},76:e=>{const{keys:t}=Object;e.exports=e=>t(e).reduce(((t,r)=>({...t,[e[r]]:r})),{})},6335:(e,t,r)=>{const o=r(4742),{KafkaJSTimeout:s}=r(9879);e.exports=(e,{delay:t=50,maxWait:r=1e4,timeoutMessage:i="Timeout",ignoreTimeout:n=!1}={})=>{let a,c=0,p=!1;const d=async(r,s)=>{if(c+=t,!p){await o(t);try{const t=await e(c);if(t)return p=!0,clearTimeout(a),r(t);d(r,s)}catch(e){p=!0,clearTimeout(a),s(e)}}};return new Promise(((e,t)=>{d(e,t),n||(a=setTimeout((()=>{if(!p)return p=!0,t(new s(i))}),r))}))}},6779:e=>{const t=e=>t=>t.charAt(0)===e?t.substring(1):t,r=t("/"),o=t("#");e.exports=(e,t)=>`https://kafka.js.org/${r(e)}${t?"#"+o(t):""}`},9491:e=>{"use strict";e.exports=require("assert")},6113:e=>{"use strict";e.exports=require("crypto")},2361:e=>{"use strict";e.exports=require("events")},1808:e=>{"use strict";e.exports=require("net")},4404:e=>{"use strict";e.exports=require("tls")},3837:e=>{"use strict";e.exports=require("util")},9796:e=>{"use strict";e.exports=require("zlib")},5557:e=>{"use strict";e.exports=JSON.parse('{"name":"kafkajs","version":"2.1.0","description":"A modern Apache Kafka client for node.js","author":"Tulio Ornelas <ornelas.tulio@gmail.com>","main":"index.js","types":"types/index.d.ts","license":"MIT","keywords":["kafka","sasl","scram"],"engines":{"node":">=14.0.0"},"repository":{"type":"git","url":"https://github.com/tulios/kafkajs.git"},"bugs":{"url":"https://github.com/tulios/kafkajs/issues"},"homepage":"https://kafka.js.org","scripts":{"jest":"export KAFKA_VERSION=${KAFKA_VERSION:=\'2.4\'} && NODE_ENV=test echo \\"KAFKA_VERSION: ${KAFKA_VERSION}\\" && KAFKAJS_DEBUG_PROTOCOL_BUFFERS=1 jest","test:local":"yarn jest --detectOpenHandles","test:debug":"NODE_ENV=test KAFKAJS_DEBUG_PROTOCOL_BUFFERS=1 node --inspect-brk $(yarn bin 2>/dev/null)/jest --detectOpenHandles --runInBand --watch","test:local:watch":"yarn test:local --watch","test":"yarn lint && JEST_JUNIT_OUTPUT_NAME=test-report.xml ./scripts/testWithKafka.sh \'yarn jest --ci --maxWorkers=4 --no-watchman --forceExit\'","lint":"find . -path ./node_modules -prune -o -path ./coverage -prune -o -path ./website -prune -o -name \'*.js\' -print0 | xargs -0 eslint","format":"find . -path ./node_modules -prune -o -path ./coverage -prune -o -path ./website -prune -o -name \'*.js\' -print0 | xargs -0 prettier --write","precommit":"lint-staged","test:group:broker":"yarn jest --forceExit --testPathPattern \'src/broker/.*\'","test:group:admin":"yarn jest --forceExit --testPathPattern \'src/admin/.*\'","test:group:producer":"yarn jest --forceExit --testPathPattern \'src/producer/.*\'","test:group:consumer":"yarn jest --forceExit --testPathPattern \'src/consumer/.*.spec.js\'","test:group:others":"yarn jest --forceExit --testPathPattern \'src/(?!(broker|admin|producer|consumer)/).*\'","test:group:oauthbearer":"OAUTHBEARER_ENABLED=1 yarn jest --forceExit src/producer/index.spec.js src/broker/__tests__/connect.spec.js src/consumer/__tests__/connection.spec.js src/broker/__tests__/disconnect.spec.js src/admin/__tests__/connection.spec.js src/broker/__tests__/reauthenticate.spec.js","test:group:broker:ci":"JEST_JUNIT_OUTPUT_NAME=test-report.xml ./scripts/testWithKafka.sh \\"yarn test:group:broker --ci --maxWorkers=4 --no-watchman\\"","test:group:admin:ci":"JEST_JUNIT_OUTPUT_NAME=test-report.xml ./scripts/testWithKafka.sh \\"yarn test:group:admin --ci --maxWorkers=4 --no-watchman\\"","test:group:producer:ci":"JEST_JUNIT_OUTPUT_NAME=test-report.xml ./scripts/testWithKafka.sh \\"yarn test:group:producer --ci --maxWorkers=4 --no-watchman\\"","test:group:consumer:ci":"JEST_JUNIT_OUTPUT_NAME=test-report.xml ./scripts/testWithKafka.sh \\"yarn test:group:consumer --ci --maxWorkers=4 --no-watchman\\"","test:group:others:ci":"JEST_JUNIT_OUTPUT_NAME=test-report.xml ./scripts/testWithKafka.sh \\"yarn test:group:others --ci --maxWorkers=4 --no-watchman\\"","test:group:oauthbearer:ci":"JEST_JUNIT_OUTPUT_NAME=test-report.xml COMPOSE_FILE=\'docker-compose.2_4_oauthbearer.yml\' ./scripts/testWithKafka.sh \\"yarn test:group:oauthbearer --ci --maxWorkers=4 --no-watchman\\"","test:types":"tsc -p types/"},"devDependencies":{"@types/jest":"^27.4.0","@types/node":"^12.0.8","@typescript-eslint/typescript-estree":"^1.10.2","eslint":"^6.8.0","eslint-config-prettier":"^6.0.0","eslint-config-standard":"^13.0.1","eslint-plugin-import":"^2.18.2","eslint-plugin-jest":"^26.1.0","eslint-plugin-node":"^11.0.0","eslint-plugin-prettier":"^3.1.0","eslint-plugin-promise":"^4.2.1","eslint-plugin-standard":"^4.0.0","execa":"^2.0.3","glob":"^7.1.4","husky":"^3.0.1","ip":"^1.1.5","jest":"^25.1.0","jest-circus":"^25.1.0","jest-extended":"^0.11.2","jest-junit":"^10.0.0","jsonwebtoken":"^8.5.1","lint-staged":"^9.2.0","mockdate":"^2.0.5","prettier":"^1.18.2","semver":"^6.2.0","typescript":"^3.8.3","uuid":"^3.3.2"},"dependencies":{},"lint-staged":{"*.js":["prettier --write","git add"]}}')}},t={};function r(o){var s=t[o];if(void 0!==s)return s.exports;var i=t[o]={exports:{}};return e[o](i,i.exports,r),i.exports}(()=>{"use strict";const e=require("http"),t=require("fs"),o=require("path"),s=require("sqlite3");class i extends class{constructor(){this.db=null}openDb(){this.db=new s.Database("./kafka-assit-data",s.OPEN_READWRITE|s.OPEN_CREATE,(e=>{}))}createTable(){this.db.run("\n        CREATE TABLE IF NOT EXISTS clusterconnections (\n          \n          name TEXT PRIMARY KEY,\n          boostrapservers TEXT)")}initDb(){this.openDb(),this.createTable()}closeDb(){this.db.close()}run(e,t=[]){return new Promise(((r,o)=>{this.db.all(e,t,(function(t,s){t?(console.log("Error running sql "+e),console.log(t),o(t)):r(s)}))}))}}{constructor(){super()}openDb(){this.db=new s.Database("./kafka-assit-data",s.OPEN_READWRITE|s.OPEN_CREATE,(e=>{}))}createConnection(e){const{boostrapservers:t,name:r}=e;this.initDb();const o=this.db.prepare("INSERT or REPLACE INTO clusterconnections VALUES (?,?)");o.run(r,t),o.finalize(),this.closeDb()}async getConnectionDetails(e){this.initDb();let t=await this.run("SELECT * FROM clusterconnections WHERE name=?",e);return this.closeDb(),t[0]}}var n=r(4552);class a{async loadClusterData(e){let t=new i,r=await t.getConnectionDetails(e);return r.boostrapservers=r.boostrapservers.split(","),new n.Kafka({clientId:"kafka-assit",brokers:r.boostrapservers})}}class c extends a{constructor(){super()}async publish(e){let t={};try{let r=(await this.loadClusterData(e.connectionName)).producer();await r.connect(),await r.send({topic:connectionDetails.topic,messages:[{value:connectionDetails.message}]}),await r.disconnect(),t={message:"succussfully published"}}catch(e){t={error:e}}return t}}class p extends a{constructor(){super()}async getTopicsList(e){let t={};try{let r=(await this.loadClusterData(e.connectionName)).admin();await r.connect(),t=await r.listTopics(),await r.disconnect()}catch(e){t.error=e}return t}}const d=e.createServer(((e,r)=>{let s=e.url;if(s.startsWith("/api")){let t=[];e.on("error",(e=>{console.error(e)})).on("data",(e=>{t.push(e)})).on("end",(()=>{t=Buffer.concat(t).toString();let o={};try{o=JSON.parse(t)}catch(e){o={}}(async function(e){let{request:t,url:r,body:o}=e;switch(console.log("request ",t.url),r){case"/api/publish":let t=new c;e.responseBody=await t.publish(o);break;case"/api/topics":let r=new p;e.responseBody=await r.getTopicsList(o);break;default:e.responseBody={error:"no route found"}}return e})({request:e,response:r,url:s,body:o}).then((e=>{let{request:t,response:r,responseBody:o}=e;u(t,r,o)}))}))}else!function(e,r){console.log("request is to be served by static views"),console.log("request  ",e.url),console.log(o.dirname(process.execPath));var s="ui"+e.url;"/"==e.url&&(s="ui/index.html");var i=String((0,o.extname)(s)).toLowerCase(),n={".html":"text/html",".js":"text/javascript",".css":"text/css",".json":"application/json",".png":"image/png",".jpg":"image/jpg",".gif":"image/gif",".svg":"image/svg+xml",".wav":"audio/wav",".mp4":"video/mp4",".woff":"application/font-woff",".ttf":"application/font-ttf",".eot":"application/vnd.ms-fontobject",".otf":"application/font-otf",".wasm":"application/wasm"},a=n[i]||"application/octet-stream";""==i&&(s="ui/index.html",a=n[".html"]),s=o.join(__dirname,s),console.log("filePath is ",s),(0,t.readFile)(s,(function(e,o){e?(console.error(e),"ENOENT"==e.code?(0,t.readFile)("./404.html",(function(e,t){r.writeHead(404,{"Content-Type":"text/html"}),r.end(t,"utf-8")})):(r.writeHead(500),r.end("Sorry, check with the site admin for error: "+e.code+" ..\n"))):(r.writeHead(200,{"Content-Type":a}),r.end(o,"utf-8"))}))}(e,r)})),u=function(e,t,r){t.on("error",(e=>{console.error(e)})),r.error?t.statusCode=400:t.statusCode=200,t.setHeader("Content-Type","application/json"),r&&t.write(JSON.stringify(r)),t.end()},l=require("child_process");!function(e,t,r){d.listen(3e3,t,(()=>{console.log("Server running at http://127.0.0.1:3000/"),(new i).createConnection({name:"perf",boostrapservers:"10.201.206.24:9092,10.201.206.24:9093,10.201.206.24:9094"}),(()=>{const e="http://127.0.0.1:3000";console.log("server is now listning"),console.log(`Open a browser and navigate to ${e}`);try{(0,l.exec)(`start ${e}`)}catch(e){console.error(e)}})()}))}(0,"127.0.0.1")})()})();